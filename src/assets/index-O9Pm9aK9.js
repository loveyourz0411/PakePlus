import{r as x,j as I,k as J,l as Q,f as $,i as u,c as m,m as W,n as _,a as g,g as R,p as X,b as y,v,q as Y}from"./index-Dju9e0Mk.js";import{_ as Z}from"./system-ctrl-select-Em8B5Bdm.js";import{_ as z}from"./empty-SobI8E2D.js";import{G as ee,a as te}from"./dataMonitor-BqNmZQKc.js";import{u as P}from"./util-CASLgOZv.js";import{u as se}from"./useObserverMsg-mppqzyYd.js";import{s as B}from"./system-BzlGO5Bl.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-Cr7o0t0N.js";import"./categorizeParameters-C40L_2hr.js";const ne={},re={class:"main-content"},oe={class:"h100",style:{"padding-right":"20px"}},ie={key:0,class:"h100",style:{"padding-left":"20px"}},le="Real_Sim",ce="Open_Close",ue={__name:"index",setup(pe){const k=x(!1),T=x(.5),d=I([]),h=I([]),{VITE_APP_HASCONNECT:O}=ne,D=O==="true",E=J(()=>C(d).concat(C(h)));function C(t){if(!t)return[];const e=[];return t.forEach(s=>e.push(s,...C(s.children))),e}const L=x(null),S=x(null);function U(t){if(!t)return;const e=E.value.find(s=>{var n;return(n=s.children)==null?void 0:n.some(o=>o.key===t.key)});e&&(e.value=e.children.every(s=>s.value),U(e))}function b(t,e){var s;t.isGroup?t.children.forEach(n=>b(n,e)):t.userGroup?B({once:!0,messageList:[{type:"UserProtocol",MessageName:t.title,Parameters:((s=t.children)==null?void 0:s.map(n=>({Value:e,ParameterName:n.title})))||[]}]}):t.type==="Discrete"?B({once:!0,messageList:[{type:"Discrete",Value:e,ParameterName:t.title}]}):t.type==="UserProtocol"&&B({once:!0,messageList:[{type:"UserProtocol",MessageName:t.parentTitle,Parameters:[{Value:e,ParameterName:t.title}]}]})}function V(t,e){t.children.push(e),e.value||(t.value=!1)}const{refresh:H}=se(K);function K(t){t==null||t.forEach(e=>{const s=E.value.find(n=>`${n.type||""}-${n.parentTitle||""}-${n.title||""}`===e.Name);s&&(s.value=e.Engineering_Value==="True",U(s))})}function G(){k.value=!0,j().then(t=>{H(t),k.value=!1})}Q(G);const N=[];function j(){return new Promise(t=>{d.length=0,h.length=0,ee().then(e=>{const s=[];N.length=0,Promise.all([M(s,A(e,le),d),M(s,A(e,ce),h)]).then(()=>{t(s),Y(()=>{L.value.expandNode(N,!0),D&&S.value.expandNode(N,!0)})})})})}function A(t,e){var a,i;const{participant_list:s=[]}=t||{},n=s.find(r=>r.paticipant_name===e),{protocol_list:o=[]}=n||{},p=o.find(r=>r.protocol_type==="Discrete"),l=o.find(r=>r.protocol_type==="UserProtocol"),c=[];return(a=p==null?void 0:p.pub_message_name)==null||a.forEach(r=>{r&&c.push({entity_type:"Discrete",entity_name:r})}),(i=l==null?void 0:l.pub_message_name)==null||i.forEach(r=>{r&&c.push({entity_type:"UserProtocol",entity_name:r})}),c}function M(t,e,s){return new Promise(async n=>{for(const{entity_name:o,entity_type:p}of e){const l=await te(o,p),c=((l==null?void 0:l.attributes)||[]).find(i=>i.name==="GroupName");if(!(c!=null&&c.value))continue;let a=s.find(i=>i.title===c.value);if(a||(a={title:c.value,key:P.randomString(),hasBtn:!0,children:[],value:!0,isGroup:!0},N.push(a.key),s.push(a)),p==="Discrete"){const i=((l==null?void 0:l.attributes)||[]).find(f=>f.name==="DefaultValue"),r={title:o,key:P.randomString(),hasBtn:!0,type:"Discrete",value:(i==null?void 0:i.value)==="True",isLeaf:!0};t.push({ParamName:o,protocolType:"Discrete"}),V(a,r)}else if(p==="UserProtocol"){const i=P.randomString(),r={title:o,key:i,hasBtn:!0,children:[],value:!0,userGroup:!0};(l.children_info||[]).forEach(f=>{const w=((f==null?void 0:f.attributes)||[]).find(F=>F.name==="DefaultValue"),q=(w==null?void 0:w.value)==="1";t.push({MessageName:o,protocolType:"UserProtocol",ParamName:f.name}),V(r,{title:f.name,key:P.randomString(),hasBtn:!0,type:"UserProtocol",value:q,parentTitle:o,isLeaf:!0})}),V(a,r)}}n()})}return(t,e)=>{const s=g("a-divider"),n=g("a-switch"),o=g("a-tree"),p=g("a-empty"),l=g("a-split"),c=g("NSpin");return R(),$("div",re,[e[5]||(e[5]=u("div",{class:"navHeader"},[u("div",{class:"img-box"},[u("img",{src:Z})]),u("span",null,[W("系统控制 / "),u("span",{class:"child-text"},"断连切换控制面板")])],-1)),u("span",{class:"operate-tag",style:{"margin-top":"20px"},onClick:G}," 刷新列表 "),m(c,{show:k.value,class:"h100"},{default:_(()=>[m(l,{size:T.value,"onUpdate:size":e[0]||(e[0]=a=>T.value=a),class:"main",min:"200px",max:"0.8"},{first:_(()=>[u("div",oe,[e[2]||(e[2]=u("h4",null,"信号切换",-1)),m(s),y(m(o,{ref_key:"treeARef",ref:L,"show-line":"",data:d,style:{height:"calc(100% - 60px)"},"block-node":""},{extra:_(a=>[y(m(n,{type:"round","model-value":a.value,onChange:i=>b(a,!a.value)},null,8,["model-value","onChange"]),[[v,a==null?void 0:a.hasBtn]])]),_:1},8,["data"]),[[v,d.length]]),y(m(p,null,{image:_(()=>e[1]||(e[1]=[u("img",{src:z},null,-1)])),_:1},512),[[v,!d.length]])])]),second:_(()=>[D?(R(),$("div",ie,[e[4]||(e[4]=u("h4",null,"信号断连",-1)),m(s),y(m(o,{ref_key:"treeBRef",ref:S,"show-line":"",data:h,style:{height:"calc(100% - 60px)"},"block-node":""},{extra:_(a=>[y(m(n,{type:"round","model-value":a.value,onChange:i=>b(a,!a.value)},null,8,["model-value","onChange"]),[[v,a==null?void 0:a.hasBtn]])]),_:1},8,["data"]),[[v,h.length]]),y(m(p,null,{image:_(()=>e[3]||(e[3]=[u("img",{src:z},null,-1)])),_:1},512),[[v,!h.length]])])):X("",!0)]),_:1},8,["size"])]),_:1},8,["show"])])}}},Pe=ae(ue,[["__scopeId","data-v-d82978a3"]]);export{Pe as default};
