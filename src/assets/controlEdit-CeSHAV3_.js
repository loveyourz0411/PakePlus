import{a4 as Y,d as K,f as P,g as k,i as m,x as J,B as H,a5 as Q,k as z,a6 as ee,r as q,Y as De,F as be,A as Ce,c as t,G as c,y as ne,s as we,a7 as Be,a8 as Ie,a as s,m as B,j as Oe,O as Re,K as We,a9 as qe,z as L,n as d,p as He,aa as ae,ab as me,ac as xe,N as re,ad as Ze,ae as Ge,af as Xe,M as Ye}from"./index-Dju9e0Mk.js";import{_ as se}from"./empty-SobI8E2D.js";import{u as W}from"./util-CASLgOZv.js";import{c as Ke,p as R,g as Je,u as Qe,i as et}from"./useFile-Bgo6_xp2.js";import{_ as Le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{X as tt,g as nt}from"./index-DAi3yp0Q.js";import{I as _e}from"./index-BmfYhnls.js";import{I as lt}from"./index-bBPWzl2E.js";const ot=K({name:"IconArrowLeft",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const i=Q("icon"),r=z(()=>[i,`${i}-arrow-left`,{[`${i}-spin`]:e.spin}]),p=z(()=>{const l={};return e.size&&(l.fontSize=ee(e.size)?`${e.size}px`:e.size),e.rotate&&(l.transform=`rotate(${e.rotate}deg)`),l});return{cls:r,innerStyle:p,onClick:l=>{n("click",l)}}}}),it=["stroke-width","stroke-linecap","stroke-linejoin"];function at(e,n,i,r,p,f){return k(),P("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:H(e.cls),style:J(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...l)=>e.onClick&&e.onClick(...l))},n[1]||(n[1]=[m("path",{d:"M20.272 11.27 7.544 23.998l12.728 12.728M43 24H8.705"},null,-1)]),14,it)}var pe=Y(ot,[["render",at]]);const rt=Object.assign(pe,{install:(e,n)=>{var i;const r=(i=n==null?void 0:n.iconPrefix)!=null?i:"";e.component(r+pe.name,pe)}}),st=K({name:"IconDownload",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const i=Q("icon"),r=z(()=>[i,`${i}-download`,{[`${i}-spin`]:e.spin}]),p=z(()=>{const l={};return e.size&&(l.fontSize=ee(e.size)?`${e.size}px`:e.size),e.rotate&&(l.transform=`rotate(${e.rotate}deg)`),l});return{cls:r,innerStyle:p,onClick:l=>{n("click",l)}}}}),ut=["stroke-width","stroke-linecap","stroke-linejoin"];function ct(e,n,i,r,p,f){return k(),P("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:H(e.cls),style:J(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...l)=>e.onClick&&e.onClick(...l))},n[1]||(n[1]=[m("path",{d:"m33.072 22.071-9.07 9.071-9.072-9.07M24 5v26m16 4v6H8v-6"},null,-1)]),14,ut)}var fe=Y(st,[["render",ct]]);const dt=Object.assign(fe,{install:(e,n)=>{var i;const r=(i=n==null?void 0:n.iconPrefix)!=null?i:"";e.component(r+fe.name,fe)}}),mt=K({name:"IconSave",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const i=Q("icon"),r=z(()=>[i,`${i}-save`,{[`${i}-spin`]:e.spin}]),p=z(()=>{const l={};return e.size&&(l.fontSize=ee(e.size)?`${e.size}px`:e.size),e.rotate&&(l.transform=`rotate(${e.rotate}deg)`),l});return{cls:r,innerStyle:p,onClick:l=>{n("click",l)}}}}),pt=["stroke-width","stroke-linecap","stroke-linejoin"];function ft(e,n,i,r,p,f){return k(),P("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:H(e.cls),style:J(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...l)=>e.onClick&&e.onClick(...l))},n[1]||(n[1]=[m("path",{d:"M21 13v9m18 20H9a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h22.55a1 1 0 0 1 .748.336l7.45 8.38a1 1 0 0 1 .252.664V41a1 1 0 0 1-1 1ZM14 6h14v15a1 1 0 0 1-1 1H15a1 1 0 0 1-1-1V6Z"},null,-1)]),14,pt)}var ge=Y(mt,[["render",ft]]);const gt=Object.assign(ge,{install:(e,n)=>{var i;const r=(i=n==null?void 0:n.iconPrefix)!=null?i:"";e.component(r+ge.name,ge)}}),vt=K({name:"IconSettings",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const i=Q("icon"),r=z(()=>[i,`${i}-settings`,{[`${i}-spin`]:e.spin}]),p=z(()=>{const l={};return e.size&&(l.fontSize=ee(e.size)?`${e.size}px`:e.size),e.rotate&&(l.transform=`rotate(${e.rotate}deg)`),l});return{cls:r,innerStyle:p,onClick:l=>{n("click",l)}}}}),kt=["stroke-width","stroke-linecap","stroke-linejoin"];function yt(e,n,i,r,p,f){return k(),P("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:H(e.cls),style:J(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...l)=>e.onClick&&e.onClick(...l))},n[1]||(n[1]=[m("path",{d:"M18.797 6.732A1 1 0 0 1 19.76 6h8.48a1 1 0 0 1 .964.732l1.285 4.628a1 1 0 0 0 1.213.7l4.651-1.2a1 1 0 0 1 1.116.468l4.24 7.344a1 1 0 0 1-.153 1.2L38.193 23.3a1 1 0 0 0 0 1.402l3.364 3.427a1 1 0 0 1 .153 1.2l-4.24 7.344a1 1 0 0 1-1.116.468l-4.65-1.2a1 1 0 0 0-1.214.7l-1.285 4.628a1 1 0 0 1-.964.732h-8.48a1 1 0 0 1-.963-.732L17.51 36.64a1 1 0 0 0-1.213-.7l-4.65 1.2a1 1 0 0 1-1.116-.468l-4.24-7.344a1 1 0 0 1 .153-1.2L9.809 24.7a1 1 0 0 0 0-1.402l-3.364-3.427a1 1 0 0 1-.153-1.2l4.24-7.344a1 1 0 0 1 1.116-.468l4.65 1.2a1 1 0 0 0 1.213-.7l1.286-4.628Z"},null,-1),m("path",{d:"M30 24a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z"},null,-1)]),14,kt)}var ve=Y(vt,[["render",yt]]);const bt=Object.assign(ve,{install:(e,n)=>{var i;const r=(i=n==null?void 0:n.iconPrefix)!=null?i:"";e.component(r+ve.name,ve)}}),Ct=K({name:"IconOrderedList",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const i=Q("icon"),r=z(()=>[i,`${i}-ordered-list`,{[`${i}-spin`]:e.spin}]),p=z(()=>{const l={};return e.size&&(l.fontSize=ee(e.size)?`${e.size}px`:e.size),e.rotate&&(l.transform=`rotate(${e.rotate}deg)`),l});return{cls:r,innerStyle:p,onClick:l=>{n("click",l)}}}}),$t=["stroke-width","stroke-linecap","stroke-linejoin"];function wt(e,n,i,r,p,f){return k(),P("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:H(e.cls),style:J(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...l)=>e.onClick&&e.onClick(...l))},n[1]||(n[1]=[m("path",{d:"M13 24h30M13 37h30M13 11h30"},null,-1),m("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.578 13.06v1.695h5.041V13.06H9.164V7.555H7.748L5.255 8.968l.763 1.513 1.114-.636v3.215H5.578ZM5.37 26.205v1.49h5.07V26H7.964l.94-.94c.454-.44.783-.86.982-1.258.199-.404.298-.826.298-1.266 0-.686-.224-1.225-.683-1.6-.45-.372-1.093-.55-1.912-.55-.473 0-.933.072-1.38.214a3.63 3.63 0 0 0-1.133.582l-.066.053.652 1.533.113-.085c.263-.199.524-.345.783-.44.266-.094.524-.141.774-.141.309 0 .52.06.652.165.128.1.198.252.198.477 0 .177-.05.356-.154.54l-.001.002c-.099.186-.274.416-.528.69L5.37 26.205ZM10.381 38.344c0-.443-.118-.826-.358-1.145a1.702 1.702 0 0 0-.713-.56 1.652 1.652 0 0 0 .586-.52 1.73 1.73 0 0 0 .307-1.022c0-.404-.108-.763-.327-1.074a2.076 2.076 0 0 0-.918-.71c-.386-.166-.833-.247-1.34-.247-.48 0-.952.071-1.417.213-.459.134-.836.318-1.127.554l-.065.053.652 1.486.11-.076c.275-.193.563-.34.863-.442h.002c.3-.109.581-.162.844-.162.266 0 .454.065.579.18l.004.002c.128.107.198.262.198.48 0 .201-.07.33-.197.412-.138.089-.376.141-.733.141h-1.01v1.626h1.188c.371 0 .614.056.75.15.127.085.2.23.2.463 0 .254-.078.412-.21.503l-.002.002c-.136.097-.386.157-.777.157-.595 0-1.194-.199-1.8-.605l-.11-.073-.65 1.483.064.053c.285.236.662.424 1.127.565h.002c.465.136.95.203 1.456.203.852 0 1.538-.178 2.045-.546.517-.377.777-.896.777-1.544Z",fill:"currentColor",stroke:"none"},null,-1)]),14,$t)}var ke=Y(Ct,[["render",wt]]);const $e=Object.assign(ke,{install:(e,n)=>{var i;const r=(i=n==null?void 0:n.iconPrefix)!=null?i:"";e.component(r+ke.name,ke)}}),Ft=K({name:"IconPen",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const i=Q("icon"),r=z(()=>[i,`${i}-pen`,{[`${i}-spin`]:e.spin}]),p=z(()=>{const l={};return e.size&&(l.fontSize=ee(e.size)?`${e.size}px`:e.size),e.rotate&&(l.transform=`rotate(${e.rotate}deg)`),l});return{cls:r,innerStyle:p,onClick:l=>{n("click",l)}}}}),ht=["stroke-width","stroke-linecap","stroke-linejoin"];function xt(e,n,i,r,p,f){return k(),P("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:H(e.cls),style:J(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...l)=>e.onClick&&e.onClick(...l))},n[1]||(n[1]=[m("path",{d:"m28.364 11.565 7.07 7.071M7.15 32.778 33.313 6.615l7.071 7.071L14.221 39.85h-7.07v-7.07Z"},null,-1)]),14,ht)}var ye=Y(Ft,[["render",xt]]);const _t=Object.assign(ye,{install:(e,n)=>{var i;const r=(i=n==null?void 0:n.iconPrefix)!=null?i:"";e.component(r+ye.name,ye)}}),St=()=>({title:"",bgColor:"#FFFFFF"}),le=q();function Dt(e){const r=[10,10],p=20,f=1/0,l=2,v={x:null,y:null},g={x:null,y:null,i:null};let a=null,u=!0;const C=F=>{!le.value||!u||(v.x=F.clientX,v.y=F.clientY,$(le.value),u=!1,setTimeout(()=>{u=!0},100))};function $(F){var te;const N=document.querySelector(".gridlayout"),D=N.getBoundingClientRect();let A=!1;const M=v.x-D.left,V=v.y-D.top;if(v.x>D.left&&v.x<D.right&&v.y>D.top&&v.y<D.bottom&&(A=!0),A&&a===null){a=W.randomString();const _={x:e.layout.length*2%12,y:e.layout.length+12,w:F.w||2,h:F.h||2,i:a,title:F.title,data:{attrForm:St(),dataForm:((te=F.generateData)==null?void 0:te.call(F))||{},triggerForm:{},eventForm:{}},components:F.components};e.layout.push(_)}const h=e.layout.findIndex(_=>_.i===a);if(h!==-1){const _=N.children[h],ue={top:V,left:M};_.dragging=ue;const G=U(V,M,D.width);A&&(e.gridlayoutRef.dragEvent("dragstart",a,G.x,G.y,F.h||2,F.w||2),g.i=String(h),g.x=e.layout[h].x,g.y=e.layout[h].y),A||(e.gridlayoutRef.dragEvent("dragend",a,G.x,G.y,F.h||2,F.w||2),e.layout.splice(h,1),a=null)}}function Z(){const N=document.querySelector(".gridlayout").getBoundingClientRect();let D=!1;v.x>N.left&&v.x<N.right&&v.y>N.top&&v.y<N.bottom&&(D=!0),D===!0&&(e.gridlayoutRef.dragEvent("dragend",a,g.x,g.y,2,2),a=null),S()}function U(F,N,D){const A=(D-r[0]*13)/12;let M=Math.round((N-r[0])/(A+r[0])),V=Math.round((F-r[1])/(p+r[1]));return M=Math.max(Math.min(M,10),0),V=Math.max(Math.min(V,f-l),0),{x:M,y:V}}function S(){le.value=null,document.removeEventListener("dragover",C),document.removeEventListener("mousemove",C),document.removeEventListener("click",Z)}return De(S),{rowHeight:p,drag:$,dragend:Z,dragover:C}}const Bt={class:"list"},It={class:"title"},Lt={style:{"margin-left":"10px"}},zt={class:"com"},Pt=["onDragstart","onClick"],Nt={style:{"margin-left":"10px"}},jt={__name:"comList",props:{layout:Array,gridlayoutRef:Object},setup(e){const n=e,{dragend:i,dragover:r}=Dt(n);function p(l){le.value=l,document.addEventListener("mousemove",r,!1),setTimeout(()=>document.addEventListener("click",i,!1))}function f(l){document.addEventListener("dragover",r,!1),le.value=l}return(l,v)=>(k(),P("div",Bt,[(k(!0),P(be,null,Ce(c(Ke),(g,a)=>(k(),P("div",{key:a,class:"item"},[m("div",It,[t(c($e)),m("span",Lt,ne(g.title),1)]),m("div",zt,[(k(!0),P(be,null,Ce(g.children,(u,C)=>(k(),P("div",{key:C,draggable:"true",unselectable:"on",class:"com-item",onDragstart:$=>f(u),onDragend:v[0]||(v[0]=(...$)=>c(i)&&c(i)(...$)),onClick:$=>p(u)},[t(c($e)),m("span",Nt,ne(u.title),1)],40,Pt))),128))])]))),128))]))}},Et=Le(jt,[["__scopeId","data-v-980f79a5"]]);function Tt(e){return e.slice(1,e.length)}const At=Reflect.construct(tt,[]),Se={A429Bus:"A429",A825Bus:"A825",AnalogParam:"Analog",DiscreteParam:"Discrete",SerialMessage:"Serial",TCP_UDPMessage:"TCP_UDP",UserProtocolMessage:"UserProtocol",A664VirtualLink:"A664"};function ze({sourceChild:e,tagName:n,level:i=0,protocolType:r,parentNames:p=[],params:f={}}){return e.map(l=>{const v=[],g={},a=nt(n),u=l[`_${a.nameKey}`],C=p.concat([u]),$={};Object.keys(l).forEach(S=>{S.toLocaleUpperCase().includes("NAME")&&S!=="_DisplayName"&&($[S.slice(1)]=l[S])});const Z=Object.assign({},f,$);for(const S of Object.keys(l))Array.isArray(l[S])&&!["Tag"].includes(S)?v.push(...ze({sourceChild:l[S],tagName:S,level:i+1,protocolType:r,parentNames:C,params:Z})):g[Tt(S)]=l[S];const U={label:u,uuid:l._GUID||W.randomString(),level:i+1,parentNames:p,protocolType:r,children:v,...g};return U.ParamName&&(Reflect.deleteProperty(U,"children"),Object.assign(U,f)),U})}function Mt(){const{appContext:e}=we(),{$message:n}=e.config.globalProperties,i=q();function r(){W.getFiles(([p])=>{const f=new FileReader;f.readAsText(p,"utf-8"),f.onload=function(l){try{const v=At.xml2js(l.target.result),g=Object.values(v)[0],a=Object.keys(g).map(u=>({label:u,uuid:W.randomString(),level:0,children:ze({sourceChild:g[u],tagName:u,level:0,parentNames:[Se[u]],protocolType:Se[u]})}));console.log(a),i.value=a}catch(v){i.value=[],n.error(String(v)||"解析文件错误")}}},".icdconfig")}return Be("treeData",i),{importICD:r,treeData:i}}function Ut(e){const{appContext:n}=we(),{$modal:i}=n.config.globalProperties,r=Ie();function p(){const v=(a,u=[])=>{for(const C of u){if(C.uuid===a)return C;const $=v(a,C.children||[]);if($)return $}return null};function g(a,u){const C=v(a,e.value);if(!C)return console.error("未找到Parameter");u.parameter=C}i.open({title:"事件注册",width:800,okText:"确认",cancelText:"取消",titleAlign:"start",draggable:!0,content:()=>t(s("a-tabs"),{type:"capsule"},{default:()=>[t(s("a-tab-pane"),{key:"1",title:"触发器"},{default:()=>[t(s("el-table"),{data:R.triggerTable,style:"width: 100%",height:"100%"},{default:()=>[t(s("el-table-column"),{label:"触发器名称",align:"center"},{default:({row:a,$index:u})=>t(s("a-input"),{"model-value":a.name,"onUpdate:model-value":C=>a.name=C,"default-value":`触发器${u+1}`},null)}),t(s("el-table-column"),{label:"触发类型",align:"center"},{default:({row:a})=>t(s("a-select"),{"model-value":a.triggerType,"onUpdate:model-value":u=>a.triggerType=u,"default-value":1},{default:()=>[t(s("a-option"),{value:1},{default:()=>[B("消息触发")]})]})}),t(s("el-table-column"),{label:"消息名",align:"center"},{default:({row:a})=>t(s("a-tree-select"),{"model-value":a.parameterSelect,"onUpdate:model-value":u=>a.parameterSelect=u,"allow-search":!0,"allow-clear":!0,data:e.value,placeholder:"请选择绑定的Parameter",fieldNames:{key:"uuid",title:"label"},onChange:u=>g(u,a)},null)}),t(s("el-table-column"),{label:"消息值",align:"center"},{default:({row:a})=>t(s("a-input"),{"model-value":a.msgValue,"onUpdate:model-value":u=>a.msgValue=u,placeholder:"请输入消息值"},null)}),t(s("el-table-column"),{label:"操作",align:"center"},{default:({row:a})=>t(_e,{style:"cursor: pointer;font-size: 22px",onClick:()=>R.triggerTable.splice(a.$index,1)},null)})],append:()=>t("div",{style:" padding: 5px;display: flex;justify-content: flex-end"},[t(s("a-button"),{type:"primary",status:"success",onClick:f},{default:()=>[B("添加")]})])})]}),t(s("a-tab-pane"),{key:"2",title:"动作"},{default:()=>[t(s("el-table"),{data:R.eventTable,style:"width: 100%",height:"100%"},{default:()=>[t(s("el-table-column"),{label:"动作名称",align:"center"},{default:({row:a,$index:u})=>t(s("a-input"),{"model-value":a.name,"onUpdate:model-value":C=>a.name=C,"default-value":`动作${u+1}`},null)}),t(s("el-table-column"),{label:"动作类型",align:"center"},{default:({row:a})=>t(s("a-select"),{"model-value":a.triggerType,"onUpdate:model-value":u=>a.triggerType=u,"default-value":1},{default:()=>[t(s("a-option"),{value:1},{default:()=>[B("设置消息")]})]})}),t(s("el-table-column"),{label:"消息名",align:"center"},{default:({row:a})=>t(s("a-tree-select"),{"model-value":a.parameterSelect,"onUpdate:model-value":u=>a.parameterSelect=u,"allow-search":!0,"allow-clear":!0,data:e.value,placeholder:"请选择绑定的Parameter",fieldNames:{key:"uuid",title:"label"},onChange:u=>g(u,a)},null)}),t(s("el-table-column"),{label:"消息值",align:"center"},{default:({row:a})=>t(s("a-input"),{"model-value":a.msgValue,"onUpdate:model-value":u=>a.msgValue=u,placeholder:"请输入消息值"},null)}),t(s("el-table-column"),{label:"操作",align:"center"},{default:({row:a})=>t(_e,{style:"cursor: pointer;font-size: 22px",onClick:()=>R.eventTable.splice(a.$index,1)},null)})],append:()=>t("div",{style:" padding: 5px;display: flex;justify-content: flex-end"},[t(s("a-button"),{type:"primary",status:"success",onClick:l},{default:()=>[B("添加")]})])})]})]}),onOk:()=>{window.getDBItem("controlList").then(a=>{const u=a.find(C=>C.id===r.query.id);if(!u)return console.error("没有找到该控件");Object.assign(u,{triggerTable:R.triggerTable,eventTable:R.eventTable}),window.setDBItem("controlList",W.clone(a))})}})}function f(){R.triggerTable.push({})}function l(){R.eventTable.push({})}return{createEvent:p}}const Vt={class:"g-layout"},Ot={class:"menu-tool"},Rt={class:"menu-btn"},Wt={class:"fold-tool"},qt={class:"grid-layout-main"},Ht={class:"com-box"},Zt={class:"com-tool"},Gt={class:"attr-settings"},Xt={style:{"margin-left":"5px"}},Yt={__name:"controlEdit",setup(e){const{appContext:n}=we(),{$modal:i,$message:r}=n.config.globalProperties;Be("environment","EDIT");const p=q(),f=q({}),l=q({}),v=Ie(),g=Je(),{importFile:a,exportFile:u,saveToSystem:C}=Qe(),$=Oe({size:.6,isFold:!1});function Z(){$.isFold=!$.isFold}function U(){window.open(`${location.origin}/preview?id=${v.query.id}`)}function S(y){const o=y.x+1,x=y.y+1,I={w:y.w,h:y.h,x:o,y:x,title:y.title,i:W.randomString(),data:W.clone(y.data),components:y.components};g.content.push(I)}const{importICD:F,treeData:N}=Mt(),{createEvent:D}=Ut(N),A=z({get(){return $.isFold?$.size:1},set(y){$.size=y}}),M=Re();function V(y){M.warning({title:"警告",content:()=>"确认删除吗?",positiveText:"确认",negativeText:"取消",negativeButtonProps:{size:"medium"},positiveButtonProps:{size:"medium"},transformOrigin:"center",autoFocus:!1,onPositiveClick(){g.content.splice(y,1),p.value.layoutUpdate()}})}const h=q(null);function te(y){h.value=y,y&&(f.value=y.data.attrForm,l.value=y.data.dataForm)}const _=q({});function ue(){var y,o;_.value={title:g.title,verticalCompact:((y=g.settings)==null?void 0:y.verticalCompact)||!1,preventCollision:((o=g.settings)==null?void 0:o.preventCollision)||!1},i.open({title:"页面设置",width:700,okText:"确认",cancelText:"取消",titleAlign:"start",draggable:!0,content:()=>t(s("a-form"),{model:_.value},{default:()=>[t(s("a-form-item"),{field:"title",tooltip:"请填写页面标题",label:"标题"},{default:()=>[t(s("a-input"),{modelValue:_.value.title,"onUpdate:modelValue":x=>_.value.title=x,placeholder:"请填写页面标题"},null)]}),t(s("a-form-item"),{field:"verticalCompact",tooltip:"启用垂直压缩将会导致布局变化",label:"启用垂直压缩"},{default:()=>[t(s("a-switch"),{modelValue:_.value.verticalCompact,"onUpdate:modelValue":x=>_.value.verticalCompact=x},null)]}),t(s("a-form-item"),{field:"preventCollision",tooltip:"开启后, 拖动组件将不会改变别的组件的位置",label:"防止碰撞"},{default:()=>[t(s("a-switch"),{modelValue:_.value.preventCollision,"onUpdate:modelValue":x=>_.value.preventCollision=x},null)]})]}),onBeforeOk:G})}function G(){return new Promise((y,o)=>{const x=_.value.title;if(!x)return r.error("请填写页面标题"),o(Error("请填写页面标题"));window.getDBItem("controlList").then(I=>{if(I.some(X=>X.title===x&&X.id!==v.query.id))return r.error("标题已存在"),o(Error("标题已存在"));const O=I.find(X=>X.id===v.query.id);if(!O)return o(Error("找不到页面"));O.title=x,O.settings||(O.settings={}),Object.assign(O.settings,{verticalCompact:_.value.verticalCompact,preventCollision:_.value.preventCollision}),Object.assign(g,{title:x,settings:O.settings}),window.setDBItem("controlList",W.clone(I)),r.success("保存成功"),setTimeout(p.value.layoutUpdate),y()})})}const Pe=y=>y.preventDefault();De(()=>window.removeEventListener("beforeunload",Pe));const Fe=We(),Ne=Fe.back.bind(Fe);return qe((y,o,x)=>{if(et())return x();M.warning({title:"提醒",content:()=>"要保存这些更改吗?",positiveText:"确认",negativeText:"取消",negativeButtonProps:{size:"medium"},positiveButtonProps:{size:"medium"},transformOrigin:"center",async onPositiveClick(){return await C(p.value.$el),x()},onNegativeClick:()=>x()})}),(y,o)=>{const x=s("NPopover"),I=s("NTooltip"),O=s("grid-item"),X=s("grid-layout"),je=s("a-input"),he=s("a-checkbox"),ce=s("a-form-item"),Ee=s("el-color-picker"),Te=s("a-form"),oe=s("a-empty"),ie=s("a-tab-pane"),Ae=s("a-tabs"),Me=s("a-split");return k(),L(Me,{size:A.value,"onUpdate:size":o[12]||(o[12]=w=>A.value=w),style:{height:"100%"},disabled:!$.isFold},{first:d(()=>{var w,j,E,T;return[m("div",Vt,[m("div",Ot,[t(c(me),{align:"center"},{default:d(()=>[t(c(rt),{style:{cursor:"pointer"},onClick:c(Ne)},null,8,["onClick"]),t(x,{placement:"bottom",delay:0,"display-directive":"show"},{trigger:d(()=>[m("span",Rt,[t(c($e)),o[13]||(o[13]=m("span",{style:{"margin-left":"10px"}},"添加组件",-1))])]),default:d(()=>[t(Et,{layout:c(g).content,"onUpdate:layout":o[0]||(o[0]=b=>c(g).content=b),gridlayoutRef:p.value},null,8,["layout","gridlayoutRef"])]),_:1}),m("span",{class:"menu-btn",onClick:o[1]||(o[1]=(...b)=>c(F)&&c(F)(...b))},[t(c(xe)),o[14]||(o[14]=m("span",{style:{"margin-left":"10px"}},"导入ICD文件",-1))]),m("span",{class:"menu-btn",onClick:o[2]||(o[2]=(...b)=>c(D)&&c(D)(...b))},[t(c(_t)),o[15]||(o[15]=m("span",{style:{"margin-left":"10px"}},"事件注册",-1))])]),_:1}),t(c(me),null,{default:d(()=>[t(I,null,{trigger:d(()=>[m("span",{class:"menu-btn",onClick:ue},[B(ne(c(g).title)+" ",1),t(c(bt))])]),default:d(()=>[o[16]||(o[16]=B(" 页面设置 "))]),_:1})]),_:1}),m("div",Wt,[t(c(me),null,{default:d(()=>[t(I,null,{trigger:d(()=>[m("div",{class:"menu-btn",onClick:o[3]||(o[3]=b=>c(C)(p.value.$el))},[t(c(gt))])]),default:d(()=>[o[17]||(o[17]=B(" 保存到系统 "))]),_:1}),t(I,null,{trigger:d(()=>[m("div",{class:"menu-btn",onClick:o[4]||(o[4]=(...b)=>c(a)&&c(a)(...b))},[t(c(xe))])]),default:d(()=>[o[18]||(o[18]=B(" 导入离线文件 "))]),_:1}),t(I,null,{trigger:d(()=>[m("div",{class:"menu-btn",onClick:o[5]||(o[5]=(...b)=>c(u)&&c(u)(...b))},[t(c(dt))])]),default:d(()=>[o[19]||(o[19]=B(" 导出离线文件 "))]),_:1}),t(I,null,{trigger:d(()=>[m("div",{class:"menu-btn",onClick:U},[t(c(lt))])]),default:d(()=>[o[20]||(o[20]=B(" 预览之前请先保存 "))]),_:1}),t(I,null,{trigger:d(()=>[m("div",{class:"menu-btn",onClick:re(Z,["stop"])},[$.isFold?(k(),L(c(Ze),{key:0})):(k(),L(c(Ge),{key:1}))])]),default:d(()=>[B(" "+ne($.isFold?"折叠":"展开"),1)]),_:1})]),_:1})])]),m("div",qt,[t(X,{ref_key:"gridlayoutRef",ref:p,layout:c(g).content,"onUpdate:layout":o[6]||(o[6]=b=>c(g).content=b),rowHeight:20,class:"gridlayout",isBounded:!0,verticalCompact:((w=c(g).settings)==null?void 0:w.verticalCompact)===void 0?!1:(j=c(g).settings)==null?void 0:j.verticalCompact,preventCollision:((E=c(g).settings)==null?void 0:E.preventCollision)===void 0?!1:(T=c(g).settings)==null?void 0:T.preventCollision,onClick:o[7]||(o[7]=b=>te(null))},{default:d(()=>[(k(!0),P(be,null,Ce(c(g).content,(b,Ue)=>(k(),L(O,{key:b.i,class:H(h.value===b?"active-item":""),i:b.i,x:b.x,y:b.y,w:b.w,h:b.h,onClick:re(de=>te(b),["stop"])},{default:d(()=>{var de;return[m("div",Ht,[(k(),L(ae((de=b.components)==null?void 0:de.model),{gridItem:b},null,8,["gridItem"])),m("div",Zt,[t(I,null,{trigger:d(()=>[t(c(Xe),{onClick:re(Ve=>S(b),["stop"])},null,8,["onClick"])]),default:d(()=>[o[21]||(o[21]=B(" 复制 "))]),_:2},1024),t(I,null,{trigger:d(()=>[t(c(Ye),{onClick:re(Ve=>V(Ue),["stop"])},null,8,["onClick"])]),default:d(()=>[o[22]||(o[22]=B(" 删除 "))]),_:2},1024)])])]}),_:2},1032,["class","i","x","y","w","h","onClick"]))),128))]),_:1},8,["layout","verticalCompact","preventCollision"])])])]}),second:d(()=>[m("div",Gt,[t(Ae,{type:"capsule"},{default:d(()=>[t(ie,{key:"1",title:"通用属性"},{default:d(()=>[h.value?(k(),L(Te,{key:0,"label-align":"left","auto-label-width":"",model:f.value},{default:d(()=>[t(ce,{tooltip:"组件显示的标题",label:"组件标题"},{default:d(()=>[m("div",null,[f.value.hiddenTitle?He("",!0):(k(),L(je,{key:0,"model-value":f.value.title,"onUpdate:modelValue":o[8]||(o[8]=w=>f.value.title=w),style:{"margin-bottom":"10px"}},null,8,["model-value"])),t(he,{"model-value":f.value.hiddenTitle,"onUpdate:modelValue":o[9]||(o[9]=w=>f.value.hiddenTitle=w)},{default:d(()=>o[23]||(o[23]=[B(" 隐藏标题 ")])),_:1},8,["model-value"])])]),_:1}),t(ce,{tooltip:"是否隐藏底部",label:"隐藏底部"},{default:d(()=>[t(he,{"model-value":f.value.hiddenFooter,"onUpdate:modelValue":o[10]||(o[10]=w=>f.value.hiddenFooter=w)},{default:d(()=>o[24]||(o[24]=[B(" 隐藏底部 ")])),_:1},8,["model-value"])]),_:1}),t(ce,{tooltip:"组件背景颜色",label:"背景颜色"},{default:d(()=>[t(Ee,{modelValue:f.value.bgColor,"onUpdate:modelValue":o[11]||(o[11]=w=>f.value.bgColor=w)},null,8,["modelValue"]),m("span",Xt,ne(f.value.bgColor),1)]),_:1})]),_:1},8,["model"])):(k(),L(oe,{key:1,description:"请选择组件"},{image:d(()=>o[25]||(o[25]=[m("img",{src:se},null,-1)])),_:1}))]),_:1}),t(ie,{key:"2",title:"组件数据"},{default:d(()=>{var w,j,E,T;return[(j=(w=h.value)==null?void 0:w.components)!=null&&j.data?(k(),L(ae((T=(E=h.value)==null?void 0:E.components)==null?void 0:T.data),{key:0,gridItem:h.value},null,8,["gridItem"])):(k(),L(oe,{key:1,description:"该组件不可定义数据"},{image:d(()=>o[26]||(o[26]=[m("img",{src:se},null,-1)])),_:1}))]}),_:1}),t(ie,{key:"3",title:"触发器"},{default:d(()=>{var w,j,E,T;return[(j=(w=h.value)==null?void 0:w.components)!=null&&j.trigger?(k(),L(ae((T=(E=h.value)==null?void 0:E.components)==null?void 0:T.trigger),{key:0,gridItem:h.value},null,8,["gridItem"])):(k(),L(oe,{key:1,description:"该组件不可定义触发器"},{image:d(()=>o[27]||(o[27]=[m("img",{src:se},null,-1)])),_:1}))]}),_:1}),t(ie,{key:"4",title:"事件交互"},{default:d(()=>{var w,j,E,T;return[(j=(w=h.value)==null?void 0:w.components)!=null&&j.event?(k(),L(ae((T=(E=h.value)==null?void 0:E.components)==null?void 0:T.event),{key:0,gridItem:h.value},null,8,["gridItem"])):(k(),L(oe,{key:1,description:"该组件不可定义事件"},{image:d(()=>o[28]||(o[28]=[m("img",{src:se},null,-1)])),_:1}))]}),_:1})]),_:1})])]),_:1},8,["size","disabled"])}}},an=Le(Yt,[["__scopeId","data-v-b07b7047"]]);export{an as default};
