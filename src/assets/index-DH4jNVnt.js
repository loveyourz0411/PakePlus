import{_ as q}from"./ctrl-center-select-D8u5Acl8.js";import{_ as H}from"./empty-SobI8E2D.js";import{s as U,O as J,r as l,b3 as X,j as P,f as Y,i as r,c as o,n as x,F as Q,a as c,K as W,g as C,z as w,$ as Z,L as ee,a1 as $,ac as te,a3 as ae,M as oe}from"./index-Dju9e0Mk.js";import{P as ne,A as se,D as re,g as j}from"./case-Dg8WzVaS.js";import{G as le}from"./project-6v6tL3Yb.js";import{u as ce,d as ie,g as pe,c as ue}from"./useCase-CD5o696P.js";import{g as de}from"./common-DqBIDsQy.js";import{I as me}from"./index-CCxppbjm.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-Cr7o0t0N.js";const ge={class:"main-content"},ve={style:{"padding-right":"10px"}},_e={__name:"index",setup(ye){const h=W(),{appContext:B}=U(),{$message:u}=B.config.globalProperties,F=J(),g=l([]);function N(t){t.preventDefault(),t.stopPropagation()}const{convertCase:T}=ce(),L=({option:{type:t}})=>t===2?o(me,{size:"19"},null):o(ee,{size:"16"},null),G={type:0,parentId:0,name:"",version:"",desiredResult:"",time:0,remark:"",path:"",code:"",projectId:0};function d(){j({type:2}).then(t=>{g.value=t.data||[]})}X(d);function v({parentId:t,id:e}={}){Z.prompt("请输入用例组名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info",beforeClose:(a,{inputValue:n},i)=>{if(a==="cancel")return i();if(!(n||"").trim())return this.$message.error("不能为空");i()}}).then(({value:a})=>{const n={...G,name:a,parentId:t||0,type:2,id:e};(e?ne:se)(n).then(p=>{if(p.code!==200)return u.error(p.errMsg||"操作失败");d(),u.success(p.msg||"操作成功")})}).catch(()=>{})}let s=null;const m=l(!1),f=P([]),D=l(0),b=l(0);function S(t,{operate:e}){switch(e){case"add-group":v({parentId:s.ID});break;case"edit-group":v({id:s.ID});break;case"add-case":h.push({name:"caseForm",query:{parentId:s.ID,groupName:s.name}});break;case"edit-case":sessionStorage.setItem("case",JSON.stringify(s)),h.push({name:"caseForm",query:{id:s.ID}});break;case"del-group":case"del-case":F.warning({title:"警告",content:()=>"确认删除这些数据?这将不可恢复",positiveText:"确认",negativeText:"取消",autoFocus:!1,onPositiveClick(){re([s.ID]).then(a=>{if(a.code!==200)return u.error(a.errMsg||"操作失败");d(),u.success(a.msg||"操作成功")})}});break;case"import-pricase":M(s.ID);break}m.value=!1}function z(t){return new Promise(e=>{j({type:3,projectId:t.id}).then(a=>{t.children=a.data||[],e()})})}async function M(t=0){const{data:e=[]}=await le(),a=P(e.map(n=>({ID:`project-${n.id}`,name:n.projectName,id:n.id,isLeaf:!1})));T(a,{type:0,projectId:0,parentId:t},d,z)}function V({option:t}){return{onContextmenu(e){s=t,f.length=0,t.type===2&&f.push({label:"新增用例组",operate:"add-group",icon:()=>o($,null,null)},{label:"新增用例",operate:"add-case",icon:()=>o($,null,null)},{label:"从私有库导入",operate:"import-pricase",icon:()=>o(te,null,null)}),f.push({label:`修改${t.type===2?"用例组":"用例"}`,operate:`edit-${t.type===2?"group":"case"}`,icon:()=>o(ae,null,null)},{label:`删除${t.type===2?"用例组":"用例"}`,operate:`del-${t.type===2?"group":"case"}`,icon:()=>o(oe,null,null)}),m.value=!0,D.value=e.clientX,b.value=e.clientY,e.stopPropagation(),e.preventDefault()}}}const _=l({}),k=l([]);function R(t,[e]){const a=e.type===2;_.value=e,e.type===0&&de(e.path).then(n=>{_.value.code=n}),k.value=a?pe:ue}const y=l(""),A=[{clickHandle:()=>v(),img2Src:"images/create.png",bgColor:"#409eff",title:"新增用例组"}];return(t,e)=>{const a=c("BtnGroup"),n=c("a-input-search"),i=c("Tree"),p=c("a-empty"),E=c("a-split"),K=c("NDropdown");return C(),Y(Q,null,[r("div",ge,[e[3]||(e[3]=r("div",{class:"navHeader"},[r("div",{class:"img-box"},[r("img",{src:q})]),r("span",null,"公共用例库")],-1)),o(a,{data:A}),o(E,{"default-size":"300px",max:.8},{first:x(()=>{var I;return[r("div",{class:"main",onContextmenu:N},[r("div",ve,[o(n,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=O=>y.value=O),placeholder:"请输入查询关键字"},null,8,["modelValue"])]),(I=g.value)!=null&&I.length?(C(),w(i,{key:0,data:g.value,class:"Tree","node-props":V,"on-update:selected-keys":R,pattern:y.value,"render-prefix":L,"key-field":"ID","label-field":"name"},null,8,["data","pattern"])):(C(),w(p,{key:1},{image:x(()=>e[2]||(e[2]=[r("img",{src:H},null,-1)])),_:1}))],32)]}),second:x(()=>[o(ie,{data:_.value,infoColumn:k.value,column:1},null,8,["data","infoColumn"])]),_:1})]),o(K,{trigger:"manual",show:m.value,options:f,x:D.value,y:b.value,"z-index":99,onSelect:S,onClickoutside:e[1]||(e[1]=I=>m.value=!1)},null,8,["show","options","x","y"])],64)}}},je=fe(_e,[["__scopeId","data-v-7e7fe38b"]]);export{je as default};
