import{a4 as j,d as z,f as h,g as I,i as v,x as L,B as w,a5 as x,k,a6 as G,s as le,r as $,a8 as ne,c as a,n as c,a as g,y as E,G as T,m as y,z as ae,p as re,I as B,F as ie}from"./index-Dju9e0Mk.js";import{h as O}from"./http-Cr7o0t0N.js";import{a as se}from"./history-HliKBwvq.js";import{c as oe}from"./calculateTimeDifference-lnPCxxL5.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de=z({name:"IconPauseCircle",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:r}){const n=x("icon"),p=k(()=>[n,`${n}-pause-circle`,{[`${n}-spin`]:e.spin}]),b=k(()=>{const l={};return e.size&&(l.fontSize=G(e.size)?`${e.size}px`:e.size),e.rotate&&(l.transform=`rotate(${e.rotate}deg)`),l});return{cls:p,innerStyle:b,onClick:l=>{r("click",l)}}}}),ce=["stroke-width","stroke-linecap","stroke-linejoin"];function me(e,r,n,p,b,f){return I(),h("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:w(e.cls),style:L(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:r[0]||(r[0]=(...l)=>e.onClick&&e.onClick(...l))},r[1]||(r[1]=[v("path",{d:"M42 24c0 9.941-8.059 18-18 18S6 33.941 6 24 14.059 6 24 6s18 8.059 18 18Z"},null,-1),v("path",{d:"M19 19v10h1V19h-1ZM28 19v10h1V19h-1Z"},null,-1)]),14,ce)}var _=j(de,[["render",me]]);const pe=Object.assign(_,{install:(e,r)=>{var n;const p=(n=r==null?void 0:r.iconPrefix)!=null?n:"";e.component(p+_.name,_)}}),ve=z({name:"IconPlayCircle",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:r}){const n=x("icon"),p=k(()=>[n,`${n}-play-circle`,{[`${n}-spin`]:e.spin}]),b=k(()=>{const l={};return e.size&&(l.fontSize=G(e.size)?`${e.size}px`:e.size),e.rotate&&(l.transform=`rotate(${e.rotate}deg)`),l});return{cls:p,innerStyle:b,onClick:l=>{r("click",l)}}}}),fe=["stroke-width","stroke-linecap","stroke-linejoin"];function be(e,r,n,p,b,f){return I(),h("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:w(e.cls),style:L(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:r[0]||(r[0]=(...l)=>e.onClick&&e.onClick(...l))},r[1]||(r[1]=[v("path",{d:"M24 42c9.941 0 18-8.059 18-18S33.941 6 24 6 6 14.059 6 24s8.059 18 18 18Z"},null,-1),v("path",{d:"M19 17v14l12-7-12-7Z"},null,-1)]),14,fe)}var R=j(ve,[["render",be]]);const Ne=Object.assign(R,{install:(e,r)=>{var n;const p=(n=r==null?void 0:r.iconPrefix)!=null?n:"";e.component(p+R.name,R)}}),ge=z({name:"IconRecordStop",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:r}){const n=x("icon"),p=k(()=>[n,`${n}-record-stop`,{[`${n}-spin`]:e.spin}]),b=k(()=>{const l={};return e.size&&(l.fontSize=G(e.size)?`${e.size}px`:e.size),e.rotate&&(l.transform=`rotate(${e.rotate}deg)`),l});return{cls:p,innerStyle:b,onClick:l=>{r("click",l)}}}}),ke=["stroke-width","stroke-linecap","stroke-linejoin"];function Se(e,r,n,p,b,f){return I(),h("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:w(e.cls),style:L(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:r[0]||(r[0]=(...l)=>e.onClick&&e.onClick(...l))},r[1]||(r[1]=[v("path",{"clip-rule":"evenodd",d:"M24 6c9.941 0 18 8.059 18 18s-8.059 18-18 18S6 33.941 6 24 14.059 6 24 6Z"},null,-1),v("path",{d:"M19 20a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-8a1 1 0 0 1-1-1v-8Z",fill:"currentColor",stroke:"none"},null,-1),v("path",{d:"M19 20a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-8a1 1 0 0 1-1-1v-8Z"},null,-1)]),14,ke)}var M=j(ge,[["render",Se]]);const Ue=Object.assign(M,{install:(e,r)=>{var n;const p=(n=r==null?void 0:r.iconPrefix)!=null?n:"";e.component(p+M.name,M)}});function Te(e){return O.post("/VIPSystem/api/auto_test/run_task",e)}function D(e){return O.post("/VIPSystem/api/auto_test/operate_task",e)}const ye={class:"main"},Ie={class:"dataform"},Pe={class:"main-content"},Ce={class:"record-name"},he={__name:"run-task",setup(e){const r=ne();let n=JSON.parse(sessionStorage.getItem("runList")||null);const{appContext:p}=le(),{$message:b}=p.config.globalProperties;let f=Number(sessionStorage.getItem("recordId")||0);const l=$(0);f&&P(),n||window.getDBItem(r.query.key).then(m=>{n=m,sessionStorage.setItem("runList",JSON.stringify(n)),window.removeDBItem(r.query.key),N.value=n||[]});const N=$(n||[]),V=r.query.projectName,u=$({projectId:+r.query.projectId,startTime:"",endTime:"",excutePeroid:"",iserrStop:0,runCount:1,UUTPartNumber:"",UUTSerialNumber:"",UUTHWModNumber:"",UUTSWModNumber:"",ATEPartNumber:"",ATESerialNumber:""}),s={WAITING:0,RUNNING:1,PAUSED:2,STOPPED:3,PASS:4,FAIL:5},F={[s.WAITING]:"等待执行",[s.RUNNING]:"执行中",[s.PAUSED]:"已暂停",[s.STOPPED]:"已停止",[s.PASS]:"通过",[s.FAIL]:"失败"},Z=k(()=>({[s.WAITING]:"开始执行",[s.RUNNING]:"执行中",[s.PAUSED]:"继续执行",[s.STOPPED]:"重新执行",[s.PASS]:"重新执行",[s.FAIL]:"重新执行"})[l.value]),q=k(()=>[s.RUNNING,s.PAUSED].includes(l.value)?"yellow":l.value===s.PASS?"green":l.value===s.FAIL?"red":"white"),H=[{title:"所属任务",key:"taskName",align:"center",titleAlign:"center"},{title:"用例号",key:"tcId",align:"center",titleAlign:"center"},{title:"用例名称",key:"name",align:"center",titleAlign:"center"},{title:"下限值",key:"low_limit",align:"center",titleAlign:"center"},{title:"上限值",key:"high_limit",align:"center",titleAlign:"center"},{title:"测量值",key:"Value",align:"center",titleAlign:"center"},{title:"单位",key:"units",align:"center",titleAlign:"center"},{title:"结果",key:"result",align:"center",titleAlign:"center",render(m){return{0:l.value===s.PAUSED?"已暂停":l.value===s.STOPPED?"已停止":"等待中",1:l.value===s.PAUSED?"已暂停":l.value===s.STOPPED?"已停止":a(ie,null,[a(B,null,null),y("测试中")]),2:"通过",3:"失败"}[m.status||0]}}],J=()=>D({type:"pause",recordId:f}),X=()=>D({type:"stop",recordId:f});let U=0;function K(){if(!(n!=null&&n.length))return b.error("请先添加测试用例");if(l.value===s.PAUSED)return D({type:"continue",recordId:f}).then(P);U=0,l.value=s.RUNNING;const m=Number(u.value.runCount),t={orderList:[{...u.value,runCount:m,caseList:n.map(i=>({caseId:i.clone_ID,IP:i.IP}))}]};N.value=W(m),Te(t).then(i=>{if(i.code!==200)return b.error(i.errMsg||"操作失败");b.success(i.msg||"操作成功"),f=i.recordId[0],sessionStorage.setItem("recordId",f),l.value=s.RUNNING,P()})}function W(m=1){const t=[];for(let i=1;i<=m;i++)Array.prototype.push.apply(t,(n||[]).map(o=>Object.assign({},o,{runCount:i})));return t}function P(){se(f).then(m=>{if(m.code===200){const t=m.data;Object.assign(u.value,{startTime:t.startTime,endTime:t.endTime,excutePeroid:t.excutePeroid,iserrStop:t.ifErrStop?1:0,runCount:t.runCount,UUTPartNumber:t.UUTPartNumber,UUTSerialNumber:t.UUTSerialNumber,UUTHWModNumber:t.UUTHWModNumber,UUTSWModNumber:t.UUTSWModNumber,ATEPartNumber:t.ATEPartNumber,ATESerialNumber:t.ATESerialNumber}),t.runCount*n.length!==N.value.length&&(N.value=W(t.runCount));const i=t.cases;if(U=(i==null?void 0:i.length)||0,U?i.forEach((o,C)=>{const S=N.value[C];S&&(o.status===1?S.status=o.status:o.status===2&&(S.status=o.result==="Pass"?2:3,S.Value=o.output||o.errMsg))}):N.value.forEach(o=>{o.status=void 0,o.Value=void 0}),t.status){if(l.value=t.status,t.status===4){l.value=t.excuteResult==="Pass"?4:5,u.value.excutePeroid=oe({startTime:t.startTime,endTime:t.endTime});return}if([3].includes(t.status))return}}setTimeout(P,800)})}const Q=(m,t)=>{if(l.value===s.RUNNING){const o=N.value[t-1];if(t===U&&m.status===void 0&&(o==null?void 0:o.status)!==s.RUNNING||t===U-1&&m.status===s.RUNNING)return"hightlightRow"}let i="";return m.runCount!==void 0&&m.runCount%2===0&&(i="even-row"),`${["","hightlightRow","successRow","failRow"][m.status||0]} ${i}`};return(m,t)=>{const i=g("NInput"),o=g("NFormItem"),C=g("NRadio"),S=g("NRadioGroup"),Y=g("NDataTable"),A=g("NButton"),ee=g("NSpace"),te=g("a-split");return I(),h("div",ye,[a(te,{"default-size":350},{first:c(()=>[v("div",Ie,[t[11]||(t[11]=v("div",{class:"form-title"},"测试时间",-1)),a(o,{label:"开始时间","label-placement":"left","label-width":"130","label-align":"left"},{default:c(()=>[a(i,{value:u.value.startTime,"onUpdate:value":t[0]||(t[0]=d=>u.value.startTime=d),disabled:"",placeholder:"测试开始时间"},null,8,["value"])]),_:1}),a(o,{label:"结束时间","label-placement":"left","label-width":"130","label-align":"left"},{default:c(()=>[a(i,{value:u.value.endTime,"onUpdate:value":t[1]||(t[1]=d=>u.value.endTime=d),disabled:"",placeholder:"测试结束时间"},null,8,["value"])]),_:1}),a(o,{label:"执行用时","label-placement":"left","label-width":"130","label-align":"left"},{default:c(()=>[a(i,{value:u.value.excutePeroid,"onUpdate:value":t[2]||(t[2]=d=>u.value.excutePeroid=d),disabled:"",placeholder:"执行用时"},null,8,["value"])]),_:1}),t[12]||(t[12]=v("div",{class:"form-title"},"被测设备属性",-1)),a(o,{label:"部件号","label-placement":"left","label-width":"130","label-align":"left"},{default:c(()=>[a(i,{value:u.value.UUTPartNumber,"onUpdate:value":t[3]||(t[3]=d=>u.value.UUTPartNumber=d),disabled:[1,2].includes(l.value),placeholder:"请输入部件号"},null,8,["value","disabled"])]),_:1}),a(o,{label:"序列号","label-placement":"left","label-width":"130","label-align":"left"},{default:c(()=>[a(i,{value:u.value.UUTSerialNumber,"onUpdate:value":t[4]||(t[4]=d=>u.value.UUTSerialNumber=d),disabled:[1,2].includes(l.value),placeholder:"请输入序列号"},null,8,["value","disabled"])]),_:1}),a(o,{label:"硬件版本号","label-placement":"left","label-width":"130","label-align":"left"},{default:c(()=>[a(i,{value:u.value.UUTHWModNumber,"onUpdate:value":t[5]||(t[5]=d=>u.value.UUTHWModNumber=d),disabled:[1,2].includes(l.value),placeholder:"请输入硬件版本号"},null,8,["value","disabled"])]),_:1}),a(o,{label:"软件版本号","label-placement":"left","label-width":"130","label-align":"left"},{default:c(()=>[a(i,{value:u.value.UUTSWModNumber,"onUpdate:value":t[6]||(t[6]=d=>u.value.UUTSWModNumber=d),disabled:[1,2].includes(l.value),placeholder:"请输入软件版本号"},null,8,["value","disabled"])]),_:1}),t[13]||(t[13]=v("div",{class:"form-title"},"试验台",-1)),a(o,{label:"部件号","label-placement":"left","label-width":"130","label-align":"left"},{default:c(()=>[a(i,{value:u.value.ATEPartNumber,"onUpdate:value":t[7]||(t[7]=d=>u.value.ATEPartNumber=d),disabled:[1,2].includes(l.value),placeholder:"请输入部件号"},null,8,["value","disabled"])]),_:1}),a(o,{label:"序列号","label-placement":"left","label-width":"130","label-align":"left"},{default:c(()=>[a(i,{value:u.value.ATESerialNumber,"onUpdate:value":t[8]||(t[8]=d=>u.value.ATESerialNumber=d),disabled:[1,2].includes(l.value),placeholder:"请输入序列号"},null,8,["value","disabled"])]),_:1}),t[14]||(t[14]=v("div",{class:"form-title"},"测试信息",-1)),a(o,{label:"错误是否停止","label-placement":"left","label-width":"130","label-align":"left"},{default:c(()=>[a(S,{value:u.value.iserrStop,"onUpdate:value":t[9]||(t[9]=d=>u.value.iserrStop=d),disabled:[1,2].includes(l.value),name:"iserrStop"},{default:c(()=>[a(C,{value:1,"default-checked":!0,label:"是"}),a(C,{value:0,label:"否"})]),_:1},8,["value","disabled"])]),_:1}),a(o,{label:"执行次数","label-placement":"left","label-width":"130","label-align":"left"},{default:c(()=>[a(i,{value:u.value.runCount,"onUpdate:value":t[10]||(t[10]=d=>u.value.runCount=d),valueModifiers:{number:!0},disabled:[1,2].includes(l.value),placeholder:"请输入执行次数"},null,8,["value","disabled"])]),_:1})]),v("div",{class:w(["all-status",q.value])},[v("div",null,[l.value===s.RUNNING?(I(),ae(T(B),{key:0})):re("",!0),y(" "+E(F[l.value]),1)])],2)]),second:c(()=>[v("div",Pe,[v("div",Ce,E(T(V)),1),a(Y,{columns:H,data:N.value,"row-class-name":Q,"max-height":"calc(100vh - 210px)"},null,8,["data"]),a(ee,{style:{"margin-top":"20px"},justify:"end"},{default:c(()=>[a(A,{disabled:[s.RUNNING].includes(l.value),type:"primary",round:"",onClick:K},{icon:c(()=>[a(T(Ne))]),default:c(()=>[y(" "+E(Z.value),1)]),_:1},8,["disabled"]),a(A,{disabled:[0,2,3,4,5].includes(l.value),type:"info",round:"",color:"#78909C",onClick:J},{icon:c(()=>[a(T(pe))]),default:c(()=>[t[15]||(t[15]=y(" 暂停 "))]),_:1},8,["disabled"]),a(A,{type:"warning",disabled:[0,3,4,5].includes(l.value),color:"#EF5350",round:"",onClick:X},{icon:c(()=>[a(T(Ue))]),default:c(()=>[t[16]||(t[16]=y(" 停止 "))]),_:1},8,["disabled"])]),_:1})])]),_:1})])}}},Re=ue(he,[["__scopeId","data-v-21f65ee0"]]);export{Re as default};
