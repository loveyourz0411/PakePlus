import{_ as h}from"./auto-test-select-DqLsCXzn.js";import{s as A,r as y,a8 as B,z as j,n as o,a as m,K as E,g as M,i as n,m as d,y as G,c as l,G as H}from"./index-Dju9e0Mk.js";import{o as J,C as N,p as K,E as L,T as O}from"./index-DBfl91b8.js";import{u as c}from"./util-CASLgOZv.js";import{g as Q,U as W}from"./common-DqBIDsQy.js";import{P as X,A as Y}from"./case-Dg8WzVaS.js";import{c as b}from"./defaultParam-mXCUOp30.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-Cr7o0t0N.js";const ee={class:"main-content main"},te={class:"navHeader"},le={class:"child-text"},oe={class:"form-box"},ae={class:"code-box"},re={class:"codemirror-box"},ie={class:"footer"},se={__name:"caseForm",setup(ne){const{appContext:I}=A(),{$message:g}=I.config.globalProperties,C=new N,U=new N,S=E(),q=B(),t=y(b()),T=[J,C.of(K()),U.of(L.tabSize.of(8))],v=y(!1);function k(){c.getFiles(([r])=>{const e=new FileReader;e.readAsText(r,"utf-8"),e.onload=function(s){t.value.code=s.target.result||""}})}const V=y(),z={tcId:{type:"string",required:!0,message:"请填写Test Id"},name:{type:"string",required:!0,message:"请填写用例名称"},version:{type:"string",required:!0,message:"请填写用例版本"},low_limit:{required:!0,validator(r,e){if(r){if(isNaN(+r))return e("请输入数字");if(Number(t.value.high_limit)<Number(r))return e("最小值不能大于最大值")}else return e("请填写用例输)出的最小值");return e()}},high_limit:{required:!0,validator(r,e){if(r){if(isNaN(+r))return e("请输入数字");if(Number(t.value.low_limit)>Number(r))return e("最小值不能大于最大值")}else return e("请填写用例输)出的最小值");return V.value.validateField("low_limit"),e()}},dataType:{type:"string",required:!0,message:"请选择用例输出的数据类型"},code:{type:"string",required:!0,message:"请填写用例代码"}},{parentId:R,id:D,projectId:x,type:w}=q.query;if(D){const r=JSON.parse(sessionStorage.getItem("case"));t.value=b({...r,id:r.ID}),Q(t.value.path).then(e=>{t.value.code=e})}else t.value=b({parentId:+R,projectId:x?+x:0,type:w?+w:0});function F(){S.back()}function P(){V.value.validate(async r=>{if(r)return;v.value=!0;const e={...t.value,time:+t.value.time},s=e.id?X:Y;let i="";e.id?i=e.path.split("/").at(-1)||`pyFile-${c.randomString()}.py`:i=`pyFile-${c.randomString()}.py`;const p=new File([e.code],i,{type:"text/plain"}),_=new FormData;_.append("file",p);const u=await W(_);if(u.code!==200)return v.value=!1,g.error(u.errMsg||"上传文件失败");e.path=u.data.filePath,delete e.code,s(e).then(f=>{if(v.value=!1,f.code!==200)return g.error(f.errMsg||"操作失败");g.success(f.msg||"操作成功"),F()})})}return(r,e)=>{const s=m("a-input"),i=m("a-form-item"),p=m("a-option"),_=m("a-select"),u=m("a-button"),f=m("a-form"),$=m("NSpin");return M(),j($,{show:v.value},{description:o(()=>e[20]||(e[20]=[d(" 正在提交信息 ")])),default:o(()=>[n("div",ee,[n("div",te,[e[11]||(e[11]=n("div",{class:"img-box"},[n("img",{src:h})],-1)),n("span",null,[e[10]||(e[10]=d("自动化测试 / ")),n("span",le,G(t.value.id?"修改":"新增")+"用例",1)])]),n("div",oe,[l(f,{ref_key:"dataFormRef",ref:V,"scroll-to-first-error":!0,rules:z,model:t.value,size:"large",layout:"vertical"},{default:o(()=>[l(i,{field:"tcId",label:"用例号",tooltip:"用例号"},{default:o(()=>[l(s,{modelValue:t.value.tcId,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.tcId=a),placeholder:"请输入用例号"},null,8,["modelValue"])]),_:1}),l(i,{field:"name",label:"用例名称",tooltip:"用例名称"},{default:o(()=>[l(s,{modelValue:t.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.name=a),placeholder:"请输入用例名称"},null,8,["modelValue"])]),_:1}),l(i,{field:"version",label:"用例版本",tooltip:"版本号 建议纯数字"},{default:o(()=>[l(s,{modelValue:t.value.version,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.version=a),placeholder:"请输入用例版本"},null,8,["modelValue"])]),_:1}),l(i,{label:"测试预估时间",field:"time"},{default:o(()=>[l(s,{modelValue:t.value.time,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.time=a),placeholder:"请输入测试预估时间"},{append:o(()=>e[12]||(e[12]=[d(" 秒 ")])),_:1},8,["modelValue"])]),_:1}),l(i,{field:"remark",label:"用例描述"},{default:o(()=>[l(s,{modelValue:t.value.remark,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.remark=a),placeholder:"请输入用例描述"},null,8,["modelValue"])]),_:1}),l(i,{field:"low_limit",label:"最小值",tooltip:"用例输出的预期范围的最小值,用来判定用例的执行成功与否"},{default:o(()=>[l(s,{modelValue:t.value.low_limit,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.low_limit=a),placeholder:"请输入用例输出最小值"},null,8,["modelValue"])]),_:1}),l(i,{field:"high_limit",label:"最大值",tooltip:"用例输出的预期范围的最大值,用来判定用例的执行成功与否"},{default:o(()=>[l(s,{modelValue:t.value.high_limit,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.high_limit=a),placeholder:"请输入用例输出最大值"},null,8,["modelValue"])]),_:1}),l(i,{field:"units",label:"单位"},{default:o(()=>[l(s,{modelValue:t.value.units,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.units=a),placeholder:"请输入单位"},null,8,["modelValue"])]),_:1}),l(i,{field:"dataType",label:"数据类型"},{default:o(()=>[l(_,{modelValue:t.value.dataType,"onUpdate:modelValue":e[8]||(e[8]=a=>t.value.dataType=a),placeholder:"请选择用例输出的数据类型"},{default:o(()=>[l(p,null,{default:o(()=>e[13]||(e[13]=[d("string")])),_:1}),l(p,null,{default:o(()=>e[14]||(e[14]=[d("int")])),_:1}),l(p,null,{default:o(()=>e[15]||(e[15]=[d("float")])),_:1}),l(p,null,{default:o(()=>e[16]||(e[16]=[d("bool")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,{field:"code",label:"用例代码",tooltip:'输出变量的标准格式:print("a=1")'},{default:o(()=>[n("div",ae,[l(u,{type:"primary",style:{"margin-bottom":"5px"},onClick:k},{default:o(()=>e[17]||(e[17]=[d("导入文件")])),_:1}),n("div",re,[l(H(O),{modelValue:t.value.code,"onUpdate:modelValue":e[9]||(e[9]=a=>t.value.code=a),style:{overflow:"hidden",height:"100%","font-size":"20px","border-radius":"4px"},class:"python-code","indent-with-tab":!0,"tab-size":8,autofocus:!0,extensions:T},null,8,["modelValue"])])])]),_:1}),l(i,null,{default:o(()=>[n("div",ie,[l(u,{onClick:F},{default:o(()=>e[18]||(e[18]=[d("返回")])),_:1}),l(u,{type:"primary",onClick:P},{default:o(()=>e[19]||(e[19]=[d("提交")])),_:1})])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["show"])}}},ye=Z(se,[["__scopeId","data-v-ca7f307c"]]);export{ye as default};
