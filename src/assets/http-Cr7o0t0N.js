import{b4 as h,b5 as u,b6 as m}from"./index-Dju9e0Mk.js";let l=null;const f={baseURL:"",timeout:3e4,headers:{"Content-Type":"application/json"}};function p(t,r){if(!r)return t;const e=new URLSearchParams;Object.entries(r).forEach(([s,d])=>{d!=null&&e.append(s,d)});const i=e.toString();return i?`${t}?${i}`:t}const g={defaults:f,request(t){var r;try{const e={...this.defaults,...t,headers:{...this.defaults.headers,...t.headers||{},userid:((r=h.value)==null?void 0:r.id)||""}};let i=(e.baseURL||"")+e.url;e.params&&(i=p(i,e.params));const s={method:e.method||"GET",headers:e.headers,signal:e.timeout?AbortSignal.timeout(e.timeout):void 0};return s.method!=="GET"&&e.data&&(e.headers["Content-Type"]==="application/json"?s.body=JSON.stringify(e.data):e.data instanceof FormData?(s.body=e.data,delete s.headers["Content-Type"]):s.body=e.data),new Promise(d=>{fetch(i,s).then(async o=>{const a=o.headers.get("content-type");let n;if(a!=null&&a.includes("application/json")?n=await o.json():a!=null&&a.includes("application/octet-stream")?n=await o.blob():a!=null&&a.includes("text/")?n=await o.text():n=await o.blob(),n.code===401){if(window.sessionStorage.removeItem("loginForm"),l)return;const{fullPath:c}=u.currentRoute.value;l=m.error({title:"登录过期",unmountOnClose:!0,maskClosable:!1,simple:!0,okText:"重新登录",escToClose:!1,onOk(){l=null,u.replace(`/login?redirect=${encodeURIComponent(c)}`)}});return}d(n)}).catch(o=>{d({code:500,errMsg:String(o)})})})}catch(e){return Promise.resolve({code:500,errMsg:String(e)})}},get(t,r={}){return this.request({...r,method:"GET",url:t})},delete(t,r={}){return this.request({...r,method:"DELETE",url:t})},post(t,r,e={}){return this.request({...e,method:"POST",url:t,data:r})},put(t,r,e={}){return this.request({...e,method:"PUT",url:t,data:r})}};export{g as h};
