import{_ as R}from"./data-watch-select-b_cAMGCY.js";import{i as j}from"./index-CSF_gV1R.js";import{m as q}from"./msgTree-DXiq6zYb.js";import{u as G}from"./util-CASLgOZv.js";import{c as Z}from"./useCollapse-DPAMKzb7.js";import{u as K}from"./useObserverMsg-mppqzyYd.js";import{l as X}from"./index-DsTk74qP.js";import{r as A,q as J,s as Q,t as W,o as Y,c as i,a as u,z as ee,n as b,m as y,g as U,i as g,y as V,G as z,f as te,F as ae,A as oe}from"./index-Dju9e0Mk.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./dataMonitor-BqNmZQKc.js";import"./http-Cr7o0t0N.js";import"./system-BzlGO5Bl.js";import"./categorizeParameters-C40L_2hr.js";function ne(T=1e4,F=500){const c=new Map;let v=null;const _=f=>{const x=`${f.Name}_${f.TimeStamp}`;return c.has(x)};return{add:f=>{const x=(f||[]).filter(m=>!_(m));if(x.length&&(x.forEach(m=>{const S=`${m.Name}_${m.TimeStamp}`;c.set(S,m)}),c.size>T)){const m=Array.from(c.keys()),S=c.size-T;m.slice(0,S).forEach(w=>{c.delete(w)})}},getAll:()=>Array.from(c.values()),clear:()=>{v=null,c.clear()},getUpdateTimer:()=>v,setUpdateTimer:f=>{v=f},updateInterval:F}}const ie={class:"main-content"},se={class:"operate-tag",style:{float:"right"}},C=1e4,re={__name:"chartArea",setup(T){const F=A(null);requestAnimationFrame(()=>{var t;return J((t=F.value)==null?void 0:t.getList)});const{appContext:c}=Q(),{$modal:v}=c.config.globalProperties;let _=[];function E(t){B.value=t,O(_)}const n=[];let a=null,d={};W(Z,()=>setTimeout(()=>a&&a.resize(),200));const{add:k,getAll:f,clear:x,getUpdateTimer:m,setUpdateTimer:S,updateInterval:w}=ne(C);function M(t){t!=null&&t.length&&(k(t),m()||S(setTimeout(()=>{var s;const e=((s=a.getOption().dataZoom)==null?void 0:s[0])||{start:0,end:100},o=f();o.length>0&&(o.forEach(r=>{const l=n.find(h=>h.label===r.Name);if(l){const h=l.data.findIndex(H=>H[0]===r.TimeStamp);h===-1?(l.data.push([r.TimeStamp,r.Engineering_Value]),l.data.length>C&&(l.data=l.data.slice(-1e4))):l.data[h][1]!==r.Engineering_Value&&(l.data[h][1]=r.Engineering_Value)}}),n.length&&!d.graphic.invisible?(Object.assign(d,{dataZoom:[{type:"slider",start:e.start,end:e.end,realtime:!0,minSpan:5,maxSpan:100}],graphic:{invisible:!0}}),a==null||a.setOption(d,{silent:!0,lazyUpdate:!0})):a==null||a.setOption({series:n},{silent:!0,lazyUpdate:!0})),x()},w)))}const{time:B,refresh:O}=K(M,0),$=async t=>{for(const e of t)e.level===2&&!e.loadend&&await X(e);_=t.filter(e=>{var o;return e.ParamName?(I(e.protocolType,e.ParamName,e.uuid,(o=e.parentNames)==null?void 0:o.concat([e.ParamName]).join("-")),!0):!1}),O(_);for(let e=n.length-1;e>=0;e--){const o=n[e];t.some(r=>r.uuid===o.id)||n.splice(e,1)}a&&a.setOption({series:n},{replaceMerge:["series"]}),n.length||(Object.assign(d,{dataZoom:null,graphic:{type:"text",left:"center",top:"middle",silent:!0,invisible:!1,style:{fill:"#000",text:"暂无数据",fontSize:"25px"}}}),a&&a.setOption(d,{silent:!0,notMerge:!0}))};function I(t,e,o,s){n.some(l=>l.name===e)||n.push({id:o,showSymbol:!0,legendHoverLink:!1,showAllSymbol:!1,entity_type:t,name:e,label:s,isLoaded:!1,type:"line",smooth:!1,data:[],sampling:"lttb",endLabel:{show:!0},itemStyle:{color:L()},lineStyle:{type:"solid"}})}Y(()=>{P();const t=document.querySelector(".echartBox");new ResizeObserver(()=>a&&a.resize()).observe(t)});let D=null;const N=A(null),p=A({title:"监控情况"});function L(){let t=Math.floor(Math.random()*16777216).toString(16);for(;t.length<6;)t="0"+t;return"#"+t}function P(){const t=document.querySelector(".echartBox");a=j(t),d={title:{text:"监控情况"},animation:!1,grid:{right:120},legend:{type:"scroll",orient:"vertical",top:30,right:10,selectedMode:!0,tooltip:{show:!0},textStyle:{lineHeight:20},formatter:function(e){return`${e.slice(0,6)}${e.length>6?"...":""}`}},toolbox:{right:20,showTitle:!1,itemGap:12,feature:{saveAsImage:{show:!0,title:"保存图片"},mySetting:{show:!0,title:"设置",icon:`image://${new URL("/assets/setting-Cdx-qHSI.png",import.meta.url).href}`,onclick:()=>{p.value.seriesData=G.clone(n.map(e=>({name:e.name,itemStyle:e.itemStyle,lineStyle:e.lineStyle}))),p.value.title=d.title.text,D=v.open({title:"图表配置",width:600,okText:"保存",cancelText:"取消",titleAlign:"start",draggable:!0,content:()=>i(u("a-form"),{ref:N,"auto-label-width":!0,model:p.value,layout:"vertical",style:"overflow: auto;max-height: 55vh"},{default:()=>{var e;return[i(u("a-form-item"),{label:"图表名称",field:"title",rules:{required:!0,message:"请输入图表名称"}},{default:()=>[i(u("a-input"),{modelValue:p.value.title,"onUpdate:modelValue":o=>p.value.title=o,placeholder:"请输入图表名称"},null)]}),(e=p.value.seriesData)==null?void 0:e.map(o=>i(u("a-form-item"),{label:o.name},{default:()=>[i("span",{style:"marginright: 10px"},[y("线条颜色：")]),i(u("ElColorPicker"),{modelValue:o.itemStyle.color,"onUpdate:modelValue":s=>o.itemStyle.color=s,placeholder:"请选择线条颜色"},null),i("span",{style:"margin:0 10px 0 50px"},[y("线条形状：")]),i(u("a-select"),{style:"width: 200px",modelValue:o.lineStyle.type,"onUpdate:modelValue":s=>o.lineStyle.type=s,placeholder:"请选择线条形状"},{default:()=>[i(u("a-option"),{value:"solid"},{default:()=>[y("实线")]}),i(u("a-option"),{value:"dashed"},{default:()=>[y("虚线")]}),i(u("a-option"),{value:"dotted"},{default:()=>[y("点线")]})]})]}))]}}),onBeforeOk:()=>{var e;return(e=N.value)==null||e.validate(o=>{a.setOption({title:{text:p.value.title}},{slient:!0});const{seriesData:s}=p.value,r=n.map((l,h)=>Object.assign(l,s[h]));a.setOption({series:r},{slient:!0}),D.close()}),!1},onClose:()=>{p.value={}}})}}}},tooltip:{confine:!0,trigger:"axis",axisPointer:{type:"cross",axis:"auto",snap:!0}},graphic:{type:"text",left:"center",top:"middle",silent:!0,invisible:!1,style:{fill:"#000",text:"暂无数据",fontSize:"25px"}},xAxis:{type:"time",boundaryGap:!1,silent:!0,axisLabel:{formatter:e=>new Date(e).toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})}},yAxis:{type:"value",boundaryGap:!1,silent:!0},series:n},a&&a.setOption(d)}return(t,e)=>{const o=u("a-doption"),s=u("a-dropdown"),r=u("a-split");return U(),ee(r,{style:{height:"100%",width:"100%"},"default-size":"260px",min:"200px",max:.8},{first:b(()=>[i(q,{ref_key:"msgTreeRef",ref:F,onUpdateCheckedKeys:$},null,512)]),second:b(()=>[g("div",ie,[e[0]||(e[0]=g("div",{class:"navHeader"},[g("div",{class:"img-box"},[g("img",{src:R})]),g("span",null,[y("数据监控和记录 / "),g("span",{class:"child-text"},"图表监控")])],-1)),i(s,{trigger:"hover",onSelect:E},{content:b(()=>[(U(),te(ae,null,oe([0,500,1e3,1500,2e3],l=>i(o,{key:l,value:l},{default:b(()=>[y(V(l===0?"实时刷新":`${l}ms`),1)]),_:2},1032,["value"])),64))]),default:b(()=>[g("span",se," 采样频率： "+V(z(B)===0?"实时刷新":`${z(B)}ms`),1)]),_:1}),e[1]||(e[1]=g("div",{id:"main",class:"echartBox"},null,-1))])]),_:1})}}},be=le(re,[["__scopeId","data-v-791228cf"]]);export{be as default};
