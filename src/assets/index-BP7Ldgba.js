import{r as W,s as re,j as $,k as q,t as oe,l as fe,f as ue,i as f,c as m,b as Q,m as X,x as ce,y as me,n as R,v as Z,a as N,g as de}from"./index-Dju9e0Mk.js";import{_ as pe}from"./system-ctrl-select-Em8B5Bdm.js";import{G as _e,a as Ne}from"./dataMonitor-BqNmZQKc.js";import{u as ge}from"./util-CASLgOZv.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-Cr7o0t0N.js";const Ce={class:"btns"},be="A429_Simulation",ve=5,xe={__name:"index",setup(Se){const O=W("1");function d(e,a){return e*Math.pow(2,a)>>>0}function ee(e,a){e=-e;let t="";for(let n=a-1;n>-1;n--)e>>>n&1?t+="0":t+="1";return parseInt(t,2)+1}function U(e){let t=14;const r=d(5,27);let n=d(31,27),s=d(e,32-t);for(;t;)(s^n)&d(1,31)?(n=d(n,1)&4294967295,n=n^r):n=d(n,1)&4294967295,s=d(s,1)&4294967295,t=t-1;return n=n>>>27,n=n^31,n}const{appContext:ae}=re(),{$message:te}=ae.config.globalProperties,L=W(!1);function ne(e){L.value=e.target.scrollTop>=120}function se(e,a){if(e.ParameterName==="CRC"){e.changeValue=parseInt(String(a),2);return}e.changeValue=a,!isNaN(+a)&&e.CRC&&(e.CRC.changeValue=B(e))}function B(e){const{Resolution:a=1}=e,t=e.changeValue===void 0?e.value:e.changeValue,r=Math.round(t/a);let n=0;return r<0?n=U(ee(r,14)):n=U(r),n}const F=[{title:"WordName",dataIndex:"WordName",minWidth:250,nameFilter:!0,filterable:{filter:(e,a)=>{var t;return(t=a.WordName)==null?void 0:t.includes(e)},slotName:"WordName-filter"}},{title:"ParameterName",dataIndex:"ParameterName",minWidth:250,nameFilter:!0,filterable:{filter:(e,a)=>{var t;return(t=a.ParameterName)==null?void 0:t.includes(e)},slotName:"ParameterName-filter"}},{title:"Label",dataIndex:"Label",width:100,align:"center",nameFilter:!0,filterable:{filter:(e,a)=>{var t;return(t=a.Label)==null?void 0:t.includes(e)},slotName:"Label-filter"}},{title:"value",dataIndex:"value",width:200,align:"center",render({record:e}){let a=e.changeValue===void 0?e.value:e.changeValue;return e.ParameterName==="CRC"&&(a=a.toString(2).padStart(ve,0)),m(N("a-input"),{"model-value":a,onInput:t=>{const{WordName:r,ParameterName:n,Label:s}=e;let u=[];O.value==="1"?u=c.filter(l=>l.WordName===r&&l.ParameterName===n):u=c.filter(l=>l.Label===s&&l.ParameterName===n),u.forEach(l=>se(l,t))},onkeydown:({keyCode:t})=>{t===13&&k()}},null)}},{title:"DataFormatType",dataIndex:"DataFormatType",width:200,align:"center",nameFilter:!0,filterable:{filter:(e,a)=>{var t;return(t=a.DataFormatType)==null?void 0:t.includes(e)},slotName:"DataFormatType-filter"}},{title:"Units",dataIndex:"Units",width:150,align:"center",nameFilter:!0,filterable:{filter:(e,a)=>{var t;return(t=a.Units)==null?void 0:t.includes(e)},slotName:"Units-filter"}},{title:"BitOffset",dataIndex:"BitOffset",width:150,align:"center",nameFilter:!0,filterable:{filter:(e,a)=>{var t;return(t=a.BitOffset)==null?void 0:t.includes(e)},slotName:"BitOffset-filter"},render({record:e}){return+(e.BitOffset||0)+1}}],g=W("50"),c=$([]);function I(){c.forEach(e=>{e.changeValue&&(e.value=e.changeValue,e.changeValue=void 0)}),te.success("更改数据已生效")}function E(e,a){const t=e.Label-a.Label;if(t!==0)return t;const r=e.WordName.localeCompare(a.WordName);if(r!==0)return r;const n=e.ParameterName,s=a.ParameterName,u=n.indexOf("Ones_Digit"),l=s.indexOf("Ones_Digit"),o=n.indexOf("Tens_Digit"),h=s.indexOf("Tens_Digit"),_=n.indexOf("Hundreds_Digit"),V=s.indexOf("Hundreds_Digit"),D=n.indexOf("Thousands_Digit"),C=s.indexOf("Thousands_Digit");return u!==-1||o!==-1||_!==-1||D!==-1?-1:l!==-1||h!==-1||V!==-1||C!==-1?1:n.localeCompare(s)}const le=q(()=>{const e=[];return c.forEach(a=>{if(!e.some(t=>t.WordName===a.WordName&&t.ParameterName===a.ParameterName)){const{Label:t}=a;if(+t==41&&a.ParameterName!=="R_BPCU_EMER_PWR_ONLY"||+t==207)return;e.push(a)}}),e.sort(E)}),ie=q(()=>{const e=[];return c.forEach(a=>{if(!e.some(t=>t.WordName===a.WordName&&t.ParameterName===a.ParameterName)){const{Label:t}=a;if(+t==207||+t==174&&a.WordName!=="L174_RDIU_FSECU_AV_Hydraulic Pressure 1"||+t==41&&a.ParameterName!=="R_BPCU_EMER_PWR_ONLY")return;if(+t==275){a.WordName==="L275_RDIU_FSECU_CON_WOW_LGCU 1"&&(a.ParameterName==="MLG WOW"||a.isSSM)&&e.push(a);return}if(+t==203&&a.WordName!=="L203_RDIU_FSECU_Pressure Altitude 1"||+t==206&&a.WordName!=="L206_RDIU_FSECU_PFCS_Airspeed1 "||+t==221&&a.WordName!=="L221_RDIU_FSECU_Angle Of Attack 1")return;if(a.isSSM){[203,206,221].includes(+a.Label)&&e.push(a);return}e.push(a)}}),e.sort(E)}),T=$([]),p=W(null),S=new Worker(ge.getAssetsFile("A429simloop.js"));S.onmessage=e=>{const{type:a,data:t}=e.data;a==="timer"&&(p.value=t)},oe(T,e=>{S.postMessage({type:"putData",data:JSON.stringify(e)})},{immediate:!0,deep:!0});function k(){p.value||!g.value||isNaN(+g.value)||S.postMessage({type:"start",intervalTime:g.value})}function A(){S.postMessage({type:"stop"})}function M(){A(),T.length=0,c.length=0,_e().then((e={})=>{const{participant_list:a=[]}=e,{protocol_list:t=[]}=a.find(n=>n.paticipant_name===be)||{},{pub_message_name:r=[]}=t.find(n=>n.protocol_type==="A429")||{};r.forEach(async n=>{var l;const s=await Ne(n,"A429"),u=[];T.push({type:"A429",data:{bus:{name:n,words:u}}}),(l=s==null?void 0:s.children_info)==null||l.forEach(o=>{var H,z,j,G,w;const h=[],_=(z=(H=o==null?void 0:o.attributes)==null?void 0:H.find(i=>i.name==="Label"))==null?void 0:z.value;u.push({name:o.name,Label:_,parameters:h});const V=(G=(j=o==null?void 0:o.attributes)==null?void 0:j.find(i=>i.name==="DefaultSSM"))==null?void 0:G.value;let D;const C=[];if((w=o==null?void 0:o.children_info)==null||w.forEach(i=>{let b,P,K,Y,J;i.attributes.forEach(({name:v,value:x})=>{v==="DefaultValue"?b=x:v==="BitOffset"?P=x:v==="DataFormatType"?K=x:v==="Units"?Y=x:v==="Resolution"&&(J=x)});const y={BusName:n,WordName:o.name,ParameterName:i.name,name:i.name,value:isNaN(+b)?0:+b,BitOffset:P,Label:_,DataFormatType:K,Units:Y,Resolution:J};i.name==="CRC"&&(D=y),C.push(y),c.push(y),h.push(y)}),![41,26].includes(+_)){const i={BusName:n,WordName:o.name,ParameterName:"A429SSM",name:"A429SSM",isSSM:!0,Resolution:1,value:V,BitOffset:30,Label:_,DataFormatType:"",Units:""};c.push(i),h.push(i)}D&&C.forEach((i,b)=>{if(i.ParameterName!=="CRC"){const P=C[b===0?1:0];i.CRC=P,i.CRC.value=B(i)}})})})})}return fe(M),(e,a)=>{const t=N("checkout"),r=N("a-input"),n=N("AeTable"),s=N("a-tab-pane"),u=N("a-tabs");return de(),ue("div",{class:"main-content",style:{"padding-top":"0"},onScroll:ne},[a[3]||(a[3]=f("div",{class:"navHeader",style:{"margin-top":"20px"}},[f("div",{class:"img-box"},[f("img",{src:pe})]),f("span",null,[X("系统控制 / "),f("span",{class:"child-text"},"航电系统仿真")])],-1)),f("div",Ce,[m(t),f("span",{class:"operate-tag",onClick:M}," 刷新数据 "),f("span",{class:"operate-tag",style:ce({cursor:p.value?"not-allowed":"pointer"}),onClick:k},me(p.value?"正在发送 ···":"发送"),5),f("span",{class:"operate-tag",onClick:A}," 停止发送 "),f("span",{class:"operate-tag",onClick:I}," 生效 "),m(r,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=l=>g.value=l),style:{width:"250px",background:"#fff"},placeholder:"请输入发送间隔时间(ms)",disabled:!!p.value},{suffix:R(()=>a[2]||(a[2]=[X(" ms ")])),_:1},8,["modelValue","disabled"])]),m(u,{"active-key":O.value,"onUpdate:activeKey":a[1]||(a[1]=l=>O.value=l),size:"large",justify:"",animation:"",type:"capsule"},{default:R(()=>[m(s,{key:"1",title:"完整"},{default:R(()=>[m(n,{columns:F,data:le.value,headeHeight:"40px",borderSpacing:"0",rowHeight:"35px"},null,8,["data"])]),_:1}),m(s,{key:"2",title:"精简"},{default:R(()=>[m(n,{columns:F,data:ie.value,headeHeight:"40px",borderSpacing:"0",rowHeight:"35px"},null,8,["data"])]),_:1})]),_:1},8,["active-key"]),Q(f("span",{class:"operate-tag isBackTop",onClick:k}," 发送 ",512),[[Z,L.value&&!p.value]]),Q(f("span",{class:"operate-tag isBackTopB",onClick:I}," 生效 ",512),[[Z,L.value&&!p.value]])],32)}}},Le=he(xe,[["__scopeId","data-v-8aa052a7"]]);export{Le as default};
