import{G}from"./dataMonitor-BqNmZQKc.js";import{u as _}from"./util-CASLgOZv.js";import{l as C,t as j}from"./index-DsTk74qP.js";import{j as E,r as p,o as F,k as I,a as x,z as q,g as H,n as U,i as K,c as v,G as J,F as Q}from"./index-Dju9e0Mk.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"search-box"},Y={class:"tree-box"},Z={__name:"msgTree",emits:["updateSelectedKeys","updateCheckedKeys"],setup($,{expose:N,emit:M}){const g=M,f=E([]);function A(s,e){g("updateCheckedKeys",e),f.length=0,s.forEach(n=>{f.push(n)})}const y=p(!1),h=p(0),i=p([]),r=p(""),D=p(0);let m=!1;async function O(s,[e]){e&&(e.level===2&&!e.loadend&&await C(e),g("updateSelectedKeys",e))}const V=({option:s})=>{const{label:e=""}=s,n=L(e);return n<0?e:v(Q,null,[e.substr(0,n),v("span",{style:"background: yellow"},[e.substr(n,r.value.length)]),e.substr(n+r.value.length)])};F(()=>{new ResizeObserver(([e])=>{D.value=e.contentRect.height-60}).observe(document.querySelector(".arco-spin"))});const B=I(()=>r.value?P():i.value);function L(s="",e){return r.value?s.toLowerCase().indexOf(e||r.value.toLowerCase()):-1}function P(){const s=r.value.toLowerCase(),e=n=>{const a=[];return n.forEach(t=>{if(L(t.label,s)>-1)a.push(t);else if(t.children){const o=e(t.children);o.length&&a.push(new Proxy({},{get:(l,c)=>c==="children"?o:t[c]}))}}),a};return e(i.value)}const R=()=>{r.value="",S(),i.value=h.value===0?[{label:"协议",uuid:"协议",level:0,isLeaf:!1,protocolType:null,children:[]}]:[]},w=(s,e,n)=>{if(!(s!=null&&s.length))return null;const a=s.filter(o=>o);if(!a.length)return null;const t={label:n,uuid:_.randomString(),level:1,isLeaf:!1,protocolType:null,children:[]};for(const o of a){const l={label:o,level:2,loadend:!1,protocolType:e,uuid:_.randomString(),isLeaf:!1};t.children.push(l)}return t},b=(s,e,n)=>{var t,o;if(s.protocolType!=="A429")return;const a=e==null?void 0:e.find(l=>l.message_name===n);a&&(s.bitrate=(o=(t=a.attributes)==null?void 0:t.find(l=>l.name==="BitRate"))==null?void 0:o.value)},k=()=>{m||(y.value=!0,m=!0,R(),G().then(async s=>{if(!s)return setTimeout(()=>{m=!1,k()},1e3);m=!1,y.value=!1;const{protocol_list:e=[],participant_list:n=[]}=s;if(h.value===1)for(const a of n){if(a.paticipant_type==="0")continue;const t=[],o={label:a.paticipant_name,uuid:_.randomString(),level:0,isLeaf:!1,protocolType:null,children:t};for(const l of a.protocol_list||[]){const c=l.protocol_type,u=w(l.pub_message_name,c,"Publish");if(u){t.push(u);for(const d of u.children)b(d,l.pub_message_attributes,d.label)}const T=w(l.sub_message_name,c,"Subscribe");if(T){t.push(T);for(const d of T.children)b(d,l.pub_message_attributes,d.label)}}t.length<1&&(o.isLeaf=!0),i.value.push(o)}else for(const a of e){const t=a.protocol_type,o=[],l={label:t,uuid:t,protocolType:t,level:1,isLeaf:!1,children:o};for(const c of a.message_name){const u={label:c,level:2,loadend:!1,protocolType:t,uuid:_.randomString(),isLeaf:!1};["Analog","Discrete"].includes(t)&&Object.assign(u,{ParamName:c,parentNames:[t]}),b(u,a.message_attributes,c),o.push(u)}l.children.length<1&&(Reflect.deleteProperty(l,"children"),l.isLeaf=!0),i.value[0].children.push(l)}j(i.value)}))},z=()=>{h.value=h.value===0?1:0,k()};function S(){f.length=0,g("updateCheckedKeys",[])}return N({getList:k,toggleModel:z,checkAll:S}),(s,e)=>{const n=x("a-input-search"),a=x("Tree"),t=x("a-spin");return H(),q(t,{size:35,loading:y.value,class:"h100",style:{width:"100%"}},{default:U(()=>[K("div",X,[v(n,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=o=>r.value=o),placeholder:"请输入查询关键字"},null,8,["modelValue"])]),K("div",Y,[v(a,{"checked-keys":f,data:B.value,checkable:"","allow-checking-not-loaded":"",cascade:"","on-load":J(C),"key-field":"uuid","default-expanded-keys":["协议"],"on-update:selected-keys":O,"render-label":V,"on-update:checked-keys":A},null,8,["checked-keys","data","on-load"])])]),_:1},8,["loading"])}}},le=W(Z,[["__scopeId","data-v-c3593f03"]]);export{le as m};
