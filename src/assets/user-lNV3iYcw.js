import{_ as T}from"./system-mgt-select-BLx3586I.js";import{G as E}from"./role-nPyMV3Ri.js";import{P as R,A as S,G as y,D as I}from"./user-UnMz5OIS.js";import{u as A}from"./util-CASLgOZv.js";import{s as U,r as n,c as a,a as l,D as L,f as z,i as p,m as N,F as B,g as G}from"./index-Dju9e0Mk.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-Cr7o0t0N.js";function P(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!L(f)}const $={__name:"user-form",emits:["getList"],setup(f,{expose:_,emit:s}){const{appContext:h}=U(),{$modal:k,$message:g}=h.config.globalProperties,F=s,u=n({roleId:null,userName:"",password:"",status:1,remark:""});let v=null;const d=n(null),b={roleId:{required:!0,message:"请选择角色"},userName:{required:!0,message:"请填写用户名称"},password:{required:!0,message:"请填写用户密码"}},r=()=>{var o;(o=d.value)==null||o.validate(i=>{i||(u.value.id?R:S)(u.value).then(t=>{if(console.log(t,"operate user"),t.code!==200)return g.error(t.errMsg||"操作失败");g.success("操作成功"),F("getList"),v.close()})})},c=n([]);function C(){E({pageSize:9999999}).then(o=>{c.value=o.data||[]})}return _({open:async o=>{C(),o&&(u.value=A.clone(o)),v=k.open({title:`${o?"修改":"创建"}用户信息`,width:700,okText:"确认",cancelText:"取消",titleAlign:"start",draggable:!0,content:()=>{let i;return a(l("a-form"),{ref:d,labelPlacement:"left",labelWidth:"auto",rules:b,requireMarkPlacement:"left-hanging",model:u.value,"auto-label-width":!0},{default:()=>[a(l("a-form-item"),{label:"所属角色",field:"roleId"},{default:()=>[a(l("a-select"),{placeholder:"请选择所属角色",modelValue:u.value.roleId,"onUpdate:modelValue":e=>u.value.roleId=e},P(i=c.value.map(e=>a(l("a-option"),{value:e.id},{default:()=>[e.roleName]})))?i:{default:()=>[i]})]}),a(l("a-form-item"),{label:"用户名称",field:"userName"},{default:()=>[a(l("a-input"),{modelValue:u.value.userName,"onUpdate:modelValue":e=>u.value.userName=e,placeholder:"请输入用户名称"},null)]}),a(l("a-form-item"),{label:"用户密码",field:"password"},{default:()=>[a(l("a-input-password"),{modelValue:u.value.password,"onUpdate:modelValue":e=>u.value.password=e,placeholder:"请输入用户密码","allow-clear":!0},null)]}),a(l("a-form-item"),{label:"是否启用",field:"status"},{default:()=>[a(l("a-switch"),{modelValue:u.value.status,"onUpdate:modelValue":e=>u.value.status=e,"checked-text":"已启用","checked-value":1,"unchecked-value":0,"unchecked-text":"已关闭"},null)]}),a(l("a-form-item"),{label:"备注",field:"remark"},{default:()=>[a(l("a-input"),{modelValue:u.value.remark,"onUpdate:modelValue":e=>u.value.remark=e,placeholder:"请填写用户备注"},null)]})]})},onBeforeOk(){return r(),!1},onClose:()=>{u.value={roleId:null,userName:"",password:"",status:1,remark:""}}})}}),()=>{}}},O={class:"main-content"},q={__name:"user",setup(f){const{appContext:_}=U(),{$message:s,$modal:h}=_.config.globalProperties,k=[{title:"用户名称",dataIndex:"userName",nameFilter:!0},{title:"账号状态",dataIndex:"status",nameFilter:!0,render({record:e}){const t=e.status===1;return a(l("a-tag"),{color:t?"green":"red"},{default:()=>[t?"已启用":"已停用"]})}},{title:"所属角色",dataIndex:"roleName",nameFilter:!0,render:({record:e})=>{var t;return e.isAdmin?"超级管理员":(t=e.roleInfo)==null?void 0:t.roleName}},{title:"备注",dataIndex:"remark",nameFilter:!0},{title:"创建时间",dataIndex:"createdTime"},{title:"更新时间",dataIndex:"updatedTime"},{title:"操作",dataIndex:"operate",width:150,render({record:e}){return a(B,null,[a(l("a-button"),{type:"text",disabled:e.isAdmin,onclick:()=>F(e)},{default:()=>[N("修改")]}),a(l("a-popconfirm"),{content:`确认删除用户${e.userName}吗?`,"content-class":"_user-popContentClass",type:"warning",onOk:()=>u(e)},{default:()=>[a(l("a-button"),{type:"text",disabled:e.isAdmin},{default:()=>[N("删除")]})]})])}}],g=n([]);function F(e){c.value.open(e)}function u(e){I([e.id]).then(t=>{if(t.code!==200)return s.error(t.errMsg||"删除失败");r(),s.success("删除成功")})}const v=n(0),d=n(1),b=n(10);function r(){y({pageNumber:d.value,pageSize:b.value}).then(e=>{if(console.log(e,"userlist"),e.code!==200)return s.error(e.errMsg||"获取用户列表失败");g.value=e.data,v.value=e.total})}r();const c=n(null);function C(){c.value.open()}const x=n(null);function o(){const e=x.value.vxeTabMethods.getCheckboxRecords(!0);if(!e.length)return s.warning("没有选择数据");h.open({title:"提示",content:"确定删除这些数据吗?这将不可恢复",onBeforeOk:t=>{I(e.map(m=>m.id)).then(m=>{if(m.code!==200)return s.error(m.errMsg||"操作失败");x.value.vxeTabMethods.setAllCheckboxRow(!1),t(),r(),s.success("删除成功")})}})}const i=[{clickHandle:C,imgSrc:"images/c-load-all.png",title:"新增用户"},{clickHandle:o,imgSrc:"images/delete.png",title:"批量删除"}];return(e,t)=>{const m=l("BtnGroup"),V=l("AeTable"),D=l("a-pagination");return G(),z(B,null,[p("div",O,[t[2]||(t[2]=p("div",{class:"navHeader"},[p("div",{class:"img-box"},[p("img",{src:T})]),p("span",null,[N("系统管理 / "),p("span",{class:"child-text"},"用户管理")])],-1)),a(m,{data:i}),a(V,{ref_key:"vxeTableRef",ref:x,class:"vxeTableBox",columns:k,data:g.value,hasCheckbox:""},null,8,["data"]),a(D,{current:d.value,"onUpdate:current":t[0]||(t[0]=w=>d.value=w),"page-size":b.value,"onUpdate:pageSize":t[1]||(t[1]=w=>b.value=w),total:v.value,"show-page-size":"","show-total":"",onChange:r,onPageSizeChange:r},null,8,["current","page-size","total"])]),a($,{ref_key:"userFormRef",ref:c,onGetList:r},null,512)],64)}}},Y=M(q,[["__scopeId","data-v-abc810e6"]]);export{Y as default};
