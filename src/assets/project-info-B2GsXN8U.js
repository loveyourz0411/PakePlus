import{_ as Te}from"./data-watch-select-b_cAMGCY.js";import{a4 as X,d as ee,f as E,g as S,i as p,x as te,B as ne,a5 as ae,k as x,a6 as oe,s as $e,a8 as qe,K as De,r as y,O as Pe,j as Ne,b3 as Ie,a as N,c as u,L as Ee,a1 as Y,a3 as Z,M as U,ac as xe,$ as Be,y as G,F as be,z as W,n as he,aa as ze,m as _e,p as Le}from"./index-Dju9e0Mk.js";import{G as Me}from"./history-HliKBwvq.js";import{g as Oe}from"./common-DqBIDsQy.js";import{u as Fe,d as Ve,c as je,g as He,t as Ze,r as we}from"./useCase-CD5o696P.js";import{D as de,B as Ue,g as pe,P as Ge,A as Qe}from"./case-Dg8WzVaS.js";import{D as Je,g as Ke}from"./requirement-DsTjIJZq.js";import{u as Ye}from"./util-CASLgOZv.js";import{I as me}from"./index-CCxppbjm.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-Cr7o0t0N.js";const We=ee({name:"IconBook",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const s=ae("icon"),r=x(()=>[s,`${s}-book`,{[`${s}-spin`]:e.spin}]),c=x(()=>{const o={};return e.size&&(o.fontSize=oe(e.size)?`${e.size}px`:e.size),e.rotate&&(o.transform=`rotate(${e.rotate}deg)`),o});return{cls:r,innerStyle:c,onClick:o=>{n("click",o)}}}}),Xe=["stroke-width","stroke-linecap","stroke-linejoin"];function et(e,n,s,r,c,h){return S(),E("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:ne(e.cls),style:te(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...o)=>e.onClick&&e.onClick(...o))},n[1]||(n[1]=[p("path",{d:"M24 13 7 7v28l17 6 17-6V7l-17 6Zm0 0v27.5M29 18l7-2.5M29 25l7-2.5M29 32l7-2.5M19 18l-7-2.5m7 9.5-7-2.5m7 9.5-7-2.5"},null,-1)]),14,Xe)}var fe=X(We,[["render",et]]);const tt=Object.assign(fe,{install:(e,n)=>{var s;const r=(s=n==null?void 0:n.iconPrefix)!=null?s:"";e.component(r+fe.name,fe)}}),nt=ee({name:"IconInteraction",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const s=ae("icon"),r=x(()=>[s,`${s}-interaction`,{[`${s}-spin`]:e.spin}]),c=x(()=>{const o={};return e.size&&(o.fontSize=oe(e.size)?`${e.size}px`:e.size),e.rotate&&(o.transform=`rotate(${e.rotate}deg)`),o});return{cls:r,innerStyle:c,onClick:o=>{n("click",o)}}}}),at=["stroke-width","stroke-linecap","stroke-linejoin"];function ot(e,n,s,r,c,h){return S(),E("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:ne(e.cls),style:te(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...o)=>e.onClick&&e.onClick(...o))},n[1]||(n[1]=[p("path",{d:"M8 19h16m16 0H24m0 0v23m14 0H10a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h28a2 2 0 0 1 2 2v32a2 2 0 0 1-2 2Z"},null,-1)]),14,at)}var ve=X(nt,[["render",ot]]);const st=Object.assign(ve,{install:(e,n)=>{var s;const r=(s=n==null?void 0:n.iconPrefix)!=null?s:"";e.component(r+ve.name,ve)}}),it=ee({name:"IconNav",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const s=ae("icon"),r=x(()=>[s,`${s}-nav`,{[`${s}-spin`]:e.spin}]),c=x(()=>{const o={};return e.size&&(o.fontSize=oe(e.size)?`${e.size}px`:e.size),e.rotate&&(o.transform=`rotate(${e.rotate}deg)`),o});return{cls:r,innerStyle:c,onClick:o=>{n("click",o)}}}}),lt=["stroke-width","stroke-linecap","stroke-linejoin"];function rt(e,n,s,r,c,h){return S(),E("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:ne(e.cls),style:te(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...o)=>e.onClick&&e.onClick(...o))},n[1]||(n[1]=[p("path",{d:"M6 19h10m0 0h26m-26 0V9m0 10v10m0 0v10m0-10H6m10 0h26M6 9h36v30H6V9Z"},null,-1)]),14,lt)}var ge=X(it,[["render",rt]]);const ut=Object.assign(ge,{install:(e,n)=>{var s;const r=(s=n==null?void 0:n.iconPrefix)!=null?s:"";e.component(r+ge.name,ge)}}),ct=ee({name:"IconRelation",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const s=ae("icon"),r=x(()=>[s,`${s}-relation`,{[`${s}-spin`]:e.spin}]),c=x(()=>{const o={};return e.size&&(o.fontSize=oe(e.size)?`${e.size}px`:e.size),e.rotate&&(o.transform=`rotate(${e.rotate}deg)`),o});return{cls:r,innerStyle:c,onClick:o=>{n("click",o)}}}}),dt=["stroke-width","stroke-linecap","stroke-linejoin"];function pt(e,n,s,r,c,h){return S(),E("svg",{viewBox:"0 0 48 48",fill:"none",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",class:ne(e.cls),style:te(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...o)=>e.onClick&&e.onClick(...o))},n[1]||(n[1]=[p("path",{d:"M19.714 14C15.204 15.784 12 20.302 12 25.593c0 1.142.15 2.247.429 3.298m16.285-14.712C32.998 16.073 36 20.471 36 25.593c0 1.07-.131 2.11-.378 3.102m-18.32 7.194a11.676 11.676 0 0 0 13.556-.112"},null,-1),p("path",{d:"M24 19a6 6 0 1 0 0-12 6 6 0 0 0 0 12ZM36 40a6 6 0 1 0 0-12 6 6 0 0 0 0 12ZM12 40a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z"},null,-1)]),14,dt)}var ke=X(ct,[["render",pt]]);const mt=Object.assign(ke,{install:(e,n)=>{var s;const r=(s=n==null?void 0:n.iconPrefix)!=null?s:"";e.component(r+ke.name,ke)}}),ft=ee({name:"IconStorage",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const s=ae("icon"),r=x(()=>[s,`${s}-storage`,{[`${s}-spin`]:e.spin}]),c=x(()=>{const o={};return e.size&&(o.fontSize=oe(e.size)?`${e.size}px`:e.size),e.rotate&&(o.transform=`rotate(${e.rotate}deg)`),o});return{cls:r,innerStyle:c,onClick:o=>{n("click",o)}}}}),vt=["stroke-width","stroke-linecap","stroke-linejoin"];function gt(e,n,s,r,c,h){return S(),E("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:ne(e.cls),style:te(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...o)=>e.onClick&&e.onClick(...o))},n[1]||(n[1]=[p("path",{d:"M7 18h34v12H7V18ZM40 6H8a1 1 0 0 0-1 1v11h34V7a1 1 0 0 0-1-1ZM7 30h34v11a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V30Z"},null,-1),p("path",{d:"M13.02 36H13v.02h.02V36Z"},null,-1),p("path",{d:"M13 12v-2h-2v2h2Zm.02 0h2v-2h-2v2Zm0 .02v2h2v-2h-2Zm-.02 0h-2v2h2v-2ZM13 14h.02v-4H13v4Zm-1.98-2v.02h4V12h-4Zm2-1.98H13v4h.02v-4Zm1.98 2V12h-4v.02h4Z",fill:"currentColor",stroke:"none"},null,-1),p("path",{d:"M13.02 24H13v.02h.02V24Z"},null,-1)]),14,vt)}var ye=X(ft,[["render",gt]]);const kt=Object.assign(ye,{install:(e,n)=>{var s;const r=(s=n==null?void 0:n.iconPrefix)!=null?s:"";e.component(r+ye.name,ye)}}),Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAuFJREFUaEPtWetR5DAMjtIIUAlLB85WsFRyUAnQwMYdwFVyqSS6kbEzirET+bHr2Rn4EzZjx/qkT09Dd+N/cOPyd78AyIJKqfu+70/zPN8BwL216sE+J/5ERPr9V2v9XsP6RRZQSp0A4C1TkAkAPs7n80vmfrMtG8DxeHxBxD8lhxsBAF5LQGQDGIYBHTUQ8bXrui9rDUcdKbYJEZ+11l/SDXxdFgDiPAD8ow/Zww2flVIHAPhMFaTECrkAFkFrACDrjeP4lAo82wc8TRMFSihEcjQFkKM4f88vgCQtusS1t8kmttPeuotSiIS1ArinQJ7vJX3fH4S5wlDInrU6Zy+8RqOQDZWUZVPjuhggW2gAxJLjVpgNAigsEaoDsB8MOvoPALnJKEdqqQXcOp5z3LsfAIZhoEx6DdpwzJsUYguncRwfoqVEI+1TOfKutX5WSr0BwGbUQsQn7tgrCzTgvlGmc9JhGKi+2ox2ewB2NVDI9eB2JxSrcKPH+BFpZQGJBmoDYNqX+t4qGrUEsPQBib63cmQfgGtSUhRtWsN5nsUNCXfCjM6uGgCuQXK8Q9/34nIDER9zw/U4jovisymEiA9a6ylDgynWDa3dtIDIkVjUEK0vldjbHwcg1SaZMNHxqmFwSS9YSkiESsma1aRmH/LrIT8TL9OG2OEpWfMSALgDmyzuH7JXzLUE4NMnCGCPRo0BrAq5IAB6ueXMrQDEurKtlpKGVzT7XPUGDQCYuVNsmp01mSMrSQs/v/yt7djXACC9B/jYm0CEwF8cgFTjuZZqBYBuaVaF380AYJmckuYyd2oBIKuQc1WsH675eyntonlA8gFp4ed/i2uaTyH8EkEiQxEAO3okK4ibGCuU6eDofzc3vfoNjdNOAYhFwSXCF1mAg6A7YuEUmjOj6HIv2A9IeRdaZ0fjVHY82stuopajl7nsdtSZ55kmce4CvOTY/HviolMrbs5OZBVlKPrUzQP4D8VJ/EAQk7LhAAAAAElFTkSuQmCC",yt={class:"main"},ht={style:{"padding-right":"10px"}},It={__name:"project-tree",props:{dataStatis:{type:Object,default(){return{}}}},emits:"select",setup(e,{expose:n,emit:s}){const{appContext:r}=$e(),{$message:c,$modal:h}=r.config.globalProperties,o=qe(),g=De(),L=s,M=y(""),$=Pe(),P=e,{convertCase:Q}=Fe();let f=null;const C=Ne([]);function j(i,[l]){L("select",l)}function J({option:i}){return i.prefix?i.prefix():{requirement:u(me,{size:"19"},null),4:u(me,{size:"19"},null),3:u(me,{size:"19"},null),subrequirement:u(Ee,{size:"17"},null),5:u("img",{src:Ae,alt:"",style:"width: 18px; height: 18px;"},null),1:u("img",{src:Ae,alt:"",style:"width: 18px; height: 18px;"},null)}[i.type]}const re=[{label:"修改",key:"edit",icon:()=>u(Z,null,null)},{label:"删除",key:"delete",icon:()=>u(U,null,null)}],B=y(!1),se=y(0),ie=y(0),w=y(A()),q=y([]);function z(){const i=w.value.find(l=>l.label==="专用用例库");pe({type:3,projectId:+o.query.projectId}).then(l=>{const m=_(l.data),v=P.dataStatis;v.caseCount=F(m,d=>d.type===3),L("update:dataStatis",v),i.children=m})}function ue(){pe({type:2}).then(i=>{q.value=i.data})}function O(){const i=w.value.find(l=>l.label==="任务");pe({type:4,projectId:Number(o.query.projectId)}).then(l=>{const m=_(l.data),v=P.dataStatis;v.taskCount=F(m,d=>d.type===4),L("update:dataStatis",v),i.children=m})}function _(i=[]){return i==null||i.forEach(l=>{Object.assign(l,{id:l.ID||l.id,label:l.name||l.Req_Name}),l.Req_ID&&(l.type=l.type===1?"requirement":"subrequirement",l.id=Ye.randomString()),_(l.children||[])}),i}function F(i=[],l){let m=0;return i==null||i.forEach(v=>{l(v)&&m++,m+=F(v.children,l)}),m}function V(){const i=w.value.find(l=>l.label==="需求");Ke({projectId:o.query.projectId}).then(({data:l=[]})=>{const m=P.dataStatis;m.reqCount=F(l,v=>v.content),L("update:dataStatis",m),_(l),i.children=l})}Ie(()=>{z(),ue(),O(),V()});const H=y(null);function ce(i,{operate:l}){let m=[],v=null;switch(l){case"add-task":case"add-taskRoot":g.push({name:"taskForm",query:{parentId:f.ID,projectId:o.query.projectId}});break;case"add-caseRoot":k({parentId:0});break;case"add-case":g.push({name:"caseForm",query:{parentId:f.ID||0,type:1,projectId:o.query.projectId}});break;case"import-pubcase":t(f.ID);break;case"edit-case":sessionStorage.setItem("case",JSON.stringify(f)),g.push({name:"caseForm",query:{id:f.ID}});break;case"bind-case":H.value=[],{list:m,map:v}=a(),h.open({title:"关联用例",width:600,okText:"确认",cancelText:"取消",titleAlign:"start",draggable:!0,content:()=>u(N("a-cascader"),{multiple:!0,modelValue:H.value,"onUpdate:modelValue":d=>H.value=d,options:m,placeholder:"请选择关联的Case"},null),onBeforeOk(){const d=H.value.map(T=>({id:T,type:v.get(T)})),I={taskId:Number(f.ID),caseList:d,projectId:Number(o.query.projectId),parentId:0};return Ue(I).then(T=>{if(T.code!==200)return c.error(T.errMsg||"操作失败");O(),z(),c.success(T.msg||"操作成功")}),!0}});break;case"edit-task":delete f.children,sessionStorage.setItem("task",JSON.stringify(f)),g.push({name:"taskForm",query:{id:f.ID}});break;case"add-group":k({parentId:f.id});break;case"edit-group":k({id:f.id});break;case"add-reqRoot":g.push({name:"reqForm",query:{projectId:o.query.projectId}});break;case"del-group":case"del-case":$.warning({title:"警告",content:()=>"确认删除这些数据?这将不可恢复",positiveText:"确认",negativeText:"取消",autoFocus:!1,onPositiveClick(){de([f.ID]).then(d=>{if(d.code!==200)return c.error(d.errMsg||"操作失败");z(),c.success(d.msg||"操作成功")})}});break;case"unbind-case":de([f.ID]).then(d=>{if(d.code!==200)return c.error(d.errMsg||"操作失败");O(),c.success(d.msg||"操作成功")});break;case"del-task":$.warning({title:"警告",content:()=>"确认删除这些数据?这将不可恢复",positiveText:"确认",negativeText:"取消",autoFocus:!1,onPositiveClick(){return new Promise(d=>{de([f.ID]).then(I=>{if(I.code!==200)return d(!1),c.error(I.errMsg||"操作失败");O(),c.success(I.msg||"操作成功"),d(!0)})})}});break;case"add-subrequirement":case"add-requirement":g.push({name:"reqForm",query:{parentId:f.ID,projectId:o.query.projectId}});break;case"edit-subrequirement":case"edit-requirement":delete f.children,g.push({name:"reqForm",query:{id:f.ID,projectId:o.query.projectId}}),sessionStorage.setItem("requirement",JSON.stringify(f));break;case"del-subrequirement":case"del-requirement":$.warning({title:"警告",content:()=>"确认删除这些数据?这将不可恢复",positiveText:"确认",negativeText:"取消",autoFocus:!1,onPositiveClick(){Je([f.ID]).then(d=>{if(d.code!==200)return c.error(d.errMsg||"操作失败");V(),c.success(d.msg||"操作成功")})}});break}B.value=!1}function t(i=0){Q(q.value,{type:1,projectId:Number(o.query.projectId),parentId:i},z)}function a(){const i=w.value.find(d=>d.label==="专用用例库"),l=new Map,m=[{label:"专用用例库",value:-1,children:v(i.children,1)},{label:"公共用例库",value:-2,children:v(q.value,0)}];function v(d=[],I){const T=[];return d==null||d.forEach(K=>{var Se;l.set(K.ID,I),T.push({label:K.name,value:K.ID,children:(Se=K.children)!=null&&Se.length?v(K.children,I):void 0})}),T}return{list:m,map:l}}const b={reqRoot:"需求",requirement:"子需求",subrequirement:"子需求",taskRoot:"任务",caseRoot:"专用用例组"};function D({option:i}){return{onContextmenu(l){f=i,console.log(f),C.length=0;const m=b[i.type];i.type?m&&C.push({label:`新增${m}`,operate:`add-${i.type}`,type:i.type,icon:()=>u(Y,null,null)}):Array.prototype.push.apply(C,re),["requirement","subrequirement"].includes(i.type)?C.push({label:"修改需求",operate:`edit-${i.type}`,type:i.type,icon:()=>u(Z,null,null)},{label:"删除需求",operate:`del-${i.type}`,type:i.type,icon:()=>u(U,null,null)}):i.type===3?C.push({label:"新增用例组",operate:"add-group",icon:()=>u(Y,null,null)},{label:"新增用例",operate:"add-case",icon:()=>u(Y,null,null)},{label:"修改用例组",operate:"edit-group",icon:()=>u(Z,null,null)},{label:"删除用例组",operate:"del-group",icon:()=>u(U,null,null)},{label:"从公有库导入",operate:"import-pubcase",icon:()=>u(xe,null,null)}):i.type===1?C.push({label:"修改用例",operate:"edit-case",icon:()=>u(Z,null,null)},{label:"删除用例",operate:"del-case",icon:()=>u(U,null,null)}):i.type===4?C.push({label:"新增子任务",operate:"add-task",icon:()=>u(Y,null,null)},{label:"修改任务",operate:"edit-task",icon:()=>u(Z,null,null)},{label:"删除任务",operate:"del-task",icon:()=>u(U,null,null)},{label:"关联用例",operate:"bind-case",icon:()=>u(Z,null,null)}):i.type===5?C.push({label:"解除绑定",operate:"unbind-case",icon:()=>u(U,null,null)}):i.type==="caseRoot"&&C.push({label:"新增用例",operate:"add-case",icon:()=>u(Y,null,null)},{label:"从公有库导入",operate:"import-pubcase",icon:()=>u(xe,null,null)}),B.value=!0,se.value=l.clientX,ie.value=l.clientY,l.preventDefault()}}}const R={type:0,parentId:0,name:"",version:"",desiredResult:"",time:0,remark:"",path:"",code:"",projectId:+o.query.projectId};function k({parentId:i,id:l}={}){Be.prompt("请输入用例组名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info",beforeClose:(m,{inputValue:v},d)=>{if(m==="cancel")return d();if(!(v||"").trim())return this.$message.error("不能为空");d()}}).then(({value:m})=>{const v={...R,name:m,parentId:i||0,type:3,id:l},d=l?Ge:Qe;console.log(v),d(v).then(I=>{if(I.code!==200)return c.error(I.errMsg||"操作失败");c.success(I.msg||"操作成功"),z()})}).catch(()=>{})}function A(){return[{label:"项目概览",type:"info",checkboxDisabled:!0,id:`${Math.random()}`,prefix:()=>u(st,{size:"20"},null)},{label:"需求",type:"reqRoot",id:`${Math.random()}`,prefix:()=>u(mt,{size:"20"},null),children:[]},{label:"任务",type:"taskRoot",prefix:()=>u(ut,{size:"20"},null),id:`${Math.random()}`,children:[]},{label:"专用用例库",type:"caseRoot",prefix:()=>u(kt,{size:"20"},null),id:`${Math.random()} `,children:[]},{label:"执行记录",type:"history",prefix:()=>u(tt,{size:"20"},null),checkboxDisabled:!0,id:`${Math.random()} `}]}const Ce=y([]);function Re(i){Ce.value=i}return n({checkedKeys:Ce,treeData:w}),(i,l)=>{const m=N("a-input-search"),v=N("Tree"),d=N("NDropdown");return S(),E("div",yt,[p("div",ht,[u(m,{modelValue:M.value,"onUpdate:modelValue":l[0]||(l[0]=I=>M.value=I),placeholder:"请输入查询关键字"},null,8,["modelValue"])]),u(v,{"on-update:checked-keys":Re,data:w.value,class:"Tree",cascade:"",checkable:"","node-props":D,"on-update:selected-keys":j,pattern:M.value,"key-field":"id","render-prefix":J},null,8,["data","pattern"]),u(d,{trigger:"manual",show:B.value,options:C,x:se.value,y:ie.value,"z-index":99,onSelect:ce,onClickoutside:l[1]||(l[1]=I=>B.value=!1)},null,8,["show","options","x","y"])])}}},bt=le(It,[["__scopeId","data-v-ed16cf75"]]),Ct={class:"content"},St={class:"content-box"},xt={class:"item"},jt={class:"item"},wt={class:"item"},At={class:"item"},$t={class:"base-info"},qt={__name:"overview",props:{dataStatis:{type:Object,default(){return{}}}},setup(e){const n=y([]);return n.value=JSON.parse(sessionStorage.getItem("projectInfo")),Ie(()=>{n.value=JSON.parse(sessionStorage.getItem("projectInfo"))}),(s,r)=>{const c=N("a-descriptions");return S(),E(be,null,[p("div",Ct,[r[4]||(r[4]=p("div",{class:"title"},"项目统计",-1)),p("div",St,[p("div",xt,[p("div",null,G(e.dataStatis.reqCount||0),1),r[0]||(r[0]=p("div",null,"需求数",-1))]),p("div",jt,[p("div",null,G(e.dataStatis.taskCount||0),1),r[1]||(r[1]=p("div",null,"任务数",-1))]),p("div",wt,[p("div",null,G(e.dataStatis.caseCount||0),1),r[2]||(r[2]=p("div",null,"专用用例数",-1))]),p("div",At,[p("div",null,G(e.dataStatis.historyCount||0),1),r[3]||(r[3]=p("div",null,"执行任务数",-1))])])]),p("div",$t,[u(c,{data:n.value,size:"large",title:"基本信息",align:"left",column:2},null,8,["data"])])],64)}}},Dt=le(qt,[["__scopeId","data-v-5720b0b2"]]),Nt={__name:"tableList",props:{data:{type:Array,default:()=>[]},column:{type:Array,default:()=>[]}},setup(e){return(n,s)=>{const r=N("STable");return S(),W(r,{columns:e.column,pagination:!1,"data-source":e.data,bordered:"",rowKey:"id",size:"middle",childrenColumnName:"C"},{bodyCell:he(({column:c,record:h})=>[c.render?(S(),W(ze(c.render({record:h})),{key:0})):(S(),E(be,{key:1},[_e(G(h[c.dataIndex]),1)],64))]),_:1},8,["columns","data-source"])}}},zt=le(Nt,[["__scopeId","data-v-243a99d1"]]),_t={class:"main-content"},Rt={class:"navHeader project-header"},Tt={__name:"project-info",setup(e){const{appContext:n}=$e(),{$message:s}=n.config.globalProperties,r=De(),c=qe(),h=y(null),o=y({}),g={INFO:"info",HISTORY:"history",TASK:4,CASE:5,GROUP:3,SINGLE_CASE:1},L=[{title:"批量执行",imgSrc:"images/c-run-all.png",clickHandle:se}],M=y([]),$=y([]),P=y({}),Q=y({}),f=y([]),C=y([]),j=Ne({projectId:c.query.projectId||1,pageNumber:1,pageSize:10,total:0}),J={reqRoot:[{title:"需求名称",align:"center",dataIndex:"Req_Name",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]}},{title:"需求版本",align:"center",dataIndex:"version",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]}}],taskRoot:[{title:"任务名称",align:"center",dataIndex:"name",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]}},{title:"任务版本",align:"center",dataIndex:"version",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]}},{title:"任务描述",align:"center",dataIndex:"dec",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]}}],caseRoot:[{title:"用例组ID",align:"center",dataIndex:"ID",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]}},{title:"用例组名称",align:"center",dataIndex:"name",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]}}],history:[{title:"ID",align:"center",dataIndex:"id",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]},width:50},{title:"开始时间",align:"center",dataIndex:"startTime",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]},width:150},{title:"结束时间",align:"center",dataIndex:"endTime",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]},width:150},{title:"执行周期",align:"center",dataIndex:"runCount",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]}},{title:"执行结果",align:"center",dataIndex:"excuteResult",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]}},{title:"执行人",align:"center",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]},render:({record:t})=>{var a;return(a=t.userInfo)==null?void 0:a.userName}},{title:"创建时间",align:"center",dataIndex:"createTime",ellipsis:!0,tooltip:{title:({record:t,column:a})=>t==null?void 0:t[a.dataIndex]}},{title:"操作",align:"center",ellipsis:!0,render({record:t}){return u(be,null,[u(N("a-button"),{type:"text",onclick:()=>O(t)},{default:()=>[_e("查看")]})])}}]},re={requirement:we,subrequirement:we,4:Ze,3:He,5:je,1:je,history:J.history};function B(t=[],a,b,D="",R=""){!Array.isArray(t)||!t.length||t.forEach(k=>{k.type===g.CASE&&a.includes(k.id)&&b.push({...k,IP:D,taskName:R}),B(k.children,a,b,k.IP||D,k.name||R)})}function se(){const{treeData:t,checkedKeys:a}=h.value;if(!(a!=null&&a.length))return s.error("请选择要执行的用例");const b=t.find(A=>A.label==="任务");if(!b)return s.error("未找到任务节点");const D=[];if(B(b.children,a,D),!D.length)return s.error("请选择要执行的用例");const R=`runKey-${Date.now()}`,k=JSON.stringify(D);try{window.setDBItem(R,JSON.parse(k));const A=new URL("/runTask",window.location.origin);A.searchParams.set("key",R),A.searchParams.set("projectId",c.query.projectId),A.searchParams.set("projectName",_.value),window.open(A.toString(),"_blank")}catch(A){s.error("执行任务失败"),console.error("Failed to execute batch:",A)}}function ie(t){P.value=t,$.value=[],Object.assign(j,{pageNumber:1,pageSize:10});const b={requirement:q,subrequirement:q,[g.TASK]:q,[g.CASE]:q,[g.GROUP]:q,[g.SINGLE_CASE]:q,reqRoot:z,taskRoot:z,caseRoot:z,history:ue}[t.type];b&&b(t)}async function w(){try{const t=await Me(j);j.total=t.total,o.value.historyCount=t.total,C.value=t.data||[]}catch(t){s.error("加载历史记录失败"),console.error("Failed to load history:",t)}}async function q(t){if(f.value=re[t.type],Q.value=t,[g.CASE,g.SINGLE_CASE].includes(t.type))try{const a=await Oe(t.path);Q.value.code=a}catch(a){s.error("获取文件代码失败"),console.error("Failed to get file code:",a)}}function z(t){$.value=J[t.type],M.value=t.children||[]}function ue(){$.value=J.history,w()}function O(t){r.push({name:"historyDetail",query:{recordId:t.id}})}const _=y(""),F=x(()=>P.value.type===g.INFO?Dt:$.value.length?zt:f.value.length?Ve:null),V=x(()=>({data:P.value.type===g.HISTORY?C.value:$.value.length?M.value:Q.value,column:$.value,infoColumn:f.value})),H=x(()=>P.value.type===g.HISTORY);Ie(()=>{ce(),w()});function ce(){try{const a=JSON.parse(sessionStorage.getItem("projectInfo")||"[]").find(b=>b.label==="项目名称");_.value=(a==null?void 0:a.value)||"",j.projectId=Number(c.query.projectId)||1}catch(t){console.error("Failed to initialize project info:",t),_.value="",j.projectId=1}}return(t,a)=>{const b=N("BtnGroup"),D=N("a-pagination"),R=N("a-split");return S(),W(R,{"default-size":"300px",max:.8},{first:he(()=>[u(bt,{ref_key:"projectTreeRef",ref:h,dataStatis:o.value,"onUpdate:dataStatis":a[0]||(a[0]=k=>o.value=k),onSelect:ie},null,8,["dataStatis"])]),second:he(()=>[p("div",_t,[p("div",Rt,[a[3]||(a[3]=p("div",{class:"img-box icon-wrapper"},[p("img",{src:Te,alt:"project icon"})],-1)),p("span",null,G(_.value),1)]),u(b,{data:L}),(S(),W(ze(F.value),{dataStatis:o.value,data:V.value.data,column:V.value.column,infoColumn:V.value.infoColumn},null,8,["dataStatis","data","column","infoColumn"])),H.value?(S(),W(D,{key:0,current:j.pageNumber,"onUpdate:current":a[1]||(a[1]=k=>j.pageNumber=k),"page-size":j.pageSize,"onUpdate:pageSize":a[2]||(a[2]=k=>j.pageSize=k),total:j.total,"show-page-size":"","show-total":"",onChange:w,onPageSizeChange:w},null,8,["current","page-size","total"])):Le("",!0)])]),_:1})}}},Gt=le(Tt,[["__scopeId","data-v-9fc235fa"]]);export{Gt as default};
