import{_ as z}from"./system-mgt-select-BLx3586I.js";import{s as V,r as s,O as S,c as l,a as o,bo as I,D as O,f as A,i as g,m as C,F as T,g as M}from"./index-Dju9e0Mk.js";import{P as U,A as L,G as $,D as P}from"./role-nPyMV3Ri.js";import{u as D}from"./util-CASLgOZv.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-Cr7o0t0N.js";function G(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!O(v)}const H={__name:"role-form",emits:["getList"],setup(v,{expose:y,emit:r}){const{appContext:w}=V(),{$message:_}=w.config.globalProperties,F=r,B={roleName:"",status:1,remark:"",buttons:{},routers:[]},u=s(D.clone(B)),b=s(null),h={roleName:{required:!0,message:"请输入角色名称"}},c=s([]),i=p(I);function p(n=[]){if(!(n!=null&&n.length))return;const d=[];return n.forEach(t=>{var e;(e=t.authorizeButtons)!=null&&e.length&&c.value.push(...t.authorizeButtons),d.push({key:t.name,title:t.meta.title,isPage:!0,children:p(t.children)})}),d}const E=S();return y({open:n=>{var t;if(n){const e=D.clone(n);u.value=Object.assign(e,{buttons:{}}),(t=e.allowBtns)==null||t.forEach(a=>{e.buttons[a.key]=!0}),e.routers=e.allowRouters.map(a=>a.key),delete e.allowBtns,delete e.allowRouters}else u.value=D.clone(B);const d=E.create({title:`${n?"修改":"创建"}角色信息`,positiveText:"确认",positiveButtonProps:{size:"medium"},negativeText:"取消",negativeButtonProps:{size:"medium"},style:{width:"700px"},transformOrigin:"center",autoFocus:!1,content:()=>{let e;return l(o("a-form"),{ref:b,labelPlacement:"left",labelWidth:"auto",rules:h,requireMarkPlacement:"left-hanging",model:u.value,"auto-label-width":!0,style:"padding: 25px 0 10px 0"},{default:()=>[l(o("a-form-item"),{label:"角色名称",field:"roleName"},{default:()=>[l(o("a-input"),{modelValue:u.value.roleName,"onUpdate:modelValue":a=>u.value.roleName=a,placeholder:"请输入角色名称"},null)]}),l(o("a-form-item"),{label:"备注",field:"remark"},{default:()=>[l(o("a-input"),{modelValue:u.value.remark,"onUpdate:modelValue":a=>u.value.remark=a,placeholder:"请填写角色备注"},null)]}),l(o("a-form-item"),{label:"是否启用",field:"status"},{default:()=>[l(o("a-switch"),{modelValue:u.value.status,"onUpdate:modelValue":a=>u.value.status=a,"checked-text":"已启用","checked-value":1,"unchecked-value":0,"unchecked-text":"已关闭"},null)]}),l(o("a-form-item"),{label:"页面权限",field:"routers"},{default:()=>[l(o("NTreeSelect"),{value:u.value.routers,"onUpdate:value":a=>u.value.routers=a,multiple:!0,cascade:!0,filterable:!0,clearable:!0,checkable:!0,"consistent-menu-width":!1,"max-tag-count":5,"label-field":"title",options:i,placeholder:"请选择可以访问的页面","check-strategy":"child"},null)]}),l(o("a-form-item"),{label:"按钮权限",field:"buttons"},{default:()=>[l(o("NSpace"),null,G(e=c.value.map(a=>l(o("a-checkbox"),{modelValue:u.value.buttons[a.key],"onUpdate:modelValue":k=>u.value.buttons[a.key]=k},{default:()=>[a.title]})))?e:{default:()=>[e]})]})]})},onPositiveClick(){return new Promise(e=>{var a;(a=b.value)==null||a.validate(k=>{if(k)return e(!1);d.loading=!0;const N=Object.keys(u.value.buttons),x=c.value.filter(m=>N.includes(m.key)),f={...u.value};f.allowBtns=x,f.allowRouters=u.value.routers.map(m=>({title:m,key:m})),delete f.routers,delete f.buttons,(f.id?U:L)(f).then(m=>{if(m.code!==200)return d.loading=!1,e(!1),_.error(m.errMsg||"操作失败");e(),_.success("操作成功"),F("getList")})})})}})}}),()=>{}}},q={class:"main-content"},K={__name:"role",setup(v){const{appContext:y}=V(),{$message:r,$modal:w}=y.config.globalProperties,_=[{title:"角色名称",dataIndex:"roleName",nameFilter:!0},{title:"角色状态",dataIndex:"status",nameFilter:!0,render({record:t}){const e=t.status===1;return l(o("a-tag"),{color:e?"green":"red"},{default:()=>[e?"已启用":"已停用"]})}},{title:"备注",dataIndex:"remark",nameFilter:!0},{title:"创建时间",dataIndex:"createdTime"},{title:"更新时间",dataIndex:"updatedTime"},{title:"操作",dataIndex:"operate",width:150,render({record:t}){return l(T,null,[l(o("a-button"),{type:"text",onclick:()=>B(t)},{default:()=>[C("修改")]}),l(o("a-popconfirm"),{content:`确认删除角色${t.roleName}吗?`,"content-class":"_user-popContentClass",type:"warning",onOk:()=>u(t)},{default:()=>[l(o("a-button"),{type:"text",disabled:t.isAdmin},{default:()=>[C("删除")]})]})])}}],F=s([]);function B(t){p.value.open(t)}function u(t){P([t.id]).then(e=>{if(e.code!==200)return r.error(e.errMsg||"删除失败");i(),r.success("删除成功")})}const b=s(0),h=s(1),c=s(10);function i(){$({pageNumber:h.value,pageSize:c.value}).then(t=>{if(t.code!==200)return r.error(t.errMsg||"获取角色列表失败");F.value=t.data,b.value=t.total})}i();const p=s(null);function E(){p.value.open()}const R=s(null);function n(){const t=R.value.vxeTabMethods.getCheckboxRecords(!0);if(!t.length)return r.warning("没有选择数据");w.open({title:"提示",content:"确定删除这些数据吗?这将不可恢复",onBeforeOk:e=>{P(t.map(a=>a.id)).then(a=>{if(a.code!==200)return r.error(a.errMsg||"操作失败");R.value.vxeTabMethods.setAllCheckboxRow(!1),e(),i(),r.success("删除成功")})}})}const d=[{clickHandle:E,imgSrc:"images/c-load-all.png",title:"新增角色"},{clickHandle:n,imgSrc:"images/delete.png",title:"批量删除"}];return(t,e)=>{const a=o("BtnGroup"),k=o("AeTable"),N=o("a-pagination");return M(),A(T,null,[g("div",q,[e[2]||(e[2]=g("div",{class:"navHeader"},[g("div",{class:"img-box"},[g("img",{src:z})]),g("span",null,[C("系统管理 / "),g("span",{class:"child-text"},"角色管理")])],-1)),l(a,{data:d}),l(k,{ref_key:"vxeTableRef",ref:R,class:"vxeTableBox",columns:_,data:F.value,hasCheckbox:""},null,8,["data"]),l(N,{current:h.value,"onUpdate:current":e[0]||(e[0]=x=>h.value=x),"page-size":c.value,"onUpdate:pageSize":e[1]||(e[1]=x=>c.value=x),total:b.value,"show-page-size":"","show-total":"",onChange:i,onPageSizeChange:i},null,8,["current","page-size","total"])]),l(H,{ref_key:"roleFormRef",ref:p,onGetList:i},null,512)],64)}}},te=j(K,[["__scopeId","data-v-cd41a780"]]);export{te as default};
