import{r as Z,u as q}from"./xlsx-lMeV0w5e.js";import{G as Y,L as W,S as w,d as X,a as _}from"./dataMonitor-BqNmZQKc.js";import{c as i,a as c,m as L,s as b,j as N,f as P,g as M,r as C,l as $,i as E,F as ee,a0 as te}from"./index-Dju9e0Mk.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-Cr7o0t0N.js";const ae="data:image/png;base64,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";function S(l,A){l.stopPropagation(),l.preventDefault(),A.form.fileList=[]}function le(l,A,e){var d;if((d=e.selectFile)!=null&&d.call(e,A.form))return l.stopPropagation(),l.preventDefault(),!0}function ie(){return{fileIcon({name:l}){return l.includes(".")?i("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:"arco-icon arco-icon-file","stroke-width":"4","stroke-linecap":"butt","stroke-linejoin":"miter"},[i("path",{d:"M16 21h16m-16 8h10m11 13H11a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h21l7 7v27a2 2 0 0 1-2 2Z"},null)]):i("svg",{t:"1683365347269",class:"arco-icon arco-icon-file",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4059",width:"200",height:"200"},[i("path",{d:"M912 208H427.872l-50.368-94.176A63.936 63.936 0 0 0 321.056 80H112c-35.296 0-64 28.704-64 64v736c0 35.296 28.704 64 64 64h800c35.296 0 64-28.704 64-64v-608c0-35.296-28.704-64-64-64z m-800-64h209.056l68.448 128H912v97.984c-0.416 0-0.8-0.128-1.216-0.128H113.248c-0.416 0-0.8 0.128-1.248 0.128V144z m0 736v-96l1.248-350.144 798.752 1.216V784h0.064v96H112z",fill:"rgb(22,93,255)","p-id":"4060"},null)])}}}function ne(l,A){return A.fileTypes.find(e=>e.id===l)}const oe=l=>{const A=ne(l.form.fileType,l);return i("div",null,[i(c("a-form"),{model:l.form,"label-align":"left","auto-label-width":!0},{default:()=>[i(c("a-form-item"),{field:"fileType",label:"文件类型："},{default:()=>[i(c("a-radio-group"),{"model-value":l.form.fileType,"onUpdate:model-value":e=>l.form.fileType=e,onchange:e=>S(e,l),"default-value":1},{default:()=>l.fileTypes.map(e=>i(c("a-radio"),{value:e.id,disabled:e.disabled},{radio:({checked:d})=>i(c("a-space"),{align:"start",class:["custom-radio-card",d?"custom-radio-card-checked":""]},{default:()=>[i("div",{className:"custom-radio-card-mask"},[i("div",{className:"custom-radio-card-mask-dot"},null)]),i("div",null,[i("div",{className:"custom-radio-card-title"},[e.title]),i(c("a-typography-text"),{type:"secondary"},{default:()=>[e.dec]})])]})}))})]}),A.hasIpt?"":i(c("a-form-item"),{field:"fileType",label:"选择文件："},{default:()=>[i(c("a-upload"),{"file-list":l.form.fileList,"onUpdate:file-list":e=>l.form.fileList=e,"auto-upload":!1,ref:"uploadRef",multiple:!0,accept:A.accept,"custom-icon":ie()},{"upload-button":()=>i(c("a-space"),null,{default:()=>[i(c("a-button"),{type:"primary",onclick:e=>le(e,l,A)},{default:()=>[L(" 添加文件"),l.form.fileType===4?"夹":"",L(" ")]}),i(c("a-button"),{onclick:e=>S(e,l)},{default:()=>[L(" 清空列表 ")]})]})})]}),A.hasIpt?i(c("a-form-item"),{field:"fileType",label:"选择文件："},{default:()=>[i(c("a-input"),{style:"width: 480px",modelValue:l.form.filePath,"onUpdate:modelValue":e=>l.form.filePath=e},null)]}):""]})])},se=K(oe,[["__scopeId","data-v-16c95c26"]]),re={__name:"index",props:{fileTypes:{type:Array,defautlt:()=>[]}},emits:["loadFile"],setup(l,{expose:A,emit:e}){const{appContext:d}=b(),{$message:m,$modal:h}=d.config.globalProperties,v=l,F=e,f=N({fileType:1,filePath:"",fileList:[]});let p=null;function D(y){f.filePath=y,p=h.open({title:"导入文件",width:700,okText:"确认",cancelText:"取消",titleAlign:"start",draggable:!0,content:()=>i(se,{fileTypes:v.fileTypes,form:f},null),onBeforeOk(){return F("loadFile",f),!f.fileList.length&&!f.filePath?(m.error("请选择文件!"),!1):!0},onClose:()=>{Object.assign(f,{fileType:1,filePath:"",fileList:[]})}})}function T(){p.close()}return A({open:D,close:T}),(y,B)=>(M(),P("div"))}},ce={class:"main-content"},Ae={class:"aeTable"},ue={__name:"index",setup(l){const{appContext:A}=b(),{$message:e}=A.config.globalProperties,d=new Map,m=N([]);let h="";function v(t,s){return(t||[]).map(n=>{var u;const a=n.attributes.some(g=>g.name==="ParamName"),r=`${s},${n.name}`,o=v(n.children_info,r);return a&&d.set(r,(u=n.attributes.find(g=>g.name==="DataFormatType"))==null?void 0:u.value),{title:n.name,isLeaf:!o.length,key:r,disabled:!a,children:o}})}function F(t){const{title:s,type:n,key:a}=t;return new Promise(r=>{_(s,n).then(({children_info:o})=>{t.children=v(o,a),t.children.length||(t.isLeaf=!0),r()})})}const f=[{title:"Origin Name",dataIndex:"originName",nameFilter:!0},{title:"Message Name",dataIndex:"msgName",nameFilter:!0,width:400,render({record:t}){return i(c("a-tree-select"),{data:m,modelValue:t.selected,"onUpdate:modelValue":s=>t.selected=s,"allow-search":!0,"allow-clear":!0,style:"width: 300px",placeholder:"Please select ...","load-more":F,treeProps:{virtualListProps:{height:300}}},null)}}],p=C([]),D=[{clickHandle:G,imgSrc:"images/d-openFile.png",title:"加载"},{clickHandle:O,imgSrc:"images/i-export.png",title:"生成LOG文件"},{clickHandle:J,imgSrc:"images/c-run-all.png",title:"运行"},{clickHandle:H,imgSrc:"images/c-close-all.png",title:"停止"}],T=[{id:1,title:"飞行文件",dec:"EXCEL",accept:".xlsx"},{id:2,title:"LOG文件",dec:"DATALOG",hasIpt:!0}];$(y);function y(){m.length=0,Y().then(({protocol_list:t})=>{t==null||t.forEach(({message_name:s,protocol_type:n})=>{s==null||s.forEach(a=>{let r=m.find(u=>u.title===n);r||(r={disabled:!0,type:n,title:n,key:n,children:[]},m.push(r));const o=["Analog","Discrete"].includes(n);r.children.push({type:n,title:a,key:`${n},${a}`,isLeaf:o,disabled:!o})})})})}const B=C(!0),V=C(1);let Q=null;function x({fileType:t,fileList:s,filePath:n}){if(t===1){const[{file:a}]=s;V.value=t;const r=new FileReader;r.readAsArrayBuffer(a),r.onload=o=>{Q=new File([o.target.result],"testlog.xlsx");const u=Z(o.target.result,{type:"array"});u.SheetNames.forEach(g=>{const I=u.Sheets[g],R=q.sheet_to_json(I),[j]=R,z=Object.keys(j).map(U=>Object.assign({originName:U,msgName:""}));p.value=z.filter(U=>U.originName.toLocaleUpperCase()!=="TIME")})}}else t===2&&w({log_filepath:n}).then(a=>{if(console.log(a,"res"),a.code!==200)return e.error(a.errMsg);sessionStorage.setItem("replayId",a.id)});B.value=!1}function H(){const t=sessionStorage.getItem("replayId");if(!t)return e.error("没有回放数据");t&&(X(Number(t)),sessionStorage.removeItem("replayId"))}function J(){if(sessionStorage.getItem("replayId"))return e.error("已经有正在回放的数据");if(!h)return e.error("没有选择Log文件");te.success({title:"提示",content:"数据正在回放中..."}),w({log_filepath:h}).then(({error_message:t,id:s})=>{t&&e.error(t),s&&sessionStorage.setItem("replayId",s)})}function O(){const t=[];if(p.value.forEach(a=>{const r=a.selected;if(r){const o=r.split(","),u=o[0];if(u==="A429")t.push({type:u,busName:o[1],messageName:o[2],parameterName:o[3],originName:a.originName,dataFormat:d.get(a.selected)});else if(/(Analog|Discrete)/.test(u))t.push({type:u,messageName:o[1],originName:a.originName});else if(u==="A664"){const g={type:"A664",messageName:o[1],originName:a.originName,datasetName:o[2],dataFormat:d.get(a.selected)},I=o.length;I===4?g.parameterName=o[3]:I===5&&(g.wordName=o[3],g.parameterName=o[4]),t.push(g)}}}),!t.length)return e.error("请匹配数据");const s=new File([new Blob([JSON.stringify(t)],{type:"text/plain"})],"testlog.json"),n=new FormData;n.append(s.name,s),n.append("testlog.xlsx",Q),W(n).then(a=>{if(!a.filepath)throw new Error("请求错误");h=a.filepath,e.success({content:"Log文件生成成功"+h,closable:!0,showIcon:!0,duration:1e4,resetOnHover:!0})}).catch(a=>e.error(String(a)))}const k=C(null);function G(){const t=localStorage.getItem("log_filepath");k.value.open(t)}return(t,s)=>{const n=c("BtnGroup"),a=c("AeTable");return M(),P(ee,null,[E("div",ce,[s[0]||(s[0]=E("div",{class:"navHeader"},[E("div",{class:"img-box"},[E("img",{src:ae})]),E("span",null,"数据回放")],-1)),i(n,{data:D}),E("div",Ae,[i(a,{columns:f,data:p.value},null,8,["data"])])]),i(re,{ref_key:"importFileRef",ref:k,fileTypes:T,onLoadFile:x},null,512)],64)}}},Ee=K(ue,[["__scopeId","data-v-bc3f703a"]]);export{Ee as default};
