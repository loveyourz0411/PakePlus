const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/attrForm-BEHJBVlG.js","assets/index-DAi3yp0Q.js","assets/util-CASLgOZv.js","assets/index-Dju9e0Mk.js","assets/index-peICeNNa.css","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/attrForm-BWX3E3mL.css","assets/projectCondig-B5ACxpnE.js","assets/l-plus-CFFyOWuA.js","assets/empty-SobI8E2D.js","assets/RT-BiAoU_kQ.js","assets/http-Cr7o0t0N.js","assets/xlsx-lMeV0w5e.js","assets/index-bBPWzl2E.js","assets/dataMonitor-BqNmZQKc.js","assets/index-CCxppbjm.js","assets/projectCondig-DdgvAjAj.css"])))=>i.map(i=>d[i]);
import{s as he,r as j,c as S,a as v,D as Mt,E as ze,_ as we,f as Ne,g as Q,G as me,F as ge,m as ae,H as We,j as Vt,z as ce,n as W,p as Ge,i as Y,J as Et,h as Bt,K as Gt,A as Ze,B as bt,y as Oe,L as Wt,M as Lt,k as Rt,b as Ht,v as jt,N as Ut}from"./index-Dju9e0Mk.js";import{_ as Qe}from"./empty-SobI8E2D.js";import{I as le,g as De,a as Dt,f as Ce,m as zt,b as tt,s as wt,c as Kt,d as xt,G as Jt,p as at,r as nt,e as qt,h as it}from"./index-DAi3yp0Q.js";import{u as a}from"./util-CASLgOZv.js";import{e as b,J as Ye,l as Xt,A as Zt,a as Qt,b as Yt,c as ea,d as ta,f as aa,D as na,g as ia,h as la,i as ra,j as sa,k as oa,m as ua,n as ma,o as ca,p as pa,q as _a,r as da,N as $a,s as fa,t as ha,u as Pa,F as Ft,C as Sa,G as Ia}from"./RT-BiAoU_kQ.js";import{h as Na}from"./http-Cr7o0t0N.js";import{u as Ve,w as ga,r as Da}from"./xlsx-lMeV0w5e.js";import{I as Fa}from"./index-bBPWzl2E.js";import{P as Ca}from"./dataMonitor-BqNmZQKc.js";import{_ as Ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{I as ya}from"./index-CCxppbjm.js";const Aa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAzNJREFUaEPtmE+IlWUUxn+PGViog4tqVWSCzlhQg1Qu2lTaVkfIdtKMYIIt1EAIdKIpEASbjYIGOuLOCTK3arVpkUqU4J8S1MiVthD/IIHaiQPfhAz33u+c734fMnDP8t7nPOc87/nO+573FTPcNMPzpyfgcVewV4FeBbpcgd4n1OUCdu3eVQXM7F1gUZdZXJb0fVWOygLMbBOwp2rgaX4fS9pbhauSADN7DrgEzK8StIXPbWCxpOtZvqoCDgLD2WAl+AlJI1nOtAAzewP4GWofQwxYLul0RkRKgJk53pN3EU2YJ+8iXEzIsgL8s/HPp0kbkTQRDRAWYGbesN643sBNmjeyN7Q3dqllBOwGtpYy1gP4StInEaqQADMbAM4CT0ZIa8DcB16VdLGMKyrgOLCyjGza/3eAX4vfBoF5Sf8Tkt4r8ykVYGargaNlRI/8fxPYAhye2k2K3WsdMA4sSHANSfquE76jADObA1wAFgaD+qoPSrrcCm9mPjd5VaLVuAoslfRPu/hlArYDXwSTd9hHkr7uhDezDcD+BOcOSV+mBZjZ88DvwNPBYP8CfZLulgiYC9wCZgV57wH9kq61wretgJl9DowGgzjsD0n9EbyZ+cIsiWALzJikz7ICPgTCJyLwt6RnI0mZ2Q3gmQi2wAxLOpQV8ATwG/BKItBLkrzx2pqZ+YZwJcF5DnhN0sOUAAeb2dvAD4lgk5I+KBFwBFib4HxH0o/pJp5yMLNJ4P1EwE+BXZK8qf83M/Om3QbsTHB9I6mj2MhB9kKxGz2VCPwTsA/4pfBZBmwE3kpw+O4zIOmvTj6lAopPaQcwlgheB3RUUukZFBXgJ7IPVi/WkVmA489i9duewFMcIQFFFYaAbwPB64CskRSav8ICChEngBV1ZNiB46Sk8OSbFbC0uBfMbkjEg+Ie4ANkyFICiir4SLw5xJ4HjUtK3fqqCOgr7sahsSGhwccLvwv7oBe2tICiCv4AdSAcJQZcLyn94lFVgPudAl6P5VaKOgO8mXkPSm+j01Mws5eBY3W8TgOrJJ0vldkCUKkCVQI15dMT0NTKRnl7FYiuVFO4XgWaWtko74yvwH9o1eAxgffuSwAAAABJRU5ErkJggg==",Oa={_TagName:{required:!0,message:"请填写属性名"},_TagValue:{required:!0,message:"请填写属性值"}};function yt(){const{appContext:r}=he(),{$modal:e,$message:t}=r.config.globalProperties,i=j();function u(l=[],c={},_=!1){const d=j({...c}),N=c._TagName;return new Promise(F=>{const g=e.open({title:"属性配置",width:600,okText:"确认",cancelText:"取消",titleAlign:"start",draggable:!0,content:()=>S(v("a-form"),{ref:i,"auto-label-width":!0,rules:Oa,model:d.value},{default:()=>[S(v("a-form-item"),{label:"属性名",field:"_TagName"},{default:()=>[S(v("a-input"),{disabled:_,modelValue:d.value._TagName,"onUpdate:modelValue":n=>d.value._TagName=n,placeholder:"请填写属性名"},null)]}),S(v("a-form-item"),{label:"属性值",field:"_TagValue"},{default:()=>[S(v("a-input"),{modelValue:d.value._TagValue,"onUpdate:modelValue":n=>d.value._TagValue=n,placeholder:"请填写属性值"},null)]}),S(v("a-form-item"),{label:"属性描述",field:"_Description"},{default:()=>[S(v("a-input"),{modelValue:d.value._Description,"onUpdate:modelValue":n=>d.value._Description=n,placeholder:"请填写属性描述"},null)]})]}),onBeforeOk(){var n;return(n=i.value)==null||n.validate(o=>{if(!o){if(l.some(s=>s._TagName===d.value._TagName&&s._TagName!==N))return t.error("属性名已存在");F(d.value),g.close()}}),!1}})})}return{openCustomAttr:u}}function ka(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!Mt(r)}function va(){const r=[],e=le.value.find(t=>t.key===3);return e==null||e.children.forEach(t=>{var i,u;t.key===6?(i=t.children)==null||i.forEach(l=>{var c;(c=l.children)!=null&&c.length&&r.push(...l.children)}):(u=t.children)!=null&&u.length&&r.push(...t.children)}),r}function Ta(){const{appContext:r}=he(),{$modal:e}=r.config.globalProperties;let t=[];function i(){t=va();const l=j([]);return new Promise(c=>{e.open({title:"Exist",width:600,okText:"确认",cancelText:"取消",titleAlign:"start",draggable:!0,content:()=>{let _;return S(v("a-form"),{"auto-label-width":!0},{default:()=>[S(v("a-form-item"),{label:"请选择绑定的消息"},{default:()=>[S(v("a-select"),{modelValue:l.value,"onUpdate:modelValue":d=>l.value=d,placeholder:"请选择绑定的消息",multiple:!0,"allow-search":!0,"allow-clear":!0,"max-tag-count":5},ka(_=t.map(d=>S(v("a-option"),{key:d.key,value:d.key},{default:()=>[d.label]})))?_:{default:()=>[_]})]})]})},onOk:()=>c(u(l.value))})})}function u(l){const c=[];return t.forEach(_=>{l.includes(_.key)&&c.push(_)}),c}return{openExist:i}}const Ma=ze(()=>we(()=>import("./attrForm-BEHJBVlG.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function Va(){const{appContext:r}=he(),{$modal:e,$message:t}=r.config.globalProperties,i=j({});function u(c,_,d,N){return new Promise((F,g)=>{var s;const n=(s=De(_))==null?void 0:s.nameKey;if(!n)return g(Error()),t.error("找不到该标签的配置信息");if(!i.value[`_${n}`])return g(Error()),t.error(`请填写${n}必填项`);Reflect.deleteProperty(i.value,"tagName");const o=Dt(c,i.value,_,d);F(),N&&N(o)})}function l(c,_,d,N){const F=De(_);if(!F)return t.error("找不到该标签的配置信息");i.value={tagName:_};const g=F.tableProps||[];e.open({title:"Create",width:800,okText:"确认",cancelText:"取消",titleAlign:"start",draggable:!0,content:()=>S("div",{style:"overflow: auto; max-height: 65vh;"},[S(Ma,{crtNode:i.value,formItems:g,isCreate:!0,inlineMsg:!0},null)]),onBeforeOk:()=>u(c,_,d,N)})}return{openFormModal:l}}const Ea={__name:"index",props:{searchKey:{type:String,default:""}},emits:["nodeClick"],setup(r,{emit:e}){const{appContext:t}=he(),{$message:i}=t.config.globalProperties,u=r,l=j(),c=j(!1),_=j([]),d=j(0),N=j(0);function F({option:k}){return{onContextmenu(P){_.value=oe(k),m=k,c.value=!0,d.value=P.clientX,N.value=P.clientY,P.stopPropagation(),P.preventDefault()}}}const{openCustomAttr:g}=yt(),{openExist:n}=Ta(),{openFormModal:o}=Va();function s({node:k,dragNode:P,dropPosition:A}){var h,D,O,y,T,x;try{const U=A==="before";if(U||A==="after"){if(typeof k.key=="number"||k.tagName!==P.tagName)return i.error("层级拖拽不允许");const[{node:J,parentNode:ne},{parentNode:Fe,index:Pe}]=Ce([k.originKey||k.key,P.originKey||P.key]),Z=(D=(h=Fe.children)==null?void 0:h.splice(Pe,1))==null?void 0:D[0];if(!Z)return console.error("删除错误");const te=ne.children.indexOf(J);(O=ne==null?void 0:ne.children)==null||O.splice(U?Math.max(0,te-1):te+1,0,Z)}else{const J=De(k.tagName);if(!J)return console.error("getMap 错误",k);const ne=typeof J.nextTagName=="string"?[J.nextTagName]:J.nextTagName;if(!(ne==null?void 0:ne.includes(P.tagName)))return i.error("层级错误");const[{node:Pe},{parentNode:Z,index:te}]=Ce([k.originKey||k.key,P.originKey||P.key]),Se=(T=(y=Z.children)==null?void 0:y.splice(te,1))==null?void 0:T[0];if(!Se)return console.error("删除错误");(x=Pe.children)==null||x.push(Se)}}catch(U){console.log("拖动时候发生未知错误",{node:k,dragNode:P,dropPosition:A},U)}}let m=null,p=null,$=null;function f(k,P=m,A){let h=null;if(typeof A=="object"?h=A:h=tt(p),!h)return;const D={[`_${h.sourceKey}`]:k.data[`_${h.sourceKey}`],[`_${h.targetKey}`]:k.data[`_${h.sourceKey}`]};Dt(P,D,h.target),xt(P.children[P.children.length-1],k)}function I(k){if(!k)return;const P=wt.filter(D=>D.source===k.tagName),A=p.replace("exist-",""),h=P[A>P.length-1?A-2:A];if(!h)return i.error("Exist 发生错误");f(k,m,h)}function E(k){var P,A;try{if(c.value=!1,p=k,k.includes("new-")){const[{node:h}]=Ce([m.originKey||m.key]);o(h,k.replace("new-",""))}else if(k.includes("pre-")){const[{index:h,parentNode:D}]=Ce([m.originKey||m.key]);o(D,k.replace("pre-",""),h)}else if(k.includes("next-")){const[{index:h,parentNode:D}]=Ce([m.originKey||m.key]);o(D,k.replace("next-",""),h+1)}else if(k==="remove"){let h=function(O,y){O==null||O.forEach((T,x)=>{var U;T.key===y||T.originKey===y?O.splice(x,1):(U=T.children)!=null&&U.length&&h(T.children,y,T)})},D=function(O,y,T,x){var U,ee;if(O.key===y){if(zt.includes(O.tagName))if(O.originKey){const J=x.children.indexOf(T);x.children.splice(J,1)}else h(le.value,O.key);else{const[{index:J,parentNode:ne}]=Ce([O.originKey||O.key]);ne.children.splice(J,1)}return!0}else if((U=O.children)!=null&&U.length)return(ee=O.children)==null?void 0:ee.some(J=>D(J,y,O,T));return!1};(P=le.value)==null||P.some(O=>D(O,m.key))}else if(k==="copy")$=m,i.success(`复制 ${m.label} 成功`);else if(k==="Tag")g(m.data.Tag).then(h=>{var D;(D=m.data.Tag)!=null&&D.length?m.data.Tag.push(h):m.data.Tag=[h]});else if(k.includes("exist-"))n().then(h=>h==null?void 0:h.forEach(D=>I(D)));else if(k==="paste"){const[{node:h}]=Ce([m.originKey||m.key]),D=V($);h.children||(h.children=[]),h.children.push(D),i.success("粘贴成功")}else{const h=tt(k);if(!h)return i.error("映射关系发生错误");const D=(A=z())==null?void 0:A.children.find(O=>O.tagName===h.source);o(D,h.source,void 0,O=>f(O,m,h.source))}}catch(h){console.log("发生未知错误",k,m,h)}}function V(k){var h;const P=a.randomString(),A=Kt(Object.assign(a.clone(k),{key:P,children:[]}));return(h=k.children)==null||h.forEach(D=>A.children.push(V(D))),A.data._GUID=P,A}const z=()=>le.value.find(k=>k.key===3);function R(k=""){return u.searchKey?k.toLowerCase().indexOf(u.searchKey.toLowerCase()):-1}function B(k){const{label:P="",tagName:A=""}=k,h=A.toLocaleUpperCase(),D=R(P),O=h.includes("SUB")?"Subscribe: ":h.includes("PUB")?"Publish: ":"";return D<0?`${O}${P}`:S(ge,null,[O,P.substr(0,D),S("span",{style:"background: yellow"},[P.substr(D,u.searchKey.length)]),P.substr(D+u.searchKey.length)])}const $e=({option:k,dragPreNode:P,dragInsideNode:A,dragNextNode:h})=>S("div",{class:[P===k?"node-pre":"",A===k?"node-inside":"",h===k?"node-next":""],"data-key":k.key,style:"white-space: nowrap;"},[B(k)]);function oe(k){const{tagName:P,label:A,key:h}=k,D=!isNaN(h),O=[],y=De(P);if(!y)return[];const T=[];if($&&y){const x=typeof y.nextTagName=="string"?[y.nextTagName]:y.nextTagName||[],U=D&&P===$.tagName,ee=!D&&x.includes($.tagName);(U||ee)&&T.push({label:`Paste ${$.label}`,value:"paste"})}if(D)P==="Simulation"?O.push({label:`Add New 'ATA' on ${A}`,value:"new-ATA"}):h!=="3"&&O.push({label:`Add New '${P}' on ${A}`,value:`new-${P}`});else{const x=typeof y.nextTagName=="string"?[y.nextTagName]:y.nextTagName||[];x==null||x.forEach(ee=>{ee&&O.push({label:`Add New '${ee}' on ${A}`,value:`new-${ee}`})}),Jt.includes(P)&&O.push({label:`在  ${A} 上面新增 '${P}'`,value:`pre-${P}`},{label:`在  ${A} 下面新增 '${P}'`,value:`next-${P}`})}return y!=null&&y.menuData&&O.push(...y==null?void 0:y.menuData),y.hasCustom&&!D&&O.push({label:`Add New 'Custom Tag' on ${A}`,value:"Tag"}),D||O.push({label:`Copy on ${A}`,value:"copy"}),D||O.push({label:`Remove ${A}`,value:"remove"}),O.concat(T)}const ke=e;function be(k,[P]){ke("nodeClick",P)}return(k,P)=>{const A=v("Tree"),h=v("NDropdown");return Q(),Ne(ge,null,[S(A,{ref_key:"TreeRef",ref:l,data:me(le),draggable:"",pattern:r.searchKey,"on-update:selected-keys":be,"render-label":$e,"default-expanded-keys":[3],"node-props":F,onDrop:s},null,8,["data","pattern"]),S(h,{trigger:"manual",show:c.value,"key-field":"value",options:_.value,x:d.value,y:N.value,"z-index":99,onSelect:E,onClickoutside:P[0]||(P[0]=D=>c.value=!1)},null,8,["show","options","x","y"])],64)}}},{eachData:H,a664Predix:L,npdPredix:ie,nameFilter:C,dftMap:Ie}=a;function Ba(r=[],e=[],t,i,u,l,c,_,d,N,F,g){return`
#ifndef SIMULINKPARTICIPANTIO_DEFINE
#define SIMULINKPARTICIPANTIO_DEFINE
#include "VIPBaseTypes.h"
#ifndef VIP_Control_DEF
#define VIP_Control_DEF
typedef struct {
 VIP_Bool Pause;
 VIP_Double Warp;
} VIP_Control;
#endif

////////////////////////Iteration for each A664SubscribePort/PublishPort/////////////////////////////////////////
${H(c,(n,o)=>`
#ifndef ${L(n,o)}_${C(n._PortName)}_DEF
#define ${L(n,o)}_${C(n._PortName)}_DEF
////////////////////////Iteration for each DATASET in the message///////////
${H(n.children,(s,m)=>`
#ifndef ${L(n,o,m)}_${C(s._DataSetName)}_DEF
#define ${L(n,o,m)}_${C(s._DataSetName)}_DEF
//////1. A664 word////////
 ////////////////////////Iteration for each A429word in the dataset///////////
 ${H(s.children,(p,$)=>p._WordName?`
#ifndef ${L(n,o,m)}W${$}_${C(p._WordName)}_DEF
#define ${L(n,o,m)}W${$}_${C(p._WordName)}_DEF
 /////////////Iteration for each emuration in the A429word /////
 ${H(p.children,f=>{if(f._DataFormatType==="Enumeration")return`
 enum e${L(n,o,m)}W${$}_${C(f._ParamName)} {
 e${L(n,o,m)}W${$}_${C(f._ParamName)}_Undefined = 0x7FFFFFFF,
 /////////////Iteration for each Value in the Emuration ///
 ${H(f.children,(I,E)=>`
 e${L(n,o,m)}W${$}_${C(f._ParamName)}_${C(I._Value)} = ${I._ID}${E>=(f.children||[]).length-1?"":","}//最后一个不需要逗号
`)}
 //////////end of Iteration///////////////////
 };
`})}
 //////////end of Iteration emuration///////////////////
typedef struct {
 VIP_Int8 SDI;
 /////////Iteration for each param in the A429word /////
 ${H(p.children,f=>`${f._DataFormatType==="Enumeration"?`e${L(n,o,m)}_${C(f._ParamName)}`:`VIP_${Ie({},f,$)}`} ${C(f._ParamName)};
`)}
 //////////end of Iteration///////////////////
 VIP_Int8 SSM;
} ${L(n,o,m)}W${$}_${C(p._WordName)};
#endif
`:"")}
 /////////////////////////end of Iteration word////////////////////////////
//////2. A664 Message DataSet////////


${H(s.children,p=>{if(!(!p._ParamName||p._DataFormatType!=="Enumeration"))return`
enum e${L(n,o,m)}_${C(p._ParamName)} {
e${L(n,o,m)}_${C(p._ParamName)}_Undefined = 0x7FFFFFFF,
/////////////Iteration for each Value in the Emuration ///
${H(p.children,($,f)=>`
e${L(n,o,m)}_${C(p._ParamName)}_${C($._Value)} = ${$._ID}${f>=(p.children||[]).length-1?"":","}//最后一个不需要逗号
`)}
//////////end of Iteration///////////////////
};
`})}


typedef struct {
 ////////////////////////Iteration for each 664param/A429word in thedataset///////////
 ${H(s.children,(p,$)=>p._ParamName?`${p._DataFormatType==="Enumeration"?`e${L(n,o,m)}_${C(p._ParamName)} `:`VIP_${Ie({},p,$)}`} ${C(p._ParamName)};
`:p._WordName?`${L(n,o,m)}W${$}_${C(p._WordName)} ${C(p._WordName)};
`:"")}
 //////////end of Iteration///////////////////
 VIP_UInt32 FSF;
} ${L(n,o,m)}_${C(s._DataSetName)};
#endif //dataset
`)}
 /////////////////////////end of Iteration dataset////////////////////////////

//////3. A664 Message structure////////
typedef struct {
////////////////////////Iteration for each dataset///////////
${H(n.children,(s,m)=>`
  ${L(n,o,m)}_${C(s._DataSetName)} ${C(s._DataSetName)};
`)}
////////////////////////end Iteration for each dataset///////////
////////////////对于subscribe port生成freshness//////////////////////////
${n.Direction==="I"?`VIP_Bool ${C(n._PortName)}_Freshness;`:""}
} ${L(n,o)}_${C(n._PortName)};
#endif
`)}
/////////////////////////////end of Iteration port/////////////////////////////////////

////////////////////////Iteration for each A664SubscribePort/PublishPort/////////////////////////////////////////
${H(_,(n,o)=>`
#ifndef ${L(n,o)}_${C(n._PortName)}_DEF
#define ${L(n,o)}_${C(n._PortName)}_DEF
////////////////////////Iteration for each DATASET in the message///////////
${H(n.children,(s,m)=>`
#ifndef ${L(n,o,m)}_${C(s._DataSetName)}_DEF
#define ${L(n,o,m)}_${C(s._DataSetName)}_DEF
//////1. A664 word////////
 ////////////////////////Iteration for each A429word in the dataset///////////
 ${H(s.children,(p,$)=>p._WordName?`
#ifndef ${L(n,o,m)}W${$}_${C(p._WordName)}_DEF
#define ${L(n,o,m)}W${$}_${C(p._WordName)}_DEF
 /////////////Iteration for each emuration in the A429word /////
 ${H(p.children,f=>{if(f._DataFormatType==="Enumeration")return`
 enum e${L(n,o,m)}W${$}_${C(f._ParamName)} {
 e${L(n,o,m)}W${$}_${C(f._ParamName)}_Undefined = 0x7FFFFFFF,
 /////////////Iteration for each Value in the Emuration ///
 ${H(f.children,(I,E)=>`
 e${L(n,o,m)}W${$}_${C(f._ParamName)}_${C(I._Value)} = ${I._ID}${E>=(f.children||[]).length-1?"":","}//最后一个不需要逗号
`)}
 //////////end of Iteration///////////////////
 };
`})}
 //////////end of Iteration emuration///////////////////
typedef struct {
 VIP_Int8 SDI;
 /////////Iteration for each param in the A429word /////
 ${H(p.children,f=>`${f._DataFormatType==="Enumeration"?`e${L(n,o,m)}_${C(f._ParamName)}`:`VIP_${Ie({},f,$)}`} ${C(f._ParamName)};
`)}
 //////////end of Iteration///////////////////
 VIP_Int8 SSM;
} ${L(n,o,m)}W${$}_${C(p._WordName)};
#endif
`:"")}
 /////////////////////////end of Iteration word////////////////////////////
//////2. A664 Message DataSet////////


${H(s.children,p=>{if(!(!p._ParamName||p._DataFormatType!=="Enumeration"))return`
enum e${L(n,o,m)}_${C(p._ParamName)} {
e${L(n,o,m)}_${C(p._ParamName)}_Undefined = 0x7FFFFFFF,
/////////////Iteration for each Value in the Emuration ///
${H(p.children,($,f)=>`
e${L(n,o,m)}_${C(p._ParamName)}_${C($._Value)} = ${$._ID}${f>=(p.children||[]).length-1?"":","}
`)}
//////////end of Iteration///////////////////
};
`})}


typedef struct {
 ////////////////////////Iteration for each 664param/A429word in thedataset///////////
 ${H(s.children,(p,$)=>p._ParamName?`${p._DataFormatType==="Enumeration"?`e${L(n,o,m)}_${C(p._ParamName)} `:`VIP_${Ie({},p,$)}`} ${C(p._ParamName)};
`:p._WordName?`${L(n,o,m)}W${$}_${C(p._WordName)} ${C(p._WordName)};
`:"")}
 //////////end of Iteration///////////////////
 VIP_UInt32 FSF;
} ${L(n,o,m)}_${C(s._DataSetName)};
#endif //dataset
`)}
 /////////////////////////end of Iteration dataset////////////////////////////

//////3. A664 Message structure////////
typedef struct {
////////////////////////Iteration for each dataset///////////
${H(n.children,(s,m)=>`
  ${L(n,o,m)}_${C(s._DataSetName)} ${C(s._DataSetName)};
`)}
////////////////////////end Iteration for each dataset///////////
////////////////对于subscribe port生成freshness//////////////////////////
${n.Direction==="I"?`VIP_Bool ${C(n._PortName)}_Freshness;`:""}
} ${L(n,o)}_${C(n._PortName)};
#endif
`)}
/////////////////////////////end of Iteration port/////////////////////////////////////

${c.length?`
//A664_Outputs
typedef struct {
////////////////////////Iteration for each A664PublishPort/////////
${H(c,(n,o)=>`
  ${L(n,o)}_${C(n._PortName)} ${C(n._PortName)};
`)}
/////////////////////////////end of Iteration////////////////////////
}A664_Outputs;
`:""}

${_.length?`
//A664_Inputs
typedef struct {
////////////////////////Iteration for each A664SubscribePort/////////
${H(_,(n,o)=>`
${L(n,o)}_${C(n._PortName)} ${C(n._PortName)};
`)}
/////////////////////////////end of Iteration////////////////////////
}A664_Inputs;
`:""}

${r.map((n,o)=>`
${(n.children||[]).map((s,m)=>`
#ifndef ${a.wordPredix(n,o,m)}_${a.nameFilter(s._WordName)}_DEF
#define ${a.wordPredix(n,o,m)}_${a.nameFilter(s._WordName)}_DEF
${(s.children||[]).map(p=>p._DataFormatType==="Enumeration"?`
enum e${a.wordPredix(n,o,m)}_${a.nameFilter(p._ParamName)}{
e${a.wordPredix(n,o,m)}_${a.nameFilter(p._ParamName)}_Undefined = 0x7FFFFFFF,
${(p.children||[]).map(($,f)=>`
e${a.wordPredix(n,o,m)}_${a.nameFilter(p._ParamName)}_${a.nameFilter($._Value)} = ${$._ID}${f>=p.children.length-1?"":","}
`).join("")}
};
`:"").join("")}

typedef struct {
  VIP_Int8 SDI;
  ${(s.children||[]).map(p=>`
  ${p._DataFormatType!=="Enumeration"?"VIP_":""}${a.dftMap(n,p,m,o)} ${a.nameFilter(p._ParamName)};
`).join("")}
  VIP_Int8 SSM;
} ${a.wordPredix(n,o,m)}_${a.nameFilter(s._WordName)};
#endif
`).join("")}
      `).join("")}
${e.map((n,o)=>`
${(n.children||[]).map((s,m)=>`
#ifndef ${a.wordPredix(n,o,m)}_${a.nameFilter(s._WordName)}_DEF
#define ${a.wordPredix(n,o,m)}_${a.nameFilter(s._WordName)}_DEF
${(s.children||[]).map(p=>p._DataFormatType==="Enumeration"?`
enum e${a.wordPredix(n,o,m)}_${a.nameFilter(p._ParamName)}{
e${a.wordPredix(n,o,m)}_${a.nameFilter(p._ParamName)}_Undefined = 0x7FFFFFFF,
${(p.children||[]).map(($,f)=>`
e${a.wordPredix(n,o,m)}_${a.nameFilter(p._ParamName)}_${a.nameFilter($._Value)} = ${$._ID}${f>=p.children.length-1?"":","}
`).join("")}
};
`:"").join("")}

typedef struct {
  VIP_Int8 SDI;
  ${(s.children||[]).map(p=>`
  ${p._DataFormatType!=="Enumeration"?"VIP_":""}${a.dftMap(n,p,m,o)} ${a.nameFilter(p._ParamName)};
`).join("")}
  VIP_Int8 SSM;
} ${a.wordPredix(n,o,m)}_${a.nameFilter(s._WordName)};
#endif
`).join("")}
      `).join("")}

${e.map((n,o)=>`
#ifndef ${a.busPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
#define ${a.busPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
typedef struct {
  ${(n.children||[]).map((s,m)=>`
  ${a.wordPredix(n,o,m)}_${a.nameFilter(s._WordName)} ${a.nameFilter(s._WordName)};
  VIP_Bool ${a.nameFilter(s._WordName)}_Freshness;
`).join("")}
}${a.busPredix(n,o)}_${a.nameFilter(n._PortName)};
#endif
`).join("")}
${r.map((n,o)=>`
#ifndef ${a.busPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
#define ${a.busPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
typedef struct {
  ${(n.children||[]).map((s,m)=>`
  ${a.wordPredix(n,o,m)}_${a.nameFilter(s._WordName)} ${a.nameFilter(s._WordName)};
`).join("")}
}${a.busPredix(n,o)}_${a.nameFilter(n._PortName)};
#endif
`).join("")}

${r!=null&&r.length?`
typedef struct {
  ${r.map((n,o)=>`
    ${a.busPredix(n,o)}_${a.nameFilter(n._PortName)} ${a.nameFilter(n._PortName)};
  `).join("")}
  } A429_Outputs;
`:""}

${e!=null&&e.length?`
typedef struct {
${e.map((n,o)=>`
  ${a.busPredix(n,o)}_${a.nameFilter(n._PortName)} ${a.nameFilter(n._PortName)};
`).join("")}
} A429_Inputs;
`:""}

${t.map((n,o)=>`
#ifndef ${a.disPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
#define ${a.disPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
typedef struct {
  VIP_Bool ${a.nameFilter(n._PortName)}_Value;
  VIP_Bool ${a.nameFilter(n._PortName)}_Freshness;
}${a.disPredix(n,o)}_${a.nameFilter(n._PortName)};
#endif
`).join("")}
  
${i.map((n,o)=>`
#ifndef ${a.disPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
#define ${a.disPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
typedef struct {
  VIP_Bool ${a.nameFilter(n._PortName)}_Value;
}${a.disPredix(n,o)}_${a.nameFilter(n._PortName)};
#endif
`).join("")}
${i.map((n,o)=>`
typedef struct {
  ${a.disPredix(n,o)}_${a.nameFilter(n._PortName)} ${a.nameFilter(n._PortName)};
} Discrete_Outputs;
`).join("")}
${t.map((n,o)=>`
typedef struct {
  ${a.disPredix(n,o)}_${a.nameFilter(n._PortName)} ${a.nameFilter(n._PortName)};
} Discrete_Inputs;
`).join("")}

${l.map((n,o)=>`
#ifndef ${a.anaPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
#define ${a.anaPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
typedef struct {
 VIP_Float ${a.nameFilter(n._PortName)}_Value;
 VIP_Bool ${a.nameFilter(n._PortName)}_Freshness;
}${a.anaPredix(n,o)}_${a.nameFilter(n._PortName)};
#endif
`).join("")}
${u.map((n,o)=>`
#ifndef ${a.anaPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
#define ${a.anaPredix(n,o)}_${a.nameFilter(n._PortName)}_DEF
typedef struct {
  VIP_Bool ${a.nameFilter(n._PortName)}_Value;
}${a.anaPredix(n,o)}_${a.nameFilter(n._PortName)};
#endif
`).join("")}
${l!=null&&l.length?`
typedef struct {
  ${l.map((n,o)=>`
  ${a.anaPredix(n,o)}_${a.nameFilter(n._PortName)} ${a.nameFilter(n._PortName)};
  `).join("")}
}Analog_Inputs;
`:""}

${u!=null&&u.length?`
typedef struct {
  ${u.map((n,o)=>`
  ${a.anaPredix(n,o)}_${a.nameFilter(n._PortName)} ${a.nameFilter(n._PortName)};
  `).join("")}
}Analog_Outputs;
`:""}

////////////////////////Iteration for each AnalogSubscribePort/PublishPort/////////
${H(d,(n,o)=>`
//对于NPDPublishPort 使用如下代码模板
#ifndef ${ie(n,o)}_${C(n._PortName)}_DEF
#define ${ie(n,o)}_${C(n._PortName)}_DEF

/////////////Iteration for each param/////
${H(n.children,s=>s._DataFormatType==="Enumeration"?`
enum e${ie(n,o)}_${C(s._ParamName)} {
e${ie(n,o)}_Undefined = 0x7FFFFFFF,
/////////////Iteration for each Value in the Emuration ///
${H(s.children,(m,p)=>`e${ie(n,o)}_${a.nameFilter(m._Value)} = ${m._ID}${p>=s.children.length-1?"":","}
`)}
//////////end of Iteration///////////////////
};
`:"")}
//////////end of Iteration param///////////////////

typedef struct {
 ////////////////////////Iteration for each param NPDSubscribePort/////////
    ${H(n.children,s=>{var m;return(m=s._DataFormatType)!=null&&m.includes("Array")||s._DataFormatType==="String"?`VIP_${Ie({},s,o)} ${C(s._ParamName)}[${s._ArrayLength}];
`:s._DataFormatType==="Enumeration"?`e${ie(n,o)}_${C(s._ParamName)} ${C(s._ParamName)};
`:`VIP_${Ie({},s,o)} ${C(s._ParamName)};
`})}
/////////////////////////////end of Iteration param////////////////////////
}${ie(n,o)}_${C(n._PortName)};
#endif
`)}
/////////////////////////////end of Iteration///////////////////
////////////////////////Iteration for each AnalogSubscribePort/PublishPort/////////
${H(N,(n,o)=>`
//对于NPDSubscribePort使用如下代码模板
#ifndef ${ie(n,o)}_${C(n._PortName)}_DEF
#define ${ie(n,o)}_${C(n._PortName)}_DEF
  /////////////Iteration for each param/////
  ${H(n.children,s=>s._DataFormatType==="Enumeration"?`
enum e${ie(n,o)}_${C(s._ParamName)} {
  e${ie(n,o)}_Undefined = 0x7FFFFFFF,
/////////////Iteration for each Value in the Emuration ///
${H(s.children,(m,p)=>`e${ie(n,o)}_${a.nameFilter(m._Value)} = ${m._ID}${p>=s.children.length-1?"":","}
`)}
//////////end of Iteration///////////////////
  };
`:"")}
  //////////end of Iteration param///////////////////
typedef struct {
////////////////////////Iteration for each param NPDSubscribePort/////////
${H(n.children,s=>{var m;return(m=s._DataFormatType)!=null&&m.includes("Array")||s._DataFormatType==="String"?`VIP_${Ie({},s,o)} ${C(s._ParamName)}[${s._ArrayLength}];
`:s._DataFormatType==="Enumeration"?`e${ie(n,o)}_${C(s._ParamName)} ${C(s._ParamName)};
`:`VIP_${Ie({},s,o)} ${C(s._ParamName)};
`})}
/////////////////////////////end of Iteration param////////////////////////
  VIP_Bool ${C(n._PortName)}_Freshness;
}${ie(n,o)}_${C(n._PortName)};
#endif
`)}
/////////////////////////////end of Iteration///////////////////

//若存在任意NPDSubscribePort 生成NPD_Inputs
${N.length?`typedef struct {
  ${H(N,(n,o)=>`${ie(n,o)}_${C(n._PortName)} ${C(n._PortName)};
`)}
  }NPD_Inputs;
`:""}

${d.length?`typedef struct {
  ${H(d,(n,o)=>`${ie(n,o)}_${C(n._PortName)} ${C(n._PortName)};
`)}
} NPD_Outputs;
`:""}



${F!=null&&F.length?`typedef struct {
  ${H(F,n=>`${n}_Inputs ${n}_Inputs;
`)}
  VIP_Control VIP_Control;
} SimulationParticipant_Inputs;
`:""}

${g!=null&&g.length?`typedef struct {
  ${H(g,n=>`${n}_Outputs ${n}_Outputs;
`)}
} SimulationParticipant_Outputs;
#endif
`:""}

`}function Ga(r){return`#include "SimulationInputs_CG.h"
void SimulationInputs::ReceiveAndSetSimulinkA429Inputs(SimulationParticipant_Inputs*aInputs)
  {
    m_A429Inputs->receive();
  ${b(r,(e,t)=>`
    ${b(e.children,(i,u)=>`aInputs->A429_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(i._WordName)}_Freshness = false;
    if (m_A429Inputs->${a.nameFilter(e._PortName)}->${a.nameFilter(i._WordName)}->getReceivedFlag() != 0)
    {
    m_A429Inputs->${a.nameFilter(e._PortName)}->${a.nameFilter(i._WordName)}->setReceivedFlag(0);
    aInputs->A429_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(i._WordName)}_Freshness = true;
  }
  ${i._SDI?`aInputs->A429_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(i._WordName)}.SDI =
  (VIP_Int8) m_A429Inputs->${a.nameFilter(e._PortName)}->${a.nameFilter(i._WordName)}->getSDI();
  `:""}
  ${i._DefaultSSM?`aInputs->A429_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(i._WordName)}.SSM =
  (VIP_Int8) m_A429Inputs->${a.nameFilter(e._PortName)}->${a.nameFilter(i._WordName)}->getSSM();
  `:""}
  ${b(i.children,l=>l._DataFormatType!=="Enumeration"?`
aInputs->A429_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(i._WordName)}.${a.nameFilter(l._ParamName)} =
m_A429Inputs->${a.nameFilter(e._PortName)}->${a.nameFilter(i._WordName)}->${a.nameFilter(l._ParamName)}->getValue();
  `:`
aInputs->A429_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(i._WordName)}.${a.nameFilter(l._ParamName)} =
static_cast<e${a.wordPredix(e,t,u)}_${a.nameFilter(l._ParamName)}>(m_A429Inputs->${a.nameFilter(e._PortName)}->${a.nameFilter(i._WordName)}->${a.nameFilter(l._ParamName)}->getValueID());
  `)}
    `)}
  `)}
 } 
`}const{eachData:ba}=a;function Wa(r){return`#include "SimulationInputs_CG.h"
${ba(r,e=>`void SimulationInputs::ReceiveAndSetSimulinkDiscreteInputs(SimulationParticipant_Inputs* aInputs)
{
  aInputs->Discrete_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(e._PortName)}_Freshness = false;
  while (m_DiscreteInputs->${a.nameFilter(e._PortName)}->receive() == VIP_Success )
  {
  if ( aInputs->Discrete_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(e._PortName)}_Freshness == false )
  {
  aInputs->Discrete_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(e._PortName)}_Freshness = true;
  }
  };
  aInputs->Discrete_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(e._PortName)}_Value = m_DiscreteInputs->
${a.nameFilter(e._PortName)}->getValue();
}
`)}
`}const{eachData:La}=a;function Ra(r){return`#include "SimulationInputs_CG.h"
void SimulationInputs::ReceiveAndSetSimulinkAnalogInputs(SimulationParticipant_Inputs*
  aInputs)
  {
  ${La(r,e=>`
    aInputs->Analog_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(e._PortName)}_Freshness = false;
    while (m_AnalogInputs->${a.nameFilter(e._PortName)}->receive() == VIP_Success )
    {
    if ( aInputs->Analog_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(e._PortName)}_Freshness == false )
    {
    aInputs->Analog_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(e._PortName)}_Freshness = true;
    }
    };
    aInputs->Analog_Inputs.${a.nameFilter(e._PortName)}.${a.nameFilter(e._PortName)}_Value = m_AnalogInputs->
  ${a.nameFilter(e._PortName)}->getValue();
  `)}
  }
`}const{eachData:Ha}=a;function ja(r){return`#include "SimulationOutputs_CG.h"
void SimulationOutputs::SendDiscreteOutputsFromSimulink(SimulationParticipant_Outputs *aOutputs)
  {
  ${Ha(r,e=>`
    m_DiscreteOutputs->${a.nameFilter(e._PortName)}->setValue(aOutputs->Discrete_Outputs.${a.nameFilter(e._PortName)}.
  ${a.nameFilter(e._PortName)}_Value);
  `)}
    m_DiscreteOutputs->send();
  }
`}const{eachData:Ua}=a;function za(r){return`#include "SimulationOutputs_CG.h"
void SimulationOutputs::SendAnalogOutputsFromSimulink(SimulationParticipant_Outputs *aOutputs)
  {
  ${Ua(r,e=>`
    m_AnalogOutputs->${a.nameFilter(e._PortName)}->setValue(aOutputs->Analog_Outputs.${a.nameFilter(e._PortName)}.
  ${a.nameFilter(e._PortName)}_Value);
  `)}
    m_AnalogOutputs->send();
  }
    
`}const{eachData:xe}=a;function wa(r){return`#include "SimulationOutputs_CG.h"
void SimulationOutputs::SendA429OutputsFromSimulink(SimulationParticipant_Outputs *aOutputs)
  {
    ${xe(r,e=>`
    ${xe(e.children,t=>`
      ${t._SDI?`m_A429Outputs-> ${a.nameFilter(e._PortName)} -> ${a.nameFilter(t._WordName)}->setSDI((VIP_UInt32)aOutputs->A429_Outputs.
      ${a.nameFilter(e._PortName)}.${a.nameFilter(t._WordName)}.SDI);
      `:""}
      ${t._DefaultSSM?`m_A429Outputs->${a.nameFilter(e._PortName)}->${a.nameFilter(t._WordName)}->setSSM((VIP_UInt32)aOutputs->A429_Outputs.
      ${a.nameFilter(e._PortName)}.${a.nameFilter(t._WordName)}.SSM);
      `:""}

      ${xe(t.children,i=>i._DataFormatType!=="Enumeration"?`
      m_A429Outputs->${a.nameFilter(e._PortName)}->${a.nameFilter(t._WordName)}->${a.nameFilter(i._ParamName)}->setValue(aOutputs->A429_Outputs.
      ${a.nameFilter(e._PortName)}.${a.nameFilter(t._WordName)}.${a.nameFilter(i._ParamName)});
      `:`
      m_A429Outputs->${a.nameFilter(e._PortName)}->${a.nameFilter(t._WordName)}->${a.nameFilter(i._ParamName)}->setValueID((VIP_Int32)aOutputs->A429_Outputs.
      ${a.nameFilter(e._PortName)}.${a.nameFilter(t._WordName)}.${a.nameFilter(i._ParamName)});
      `)}
    `)}
    `)}
    m_A429Outputs->send();
  }
`}const{eachData:Je}=a;function Ka(r){return`
#pragma once
#include "SimulinkParticipantIO_CG.h"

${Je(r,e=>`
#include "${e}Inputs_CG.h"
`)}

class SimulationInputs
{
private:
 VIP_ParticipantHandle m_ParticipantHandle;
${Je(r,e=>`
    ${e}Inputs* m_${e}Inputs;
`)}
public:
 SimulationInputs(VIP_ParticipantHandle aParticipantHandle);
 ~SimulationInputs();
 VIP_Result initialise();
 void StartAllPeriodics();
 void StopAllPeriodics();
 void ReceiveAndSetSimulinkInputs(SimulationParticipant_Inputs* aInputs);
 void ReceiveVIPControlInputs(SimulationParticipant_Inputs* aInputs);
${Je(r,e=>`
    void ReceiveAndSetSimulink${e}Inputs(SimulationParticipant_Inputs* aInputs);
`)}
};

`}const{eachData:Le}=a;function xa(r){return`
#include "SimulationInputs_CG.h"

SimulationInputs::SimulationInputs(VIP_ParticipantHandle aParticipantHandle)
{
 m_ParticipantHandle = aParticipantHandle;
${Le(r,e=>`
    m_${e}Inputs = new ${e}Inputs(m_ParticipantHandle);
`)}
}

SimulationInputs::~SimulationInputs()
{
${Le(r,e=>`
 if (m_${e}Inputs != NULL)
 {
 delete m_${e}Inputs;
 }
`)}
}

VIP_Result SimulationInputs::initialise()
{
//1)
 VIP_Result lResult = VIP_Success;
 VIP_Result lLocalResult = VIP_Success;
 ${r.map(e=>["A429","NPD","EVENT"].includes(e)?`
    lLocalResult = m_${e}Inputs->setupIO();
    if (lLocalResult != VIP_Success)
    {
    lResult = lLocalResult;
    std::string lMessage;
    lMessage += "SimulationInputs::initialise m_${e}Inputs->setupIO() Failed: ";
    // lMessage += VIP_GetErrorMessage( lLocalResult );
    VIP_SendHealthMessage(m_ParticipantHandle, VIP_HealthLevel_Error,
   lMessage.c_str());
    }
    `:["Analog","Discrete","A664"].includes(e)?`
      lLocalResult = m_${e}Inputs->setupMessages();
      
      if (lLocalResult != VIP_Success)
      {
      lResult = lLocalResult;
      std::string lMessage;
      lMessage += "SimulationInputs::initialise m_${e}Inputs->setupMessages() Failed: ";
      // lMessage += VIP_GetErrorMessage( lLocalResult );
      VIP_SendHealthMessage(m_ParticipantHandle, VIP_HealthLevel_Error,
     lMessage.c_str());
      }
      `:"").join("")}
 return lResult;
}

void SimulationInputs::StopAllPeriodics()
{
${Le(r,e=>e==="A664"?`m_A664Inputs->startPeriodicMessages();
`:`m_${e}Inputs->stopAllPeriodics();
`)}
}

void SimulationInputs::StartAllPeriodics()
{
 ${Le(r,e=>e==="A429"?"":e==="A664"?`//m_A664Inputs->stopPeriodicMessages();
`:`//m_${e}Inputs->startAllPeriodics();
`)}
}

void SimulationInputs::ReceiveAndSetSimulinkInputs(SimulationParticipant_Inputs*
  aInputs)
  {
   ReceiveVIPControlInputs(aInputs);
  ${Le(r,e=>`
   ReceiveAndSetSimulink${e}Inputs(aInputs);
`)}
  }

void SimulationInputs::ReceiveVIPControlInputs(SimulationParticipant_Inputs* aInputs)
{
  VIP_State state;
  VIP_Float warp;
  
  if ( VIP_GetCurrentState( m_ParticipantHandle, &state, &warp) == VIP_Success)
  {
  aInputs->VIP_Control.Warp = (double)warp;
  aInputs->VIP_Control.Pause = (state == VIP_State_Paused) ? true : false;
  }
}
 `}function Ja(r=[],e=[]){return`
${r.length?'#include "SimulationInputs_CG.h"':""}
${e.length?'#include "SimulationOutputs_CG.h"':""}

extern "C" VIP_ParticipantHandle g_VIPParticipantHandle;
${r.length?"void VIP_InputBlockInitialise(); ":""}
${e.length?"void VIP_OutputBlockInitialise(); ":""}
${r.length?"void VIP_ReceiveInputs(SimulationParticipant_Inputs* aInputs); ":""}
${e.length?"void VIP_SendOutputs(SimulationParticipant_Outputs* aOutputs); ":""}
 `}function qa(r=[],e=[],t={}){return`
#include "stdio.h"
#include "SimulinkParticipantFunctions_CG.h"
#include "SimCoreShell.h"
#include <iostream>
#include "matrix.h"
#include "mex.h"
  
${r.length?"static SimulationInputs* Inputs; ":""}
${e.length?"static SimulationOutputs* Outputs; ":""}

${r.length?"static bool bInputsInitialiseSuccess = false; ":""}
${e.length?"static bool bOutputsInitialiseSuccess = false; ":""}

VIP_ParticipantHandle g_VIPParticipantHandle;

${r.length?`
void VIP_InputBlockInitialise()
{ 
 VIP_ParticipantInfo lParticipantInformation;
 VIP_Result lResult = VIP_InvalidOperation;
 std::string lSimulationName = "${t._SimulationName}";
 std::string lSimulationDescription = "${t._Description}";
 std::string lSimulationPartNumber = "${t._SWPartNumber}";
 std::string lSimulationVersionInfo = "${t._Version}";
 strncpy_s( lParticipantInformation.mName, lSimulationName.c_str(),
lSimulationName.length() );
 strncpy_s( lParticipantInformation.mDescription, lSimulationDescription.c_str(),
 lSimulationDescription.length() );
 strncpy_s( lParticipantInformation.mPartNumber, lSimulationPartNumber.c_str(),
 lSimulationPartNumber.length() );
 strncpy_s( lParticipantInformation.mVersionInformation,
lSimulationVersionInfo.c_str(),
 lSimulationVersionInfo.length() );
 g_VIPParticipantHandle = VIP_RegisterParticipant( &lParticipantInformation );
 if ( g_VIPParticipantHandle != VIP_InvalidHandle )
 {
  char error[1024] = { 0 };
  VIP_Result result = VIP_LoadConfig(error, 1024);
  if (result != VIP_Success)
  {
  std::cout << "Failed to load config file. " << result << " [" << error << "]"
 << std::endl;
  return ;
  }
  else
  {
  std::cout << "OK to load config file. " << std::endl;
  }
  lResult = VIP_Connect( g_VIPParticipantHandle );
 }
 if ( lResult == VIP_Success )
 {
  std::cout<<"VIP_Connect success"<<std::endl;
 bInputsInitialiseSuccess = true;
 #ifndef VIP_COMPILED
 int lNumColumns = 1; // The number of columns
 VIP_UInt32 lDataLength = 1;
 VIP_Result lResult;
 mxArray *lMexArray;
 UINT32_T *lMexData;
 lMexArray = mxCreateNumericMatrix( 0, 0, mxUINT32_CLASS, mxREAL );
 lMexData = static_cast<UINT32_T*> ( mxMalloc( ( lNumColumns*( lDataLength ) ) *
sizeof( UINT32_T ) ) );
 
 if ( lMexData != NULL )
 {
 for ( int i = 0; i < ( int )lDataLength; i++ )
 {
 lMexData[i] = g_VIPParticipantHandle;
 }
 
 mxSetData( lMexArray, lMexData );
 mxSetM( lMexArray, ( mwSize )lDataLength);
 mxSetN(lMexArray, ( mwSize )lNumColumns );
 mexPutVariable( "base", "ParticipantHandle", lMexArray );
 mxDestroyArray( lMexArray );
 }
 #endif
 // Create Simulation Input object
 Inputs = new SimulationInputs(g_VIPParticipantHandle);
 try
 {
 // Initialise simulation I/O objects
 lResult = Inputs->initialise();
 if ( lResult == VIP_Success )
 { 
 // Start all the periodics.
 // Inputs->StartAllPeriodics();
 VIP_SendHealthMessage(g_VIPParticipantHandle,
VIP_HealthLevel_Information,
 "Initialized Simulink Inputs");
 }
 }
 catch(std::runtime_error&)
 {
 //do nothing
 }
 }
 else
 {
 g_VIPParticipantHandle = VIP_InvalidHandle;
 bInputsInitialiseSuccess = false;
 }
}
void VIP_ReceiveInputs(SimulationParticipant_Inputs* aInputs)
{
 if (bInputsInitialiseSuccess)
 {
 // Receive and set the Simulink input structure
 Inputs->ReceiveAndSetSimulinkInputs(aInputs);
 }
}`:""}
${e.length?`
void VIP_OutputBlockInitialise()
{
 bOutputsInitialiseSuccess = true;
 #ifndef VIP_COMPILED
 // Get the participant handle from the workspace. 
 mxArray *lPLHS[1];
 lPLHS[0] = mexGetVariable("base", "ParticipantHandle");
 if ( lPLHS[0] )
 {
 size_t lBufferLength;
 UINT32_T *lParticipantHandleData;
 lBufferLength = mxGetN( lPLHS[0] )*sizeof( mxChar )+1;
 lParticipantHandleData = static_cast<UINT32_T*> ( mxMalloc( lBufferLength ) );
 /* Copy the string data into buf. */
 lParticipantHandleData = ( UINT32_T * ) mxGetData( lPLHS[0] );
 g_VIPParticipantHandle = static_cast<VIP_ParticipantHandle> (
lParticipantHandleData[0] );
 mxDestroyArray( lPLHS[0] );
 lPLHS[0] = NULL;
 }
 #endif
 
 // If the participant handle is valid set the initialisation flag to true
 if ( g_VIPParticipantHandle != VIP_InvalidHandle )
 {
 // Create Simulation Outputs object
 Outputs = new SimulationOutputs( g_VIPParticipantHandle );
 try
 {
 // Initialise simulation I/O objects
 VIP_Result lResult = Outputs->initialise();
 if ( lResult == VIP_Success )
 { 
 // Start all the periodics.
 // Outputs->StartAllPeriodics();
 VIP_SendHealthMessage( g_VIPParticipantHandle,
VIP_HealthLevel_Information,
 "Initialized Simulink Outputs");
 }
 }
 catch(std::runtime_error&)
 {
 //do nothing
 }
 }
 else
 {
 // Set Initialise flag to false
 bOutputsInitialiseSuccess = false;
 }
}
void VIP_SendOutputs(SimulationParticipant_Outputs* aOutputs)
{
 if (bOutputsInitialiseSuccess)
 {
 // Send the Simulink outputs out on the VIP
 Outputs->SendSimulinkOutputs(aOutputs);
 }
}
`:""}
 `}function Xa(r,e,t,i,u){return`
simulink;
% Check the version of Matlab is valid.
%try
% errorFlag = false;
% if ( ( verLessThan('matlab', '8.3') == 0 ) || ( verLessThan('matlab', '7.11') == 1) )
% errorFlag = true;
% end
%catch
% errorFlag = true;
%end
%if ( errorFlag )
% error( 'Simulation shells do not support versions of MATLAB earlier than 2010b(7.11) and later than 2013b (8.2).' )
%end


% Set 'debug_SFunction' to 'true' to debug SFunction legacy code using Microsoft VisualStudio.
% Attach the Visual Studio debugger to the running MATLAB process.
IncludePath = '';
LibPath = '';

debug_SFunction = false;
mexCompileOptions = '-R2018a';
if (debug_SFunction)
 mexCompileOptions = '-g';
end

% Generate the bus objects for the Simulation
SimulationParticipantIOSetup;
% Setup model name and input and output top level bus objects
modelname = '${t._SimulationName}';
currentDirectory = strcat(pwd, '\\');
%Create the functional (central) model reference
functional_modref_name = strcat(modelname, '_Functional_Mod_Ref');
new_system(functional_modref_name);
open_system(functional_modref_name);

${r.length?`
inputbus = SimulationParticipant_Inputs;
sizebus = size(inputbus.Elements, 1);
%First, add the main input port
add_block('simulink/Sources/In1', strcat(functional_modref_name,'/SimulationParticipant_Inputs'), 'Position', [10, (sizebus*35/2)+10, 60,(sizebus*35/2)+30] );
set_param(strcat(functional_modref_name, '/SimulationParticipant_Inputs'),'OutDataTypeStr', 'Bus: SimulationParticipant_Inputs');
%Add a Bus Selector to do first level breakdown
add_block('built-in/BusSelector', strcat(functional_modref_name, '/BS1'), 'Position',[200,10,225,(sizebus*35)+10]);
%Join the Bus Selector to the input port
add_line(functional_modref_name, 'SimulationParticipant_Inputs/1', 'BS1/1');
output_bus_string = '';
for i = 1:sizebus
 %Define the signals (present in the input bus) to be used in the outputs of
 %the block
 element_name = inputbus.Elements(i).Name;
 output_bus_string = strcat(output_bus_string, element_name);
 
 if (i < sizebus)
 output_bus_string = strcat(output_bus_string, ',');
 end 
end
set_param( strcat(functional_modref_name, '/BS1'), 'OutputSignals', output_bus_string);
%Add terminators and joining lines
for i = 1:sizebus
 add_block('simulink/Sinks/Terminator', strcat(functional_modref_name, '/Term',int2str(i)), 'Position', [300, (i*35)-10, 360, (i*35)-10+20] );
 add_line(functional_modref_name, strcat('BS1/', int2str(i)), strcat('Term',int2str(i), '/1'));
end
`:""}

${e.length?`
outputbus = SimulationParticipant_Outputs;
sizebus = size(outputbus.Elements, 1);
%Now add the output port
add_block('simulink/Sinks/Out1', strcat(functional_modref_name,'/SimulationParticipant_Outputs'), 'Position', [810,(sizebus*35/2)+10, 850,(sizebus*35/2)+30] );
%Set it's datatype (Bus)
set_param(strcat(functional_modref_name, '/SimulationParticipant_Outputs'),'OutDataTypeStr', strcat('Bus: SimulationParticipant_Outputs'));
%Add Bus Creator
add_block('built-in/BusCreator', strcat(functional_modref_name, '/BC1'), 'Position',[700,10,725,(sizebus*35)+10]);
%Set up outputs of Bus Creator
set_param(strcat(functional_modref_name, '/BC1'), 'OutDataTypeStr', 'Bus:SimulationParticipant_Outputs');
set_param(strcat(functional_modref_name, '/BC1'), 'Inputs', int2str(sizebus));
%Link Bus Creator to the Output Port
add_line(functional_modref_name, 'BC1/1', 'SimulationParticipant_Outputs/1');
%Add Constant Blocks and joining lines
for i = 1:sizebus
 port_name = outputbus.Elements(i).Name; 
 add_block('simulink/Sources/Constant', strcat(functional_modref_name, '/Const',int2str(i)), 'Position', [600, (i*35)-10, 650, (i*35)-10+20] ); 
 %and set its data type to the appropriate Bus type
 set_param(strcat(functional_modref_name, '/Const', int2str(i)), 'OutDataTypeStr',strcat('Bus: ', port_name));
 %Set the constant's value to zero:
 set_param(strcat(functional_modref_name, '/Const', int2str(i)), 'Value', '0');
 %Set the Constant Block's sample time
 set_param(strcat(functional_modref_name, '/Const', int2str(i)), 'SampleTime','0.05');
 %and link the constant block to the output port
 lineHandle = add_line(functional_modref_name, strcat('Const', int2str(i), '/1'),strcat('BC1/', int2str(i)));
 %and set the signal name for the connecting line
 set(lineHandle,'name', port_name);
 
end
`:""}

%Set the solver and other model config parameters
CustomInclude_model_ref = sprintf('SimulinkSimulationShell "%s" ',IncludePath);
CustomLibrary_model_ref = sprintf('"%s\\VIPBaseInterface.lib" ',LibPath);

set_param(functional_modref_name, 'Solver', 'FixedStepDiscrete'); %Fixed StepSolver
set_param(functional_modref_name,'GenCodeOnly','off'); % Do not Generate code only
set_param(functional_modref_name,'SystemTargetFile','vip.tlc'); % VIP ParticipantTarget
set_param(functional_modref_name,'TargetLang','C++'); % C++ Language
set_param(functional_modref_name,'RTWCompilerOptimization','off'); %No Optimization
set_param(functional_modref_name,'GenerateMakefile','on');
set_param(functional_modref_name,'TemplateMakefile','vip.tmf');

set_param(functional_modref_name,'CustomInclude',CustomInclude_model_ref);
set_param(functional_modref_name,'CustomLibrary',CustomLibrary_model_ref);

set_param(functional_modref_name,'InlineParams','on');
set_param(functional_modref_name, 'StopTime', 'inf'); %inf time
save_system(functional_modref_name, strcat(currentDirectory , functional_modref_name,'.mdl'))
close_system(functional_modref_name);
% ***************************
% EOF Functional Model Reference
% ***************************

%Now, create the top level model
CustomInclude_top = sprintf('"%s" "%s"',LibPath,IncludePath);
CustomLibrary_top = sprintf('"%s\\VIPBaseInterface.lib" ',LibPath);

new_system(modelname);
open_system(modelname);
%Add the Functional model reference in the middle
add_block('simulink/Ports & Subsystems/Model', strcat(modelname, '/FunctionalModRef'),'Position', [300 ,10, 700, 100]);
set_param(strcat(modelname, '/FunctionalModRef'), 'ModelName', functional_modref_name);
% Set block priority
set_param(strcat(modelname, '/FunctionalModRef'),'Priority','1');
%set its background to a nice light blue color
set_param(strcat(modelname, '/FunctionalModRef'), 'BackgroundColor', 'lightBlue');
% Set block SimulationMode
set_param(strcat(modelname, '/FunctionalModRef'), 'SimulationMode', 'normal');
%Set the solver and other model config parameters
set_param(modelname, 'Solver', 'FixedStepDiscrete'); %Fixed Step Solver
set_param(modelname, 'GenCodeOnly','off'); % Generate code only
set_param(modelname, 'SystemTargetFile','vip.tlc'); % Generic Real Time Target
set_param(modelname, 'TargetLang','C++'); % C++ Language
set_param(modelname,'RTWCompilerOptimization','off'); %No Optimization
set_param(modelname,'GenerateMakefile','on');
set_param(modelname,'TemplateMakefile','vip.tmf');
set_param(modelname,'CustomInclude',CustomInclude_top);
set_param(modelname,'CustomLibrary',CustomLibrary_top);
set_param(modelname, 'preloadfcn', 'SimulationParticipantIOSetup'); %Sets a M Script that will run each time the model is loaded
set_param(modelname, 'StopTime', 'inf'); %inf time
set_param(modelname, 'pausefcn', 'PauseSaveCheck'); %Continues the model if a pause is part of a save state process
set_param(modelname, 'stopfcn', 'StopRestoredCheck'); %Set 'SaveFinalState' to off if a restore has been made
set_param(modelname, 'InitialState','xFinal');
set_param(modelname, 'SaveFormat','Structure'); %Required for Save State Restore.
set_param(modelname, 'SaveFinalState','on'); %Required for Save State Restore.
set_param(modelname, 'SaveCompleteFinalSimState','on'); %Required for Save State Restore.
set_param(modelname, 'FinalStateName','xFinal');
if ( verLessThan('matlab', '8.0') ~= 1 )
set_param(modelname,'GRTInterface','on');
end
${r.length?`
%Now we need to compile required Legacy Code into S Functions and add to
%model. We have one for inputs and one for outputs
% The inputs block is always needed even if there are no inputs to the model
% as it intitalises the connection to the VIP.
def = legacy_code('initialize');
def.SFunctionName = 'VIPInputs';
def.StartFcnSpec = 'void VIP_InputBlockInitialise()';
def.OutputFcnSpec = 'void VIP_ReceiveInputs(SimulationParticipant_Inputs y1[1])';
def.HeaderFiles = {'SimulinkParticipantFunctions_CG.h'
 'SimulinkParticipantIO_CG.h'
 ${b(r,l=>`
    '${l}Inputs_CG.h'
 `)}
  ${r!=null&&r.length?"'SimulationInputs_CG.h'":""}
  ${b(e,l=>`
    '${l}Outputs_CG.h'
 `)}
  ${e!=null&&e.length?"'SimulationOutputs_CG.h'":""}
  ${u!=null&&u.length?"'A429WordData_CG.h'":""}
};
  def.SourceFiles = {'SimulinkParticipantFunctions_CG.cpp'
 ${b(r,l=>`
  '${l}Inputs_CG.cpp'
  'SimulationInputs_${l}ToSimulink_CG.cpp'
 `)}

 ${b(e,l=>`
  '${l}Outputs_CG.cpp'
  'SimulationOutputs_SimulinkTo${l}_CG.cpp'
 `)}
  ${u!=null&&u.length?"'A429WordData_CG.cpp'":""}
  ${r!=null&&r.length?"'SimulationInputs_CG.cpp'":""}
  ${e!=null&&e.length?"'SimulationOutputs_CG.cpp'":""}
  %SimInterface Files
  'A429Bus.cpp'
  'A429ArrayParameter.cpp'
  'A429IOManager.cpp'
  'A429LabeledWord.cpp'
  'A429Parameter.cpp'
  'A429ParameterBase.cpp'
  'A429RawWord.cpp'
  'A429WordBase.cpp'
  'AnalogAPeriodic.cpp'
  'AnalogIOManager.cpp'
  'AnalogMessage.cpp'
  'AnalogPeriodic.cpp'
  'APeriodic.cpp'
  'DiscreteAPeriodic.cpp'
  'DiscreteIOManager.cpp'
  'DiscreteMessage.cpp'
  'DiscretePeriodic.cpp'

  'NonProtocolAPeriodic.cpp'
  'NonProtocolArrayParameter.cpp'
 'NonProtocolIOManager.cpp'
 'NonProtocolMessage.cpp'
 'NonProtocolParameter.cpp'
 'NonProtocolParameterBase.cpp'
 'NonProtocolPeriodic.cpp'
 

  'ParameterEnum.cpp'
  'Periodic.cpp'
  
  'A664APeriodic.cpp'
'A664ArrayParameter.cpp'
'A664DataSet.cpp'
'A664IOManager.cpp'
'A664Message.cpp'
'A664Parameter.cpp'
'A664ParameterBase.cpp'
'A664Periodic.cpp'
'A664RawData.cpp'
'A429ParaWord.cpp'
'A429Block.cpp'
};
 
def.HostLibFiles =  {'VIPBaseInterface.lib'}; 
 
def.IncPaths = {IncludePath
 'SimulinkSimulationShell'
 'SimInterface'};
 
def.SrcPaths = {'SimulinkSimulationShell'
 'SimInterface'};
def.LibPaths = {LibPath}; 
 
def.Options.language = 'C++';
% Sample time in milliseconds
def.SampleTime = 0.05;
% Generate Source Code for SFunction.
legacy_code('sfcn_cmex_generate', def);
RemoveDataTypeCheck('VIPInputs.cpp');
legacy_code('compile', def, mexCompileOptions);
legacy_code('sfcn_tlc_generate', def)
legacy_code('rtwmakecfg_generate', def);
legacy_code('slblock_generate', def);
%S Function will now be in a project named 'untitled'
%Copy it to the main model...
add_block('untitled/VIPInputs', strcat(modelname, '/VIPInputs'), 'Position', [10, 35, 210, 85]);
% Set block priority
set_param(strcat(modelname, '/VIPInputs'),'Priority','0');
%Force close of untitled without saving
close_system('untitled',0);
%Link VIPInputs block
add_line(modelname, 'VIPInputs/1', 'FunctionalModRef/1');
`:""}

${e.length?`
clear def;
%Now the output one
def = legacy_code('initialize');
def.SFunctionName = 'VIPOutputs';
def.StartFcnSpec = 'void VIP_OutputBlockInitialise()';
def.OutputFcnSpec = 'void VIP_SendOutputs(SimulationParticipant_Outputs u1[1])';
def.HeaderFiles = {'SimulinkParticipantFunctions_CG.h' 
 'SimulinkParticipantIO_CG.h'
 ${b(r,l=>`
  '${l}Inputs_CG.h'
 `)}
  ${r!=null&&r.length?"'SimulationInputs_CG.h'":""}
 ${b(e,l=>`
  '${l}Outputs_CG.h'
`)}
  ${e!=null&&e.length?"'SimulationOutputs_CG.h'":""}
  ${u!=null&&u.length?"'A429WordData_CG.h'":""}
};
 
def.SourceFiles = {'SimulinkParticipantFunctions_CG.cpp'
 ${b(r,l=>`
  '${l}Inputs_CG.cpp'
  'SimulationInputs_${l}ToSimulink_CG.cpp'
`)}

 ${b(e,l=>`
  '${l}Outputs_CG.cpp'
  'SimulationOutputs_SimulinkTo${l}_CG.cpp'
 `)}
  ${u!=null&&u.length?"'A429WordData_CG.cpp'":""}
  ${r!=null&&r.length?"'SimulationInputs_CG.cpp'":""}
  ${e!=null&&e.length?"'SimulationOutputs_CG.cpp'":""}

 %SimInterface Files
 'A429Bus.cpp'
 'A429ArrayParameter.cpp'
 'A429IOManager.cpp'
 'A429LabeledWord.cpp'
 'A429Parameter.cpp'
 'A429ParameterBase.cpp'
 'A429RawWord.cpp'
 'A429WordBase.cpp'
 'AnalogAPeriodic.cpp'
 'AnalogIOManager.cpp'
 'AnalogMessage.cpp'
 'AnalogPeriodic.cpp'
 'APeriodic.cpp'
 'DiscreteAPeriodic.cpp'
 'DiscreteIOManager.cpp'
 'DiscreteMessage.cpp'
 'DiscretePeriodic.cpp'
 'NonProtocolAPeriodic.cpp'
 'NonProtocolArrayParameter.cpp'
 'NonProtocolIOManager.cpp'
 'NonProtocolMessage.cpp'
 'NonProtocolParameter.cpp'
 'NonProtocolParameterBase.cpp'
 'NonProtocolPeriodic.cpp'


 'ParameterEnum.cpp'
 'Periodic.cpp'

 'A664APeriodic.cpp'
 'A664ArrayParameter.cpp'
 'A664DataSet.cpp'
 'A664IOManager.cpp'
 'A664Message.cpp'
 'A664Parameter.cpp'
 'A664ParameterBase.cpp'
 'A664Periodic.cpp'
 'A664RawData.cpp'
 'A429ParaWord.cpp'
 'A429Block.cpp'
};
 
def.HostLibFiles = { 'VIPBaseInterface.lib'}; 
 
def.IncPaths = {IncludePath
 'SimulinkSimulationShell'
 'SimInterface'};
 
def.SrcPaths = {'SimulinkSimulationShell'
 'SimInterface'};
def.LibPaths = {LibPath}; 
 
def.Options.language = 'C++';
% Sample time in milliseconds
def.SampleTime = 0.05;
% Generate Source Code for SFunction.
legacy_code('sfcn_cmex_generate', def);
RemoveDataTypeCheck('VIPOutputs.cpp');
legacy_code('compile', def, mexCompileOptions);
legacy_code('sfcn_tlc_generate', def)
legacy_code('rtwmakecfg_generate', def);
legacy_code('slblock_generate', def);
%S Function will now be in a project named 'untitled'
%Copy it to the main model...
add_block('untitled/VIPOutputs', strcat(modelname, '/VIPOutputs'), 'Position', [800, 35, 1010, 85]);
% Set block priority
set_param(strcat(modelname, '/VIPOutputs'),'Priority','2');
%Force close of untitled without saving
close_system('untitled',0);
%Link VIPOutput block
add_line(modelname, 'FunctionalModRef/1', 'VIPOutputs/1');
`:""}


%-------------------------------------------------------------------
%Create TimeWait Mex File
%-------------------------------------------------------------------
iPath = ['-I' IncludePath];
lPath =['-L' LibPath];

if (debug_SFunction)
  mex('TimeWait.cpp', '-g', '-lwinmm', iPath, lPath, '-lVIPBaseInterface')
else
  mex('TimeWait.cpp', '-g', '-lwinmm', iPath, lPath, '-lVIPBaseInterface')
end
%-------------------------------------------------------------------
%Add SFunction TimeWait block to model
%-------------------------------------------------------------------
add_block('simulink/User-Defined Functions/S-Function', strcat(modelname, '/TimeWait'),'Position', [430, 150, 480, 200]);
% Set SFunction function name
set_param(strcat(modelname, '/TimeWait'),'FunctionName','TimeWait');
% Set block priority
set_param(strcat(modelname, '/TimeWait'),'Priority','3');
%Finally, save out the final model
save_system(modelname, strcat(currentDirectory , modelname, '.mdl'))

  `}function Za(r,e,t,i){return`
BASE_SAMPLE_TIME = 0.4;

% Create the <Protocol> Inputs
 ${b(r,u=>`
  ${u}InputBusObjects_CG
 `)}
% Create the VIP Controls.
VIPControlBusObjects_CG

clear elems;
%--------------------------------------------------------------------------
% 3.1 Add top level <Protocol> Inputs to elems to be assigned to top level inputs bus
%--------------------------------------------------------------------------
 ${b(r,(u,l)=>`
elems(${l+1}) = Simulink.BusElement;
elems(${l+1}).Name = '${u}_Inputs';
elems(${l+1}).Dimensions = 1;
elems(${l+1}).DimensionsMode = 'Fixed';
elems(${l+1}).DataType = 'Bus: ${u}_Inputs';
elems(${l+1}).SampleTime = -1;
elems(${l+1}).Complexity = 'real';
elems(${l+1}).SamplingMode = 'Sample based';
`)}
%---------------------------------------------------------------------------------
% 3.2 Add top level VIP Control Inputs to elems to be assigned to top level inputs bus
%---------------------------------------------------------------------------------

elems(${(r.length||0)+1}) = Simulink.BusElement;
elems(${(r.length||0)+1}).Name = 'VIP_Control';
elems(${(r.length||0)+1}).Dimensions = 1;
elems(${(r.length||0)+1}).DimensionsMode = 'Fixed';
elems(${(r.length||0)+1}).DataType = 'Bus: VIP_Control';
elems(${(r.length||0)+1}).SampleTime = -1;
elems(${(r.length||0)+1}).Complexity = 'real';
elems(${(r.length||0)+1}).SamplingMode = 'Sample based';


% 3.3 Assign bus elements to top level inputs
SimulationParticipant_Inputs = Simulink.Bus;
SimulationParticipant_Inputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
SimulationParticipant_Inputs.Description = sprintf('Top Level Simulation Participant Inputs');
if (exist('elems', 'var'))
 SimulationParticipant_Inputs.Elements = elems;
end
assignin('base', 'SimulationParticipant_Inputs', SimulationParticipant_Inputs)

% Create the <Protocol> Inputs
${b(e,u=>`
  ${u}OutputBusObjects_CG
  `)}

 %--------------------------------------------------------------------------
 % 4.1 Add top level <Protocol> Inputs to elems to be assigned to top level inputs bus
 %--------------------------------------------------------------------------
 clear elems;
  ${b(e,(u,l)=>`
  elems(${l+1}) = Simulink.BusElement;
  elems(${l+1}).Name = '${u}_Outputs';
  elems(${l+1}).Dimensions = 1;
  elems(${l+1}).DimensionsMode = 'Fixed';
  elems(${l+1}).DataType = 'Bus: ${u}_Outputs';
  elems(${l+1}).SampleTime = -1;
  elems(${l+1}).Complexity = 'real';
  elems(${l+1}).SamplingMode = 'Sample based';
`)}
 % 3.2Assign bus elements to top level Outputs
 SimulationParticipant_Outputs = Simulink.Bus;
 SimulationParticipant_Outputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
 SimulationParticipant_Outputs.Description = sprintf('Top Level Simulation Participant Outputs');
 if (exist('elems', 'var'))
  SimulationParticipant_Outputs.Elements = elems;
 end
 assignin('base', 'SimulationParticipant_Outputs', SimulationParticipant_Outputs)
 

`}function lt(r,e){return`
classdef e${r}_${a.nameFilter(e._ParamName)} < Simulink.IntEnumType
 enumeration
 Undefined(2147483647)
 ${b(e.children,t=>`${a.nameFilter(t._Value)}(${t._ID})
  `)}
 end
 methods (Static)
 function retVal = addClassNameToEnumNames() 
 currentstack = dbstack();
 stacksize = size(currentstack); 
 if ( strcmp(currentstack(stacksize(1)).name, 'MakeModelReference'))
 retVal = false;
 else
 retVal = true;
 end 
 end 
 function retVal = getHeaderFile()
 retVal = 'SimulinkParticipantIO_CG.h';
 end
 end
end

  `}const{eachData:Qa}=a;function Ya(r,e,t){return`
classdef e${r}${t===void 0?"":`W${t}`}_${a.nameFilter(e._ParamName)} < Simulink.IntEnumType
//////////////////////enumeration template////////////////////////////
  enumeration
  Undefined(2147483647)
  ///////////////////Iteration for value in enum//////
  ${Qa(e.children,i=>`${a.nameFilter(i._Value)}(${i._ID})
  `)}
  //////////////////end of Iteration ////////////////
  end
///////////////////////////////////////////////////////
  methods (Static)
  function retVal = addClassNameToEnumNames() 
  currentstack = dbstack();
  stacksize = size(currentstack); 
  if ( strcmp(currentstack(stacksize(1)).name, 'MakeModelReference'))
  retVal = false;
  else
  retVal = true;
  end 
  end 
  function retVal = getHeaderFile()
  retVal = 'SimulinkParticipantIO_CG.h';
  end
  end
end
  `}const{eachData:en,nameFilter:rt}=a;function st(r,e){return`
classdef e${r}_${rt(e._ParamName)} < Simulink.IntEnumType
//////////////////////enumeration template////////////////////////////
  enumeration
  Undefined(2147483647)
  ///////////////////Iteration for value in enum//////
  ${en(e.children,t=>`${rt(t._Value)}(${t._ID})
`)}
  
  //////////////////end of Iteration ////////////////
  end
///////////////////////////////////////////////////////
  methods (Static)
  function retVal = addClassNameToEnumNames() 
  currentstack = dbstack();
  stacksize = size(currentstack); 
  if ( strcmp(currentstack(stacksize(1)).name, 'MakeModelReference'))
  retVal = false;
  else
  retVal = true;
  end 
  end 
  function retVal = getHeaderFile()
  retVal = 'SimulinkParticipantIO_CG.h';
  end
  end
end
  `}const{eachData:ot}=a;function tn(r){return`
${ot(r,(e,t)=>`clear elems;
elems(1) = Simulink.BusElement;
elems(1).Name = '${a.nameFilter(e._PortName)}_Value';
elems(1).Dimensions = 1;
elems(1).DimensionsMode = 'Fixed';
elems(1).DataType = 'boolean';
elems(1).SampleTime = -1;
elems(1).Complexity = 'real';
elems(1).SamplingMode = 'Sample based';
${a.disPredix(e,t)}_${a.nameFilter(e._PortName)} = Simulink.Bus;
${a.disPredix(e,t)}_${a.nameFilter(e._PortName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${a.disPredix(e,t)}_${a.nameFilter(e._PortName)}.Description = sprintf('Discrete Message');
if (exist('elems', 'var'))
 ${a.disPredix(e,t)}_${a.nameFilter(e._PortName)}.Elements = elems;
end
assignin('base', '${a.disPredix(e,t)}_${a.nameFilter(e._PortName)}', ${a.disPredix(e,t)}_${a.nameFilter(e._PortName)})
`)}

clear elems;
${ot(r,(e,t)=>`elems(${t+1}) = Simulink.BusElement;
elems(${t+1}).Name = '${a.nameFilter(e._PortName)}';
elems(${t+1}).Dimensions = 1;
elems(${t+1}).DimensionsMode = 'Fixed';
elems(${t+1}).DataType = 'Bus: ${a.disPredix(e,t)}_${a.nameFilter(e._PortName)}';
elems(${t+1}).SampleTime = -1;
elems(${t+1}).Complexity = 'real';
elems(${t+1}).SamplingMode = 'Sample based';
`)}
Discrete_Outputs = Simulink.Bus;
Discrete_Outputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
Discrete_Outputs.Description = sprintf('Discrete Outputs');
if (exist('elems', 'var'))
 Discrete_Outputs.Elements = elems;
end
assignin('base', 'Discrete_Outputs', Discrete_Outputs)

`}const{eachData:ut}=a;function an(r){return`${ut(r,(e,t)=>`clear elems;
elems(1) = Simulink.BusElement;
elems(1).Name = '${a.nameFilter(e._PortName)}_Value';
elems(1).Dimensions = 1;
elems(1).DimensionsMode = 'Fixed';
elems(1).DataType = 'boolean';
elems(1).SampleTime = -1;
elems(1).Complexity = 'real';
elems(1).SamplingMode = 'Sample based';
elems(2) = Simulink.BusElement;
elems(2).Name = '${a.nameFilter(e._PortName)}_Freshness';
elems(2).Dimensions = 1;
elems(2).DimensionsMode = 'Fixed';
elems(2).DataType = 'boolean';
elems(2).SampleTime = -1;
elems(2).Complexity = 'real';
elems(2).SamplingMode = 'Sample based';
${a.disPredix(e,t)}_${a.nameFilter(e._PortName)} = Simulink.Bus;
${a.disPredix(e,t)}_${a.nameFilter(e._PortName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${a.disPredix(e,t)}_${a.nameFilter(e._PortName)}.Description = sprintf('Discrete Message');
if (exist('elems', 'var'))
 ${a.disPredix(e,t)}_${a.nameFilter(e._PortName)}.Elements = elems;
end
assignin('base', '${a.disPredix(e,t)}_${a.nameFilter(e._PortName)}', ${a.disPredix(e,t)}_${a.nameFilter(e._PortName)})
`)}
clear elems;
${ut(r,(e,t)=>`elems(${t+1}) = Simulink.BusElement;
elems(${t+1}).Name = '${a.nameFilter(e._PortName)}';
elems(${t+1}).Dimensions = 1;
elems(${t+1}).DimensionsMode = 'Fixed';
elems(${t+1}).DataType = 'Bus: ${a.disPredix(e,t)}_${a.nameFilter(e._PortName)}';
elems(${t+1}).SampleTime = -1;
elems(${t+1}).Complexity = 'real';
elems(${t+1}).SamplingMode = 'Sample based';
`)}
Discrete_Inputs = Simulink.Bus;
Discrete_Inputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
Discrete_Inputs.Description = sprintf('Discrete Inputs');
if (exist('elems', 'var'))
 Discrete_Inputs.Elements = elems;
end
assignin('base', 'Discrete_Inputs', Discrete_Inputs)
  `}const{eachData:mt}=a;function nn(r){return`${mt(r,(e,t)=>`clear elems;
elems(1) = Simulink.BusElement;
elems(1).Name = '${a.nameFilter(e._PortName)}_Value';
elems(1).Dimensions = 1;
elems(1).DimensionsMode = 'Fixed';
elems(1).DataType = 'single';
elems(1).SampleTime = -1;
elems(1).Complexity = 'real';
elems(1).SamplingMode = 'Sample based';
${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)} = Simulink.Bus;
${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)}.Description = sprintf('Analog Message');
if (exist('elems', 'var'))
  ${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)}.Elements = elems;
end
assignin('base', '${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)}', ${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)})
`)}

clear elems;
${mt(r,(e,t)=>`elems(${t+1}) = Simulink.BusElement;
elems(${t+1}).Name = '${a.nameFilter(e._PortName)}';
elems(${t+1}).Dimensions = 1;
elems(${t+1}).DimensionsMode = 'Fixed';
elems(${t+1}).DataType = 'Bus: ${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)}';
elems(${t+1}).SampleTime = -1;
elems(${t+1}).Complexity = 'real';
elems(${t+1}).SamplingMode = 'Sample based';
`)}
Analog_Outputs = Simulink.Bus;
Analog_Outputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
Analog_Outputs.Description = sprintf('Analog Outputs');
if (exist('elems', 'var'))
 Analog_Outputs.Elements = elems;
end
assignin('base', 'Analog_Outputs', Analog_Outputs)
`}const{eachData:ct}=a;function ln(r){return`
${ct(r,(e,t)=>`
clear elems;
elems(1) = Simulink.BusElement;
elems(1).Name = '${a.nameFilter(e._PortName)}_Value';
elems(1).Dimensions = 1;
elems(1).DimensionsMode = 'Fixed';
elems(1).DataType = 'single';
elems(1).SampleTime = -1;
elems(1).Complexity = 'real';
elems(1).SamplingMode = 'Sample based';
elems(2) = Simulink.BusElement;
elems(2).Name = '${a.nameFilter(e._PortName)}_Freshness';
elems(2).Dimensions = 1;
elems(2).DimensionsMode = 'Fixed';
elems(2).DataType = 'boolean';
elems(2).SampleTime = -1;
elems(2).Complexity = 'real';
elems(2).SamplingMode = 'Sample based';
${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)} = Simulink.Bus;
${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)}.Description = sprintf('Analog Message');
if (exist('elems', 'var'))
 ${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)}.Elements = elems;
end
assignin('base', '${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)}', ${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)})
`)}

clear elems;
${ct(r,(e,t)=>`
elems(${t+1}) = Simulink.BusElement;
elems(${t+1}).Name = '${a.nameFilter(e._PortName)}';
elems(${t+1}).Dimensions = 1;
elems(${t+1}).DimensionsMode = 'Fixed';
elems(${t+1}).DataType = 'Bus: ${a.anaPredix(e,t)}_${a.nameFilter(e._PortName)}';
elems(${t+1}).SampleTime = -1;
elems(${t+1}).Complexity = 'real';
elems(${t+1}).SamplingMode = 'Sample based';
`)}
Analog_Inputs = Simulink.Bus;
Analog_Inputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
Analog_Inputs.Description = sprintf('Analog Inputs');
if (exist('elems', 'var'))
 Analog_Inputs.Elements = elems;
end
assignin('base', 'Analog_Inputs', Analog_Inputs)

`}const{eachData:Ee,dftMapOfM:rn}=a;function sn(r){return`
function A429BusObjects()
% A429BUSOBJECTS initializes a set of bus objects in the MATLAB base workspace

${Ee(r,(e,t)=>`
  ${Ee(e.children,(i,u)=>{var c,_,d,N,F,g,n,o;const l=i._SDI?2:1;return`
clear elems
${i._SDI?`
elems(1) = Simulink.BusElement;
elems(1).Name = 'SDI';
elems(1).Dimensions = 1;
elems(1).DimensionsMode = 'Fixed';
elems(1).DataType = 'int8';
elems(1).SampleTime = -1;
elems(1).Complexity = 'real';
elems(1).SamplingMode = 'Sample based';
`:""}
${Ee(i.children,(s,m)=>`
elems(${m+l}) = Simulink.BusElement;
elems(${m+l}).Name = '${a.nameFilter(s._ParamName)}';
elems(${m+l}).Dimensions = 1;
elems(${m+l}).DimensionsMode = 'Fixed';
elems(${m+l}).DataType = '${rn(e,s,u,"A429",t)}';
elems(${m+l}).SampleTime = -1;
elems(${m+l}).Complexity = 'real';
elems(${m+l}).SamplingMode = 'Sample based';
`)}
${i._DefaultSSM?`
elems(${((c=i.children)==null?void 0:c.length)+l||0}) = Simulink.BusElement;
elems(${((_=i.children)==null?void 0:_.length)+l||0}).Name = 'SSM';
elems(${((d=i.children)==null?void 0:d.length)+l||0}).Dimensions = 1;
elems(${((N=i.children)==null?void 0:N.length)+l||0}).DimensionsMode = 'Fixed';
elems(${((F=i.children)==null?void 0:F.length)+l||0}).DataType = 'int8';
elems(${((g=i.children)==null?void 0:g.length)+l||0}).SampleTime = -1;
elems(${((n=i.children)==null?void 0:n.length)+l||0}).Complexity = 'real';
elems(${((o=i.children)==null?void 0:o.length)+l||0}).SamplingMode = 'Sample based';
  `:""}
${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)} = Simulink.Bus;
${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)}.Description = sprintf('A429 Word');
if (exist('elems', 'var'))
 ${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)}.Elements = elems;
end
assignin('base', '${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)}', ${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)})
`})}
`)}
${Ee(r,(e,t)=>`
clear elems
${Ee(e.children,(i,u)=>`
elems(${u+1}) = Simulink.BusElement;
elems(${u+1}).Name = '${a.nameFilter(i._WordName)}';
elems(${u+1}).Dimensions = 1;
elems(${u+1}).DimensionsMode = 'Fixed';
elems(${u+1}).DataType = 'Bus: ${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)}';
elems(${u+1}).SampleTime = -1;
elems(${u+1}).Complexity = 'real';
elems(${u+1}).SamplingMode = 'Sample based';
`)}
    
${a.busPredix(e,t)}_${a.nameFilter(e._PortName)} = Simulink.Bus; 
${a.busPredix(e,t)}_${a.nameFilter(e._PortName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${a.busPredix(e,t)}_${a.nameFilter(e._PortName)}.Description = sprintf('A429 Port');
if (exist('elems', 'var'))
${a.busPredix(e,t)}_${a.nameFilter(e._PortName)}.Elements = elems;
end
assignin('base', '${a.busPredix(e,t)}_${a.nameFilter(e._PortName)}', ${a.busPredix(e,t)}_${a.nameFilter(e._PortName)})
`)}

clear elems
${Ee(r,(e,t)=>`
elems(${t+1}) = Simulink.BusElement;
elems(${t+1}).Name = '${a.nameFilter(e._PortName)}';
elems(${t+1}).Dimensions = 1;
elems(${t+1}).DimensionsMode = 'Fixed';
elems(${t+1}).DataType = 'Bus: ${a.busPredix(e,t)}_${a.nameFilter(e._PortName)}';
elems(${t+1}).SampleTime = -1;
elems(${t+1}).Complexity = 'real';
elems(${t+1}).SamplingMode = 'Sample based';
`)}
A429_Outputs = Simulink.Bus;
A429_Outputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
A429_Outputs.Description = sprintf('A429 Outputs');
if (exist('elems', 'var'))
 A429_Outputs.Elements = elems;
end
assignin('base', 'A429_Outputs', A429_Outputs)
`}function on(r){return`
#pragma once
#include "SimulinkParticipantIO_CG.h"
${b(r,e=>`#include "${e}Outputs_CG.h"
    `)}
class SimulationOutputs
{
private:
 VIP_ParticipantHandle m_ParticipantHandle;
${b(r,e=>`${e}Outputs* m_${e}Outputs; 
    `)}
public:
 SimulationOutputs(VIP_ParticipantHandle aParticipantHandle);
 ~SimulationOutputs();
 VIP_Result initialise();
 void StartAllPeriodics();
 void StopAllPeriodics();
 void SendSimulinkOutputs(SimulationParticipant_Outputs* aOutputs);
 ${b(r,e=>`void Send${e}OutputsFromSimulink(SimulationParticipant_Outputs* aOutputs);`)}
};

`}function un(r){return`#include "SimulationOutputs_CG.h"
SimulationOutputs::SimulationOutputs(VIP_ParticipantHandle aParticipantHandle)
{
 m_ParticipantHandle = aParticipantHandle;
${b(r,e=>`m_${e}Outputs = new ${e}Outputs(m_ParticipantHandle);
`)}
}

SimulationOutputs::~SimulationOutputs()
{
${b(r,e=>`if (m_${e}Outputs != NULL)
  {
  delete m_${e}Outputs;
  }    
`)}
}


VIP_Result SimulationOutputs::initialise()
{
 VIP_Result lResult = VIP_Success;
 VIP_Result lLocalResult = VIP_Success;
${b(r,e=>{let t="";return["A429","NPD"].includes(e)?t=`lLocalResult = m_${e}Outputs->setupIO();
  if (lLocalResult != VIP_Success)
  {
  lResult = lLocalResult;
  std::string lMessage;
  lMessage += "SimulationInputs::initialise m_${e}Outputs->setupIO() Failed:";
  lMessage += VIP_GetErrorMessage( lLocalResult );
  VIP_SendHealthMessage(m_ParticipantHandle, VIP_HealthLevel_Error,
  lMessage.c_str());
  } 
    `:["Discrete","Analog","A664"].includes(e)&&(t=`lLocalResult = m_${e}Outputs->setupMessages();
  if (lLocalResult != VIP_Success)
  {
  lResult = lLocalResult;
  std::string lMessage;
  lMessage += "SimulationInputs::initialise m_${e}Outputs->setupMessages() Failed: ";
  lMessage += VIP_GetErrorMessage( lLocalResult );
  VIP_SendHealthMessage(m_ParticipantHandle, VIP_HealthLevel_Error,
  lMessage.c_str());
  }
`),t})}
 return lResult;
}

void SimulationOutputs::StopAllPeriodics()
{
${b(r,e=>e==="A664"?`m_${e}Outputs->startPeriodicMessages();
`:`m_${e}Outputs->stopAllPeriodics();
`)}
}
void SimulationOutputs::StartAllPeriodics()
{
${b(r,e=>e==="A664"?`//m_${e}Outputs->stopPeriodicMessages();
`:`//m_${e}Outputs->startAllPeriodics();
`)}
}

void SimulationOutputs::SendSimulinkOutputs(SimulationParticipant_Outputs* aOutputs)
{
${b(r,e=>`Send${e}OutputsFromSimulink(aOutputs);
`)}
}
`}const{eachData:Be,dftMapOfM:mn}=a;function cn(r){return`function A429BusObjects()
% A429BUSOBJECTS initializes a set of bus objects in the MATLAB base workspace

${Be(r,(e,t)=>`
 ${Be(e.children,(i,u)=>{var c,_,d,N,F,g,n;const l=i._SDI?2:1;return`clear elems
${i._SDI?`
elems(1) = Simulink.BusElement;
elems(1).Name = 'SDI';
elems(1).Dimensions = 1;
elems(1).DimensionsMode = 'Fixed';
elems(1).DataType = 'int8';
elems(1).SampleTime = -1;
elems(1).Complexity = 'real';
elems(1).SamplingMode = 'Sample based';
`:""}
${Be(i.children,(o,s)=>`elems(${s+l}) = Simulink.BusElement;
elems(${s+l}).Name = '${a.nameFilter(o._ParamName)}';
elems(${s+l}).Dimensions = 1;
elems(${s+l}).DimensionsMode = 'Fixed';
elems(${s+l}).DataType = '${mn(e,o,u,"A429",t)}';
elems(${s+l}).SampleTime = -1;
elems(${s+l}).Complexity = 'real';
elems(${s+l}).SamplingMode = 'Sample based';
`)}
${i._DefaultSSM?`
elems(${((c=i.children)==null?void 0:c.length)+l||0}).Name = 'SSM';
elems(${((_=i.children)==null?void 0:_.length)+l||0}).Dimensions = 1;
elems(${((d=i.children)==null?void 0:d.length)+l||0}).DimensionsMode = 'Fixed';
elems(${((N=i.children)==null?void 0:N.length)+l||0}).DataType = 'int8';
elems(${((F=i.children)==null?void 0:F.length)+l||0}).SampleTime = -1;
elems(${((g=i.children)==null?void 0:g.length)+l||0}).Complexity = 'real';
elems(${((n=i.children)==null?void 0:n.length)+l||0}).SamplingMode = 'Sample based';
`:""}
${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)} = Simulink.Bus;
${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)}.Description = sprintf('A429 Word');
if (exist('elems', 'var'))
 ${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)}.Elements = elems;
end
assignin('base', '${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)}', ${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)})
`})}
`)}
${Be(r,(e,t)=>`clear elems
 ${Be(e.children,(i,u)=>`elems(${u*2+1}) = Simulink.BusElement;
elems(${u*2+1}).Name = '${a.nameFilter(i._WordName)}';
elems(${u*2+1}).Dimensions = 1;
elems(${u*2+1}).DimensionsMode = 'Fixed';
elems(${u*2+1}).DataType = 'Bus: ${a.wordPredix(e,t,u)}_${a.nameFilter(i._WordName)}';
elems(${u*2+1}).SampleTime = -1;
elems(${u*2+1}).Complexity = 'real';
elems(${u*2+1}).SamplingMode = 'Sample based';

elems(${u*2+2}) = Simulink.BusElement;
elems(${u*2+2}).Name = '${a.nameFilter(i._WordName)}_Freshness';
elems(${u*2+2}).Dimensions = 1;
elems(${u*2+2}).DimensionsMode = 'Fixed';
elems(${u*2+2}).DataType = 'boolean';
elems(${u*2+2}).SampleTime = -1;
elems(${u*2+2}).Complexity = 'real';
elems(${u*2+2}).SamplingMode = 'Sample based';
`)}
${a.busPredix(e,t)}_${a.nameFilter(e._PortName)} = Simulink.Bus; 
${a.busPredix(e,t)}_${a.nameFilter(e._PortName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${a.busPredix(e,t)}_${a.nameFilter(e._PortName)}.Description = sprintf('A429 Port');
if (exist('elems', 'var'))
  ${a.busPredix(e,t)}_${a.nameFilter(e._PortName)}.Elements = elems;
end
assignin('base', '${a.busPredix(e,t)}_${a.nameFilter(e._PortName)}', ${a.busPredix(e,t)}_${a.nameFilter(e._PortName)})
 `)}

clear elems
${Be(r,(e,t)=>`elems(${t+1}) = Simulink.BusElement;
elems(${t+1}).Name = '${a.nameFilter(e._PortName)}';
elems(${t+1}).Dimensions = 1;
elems(${t+1}).DimensionsMode = 'Fixed';
elems(${t+1}).DataType = 'Bus: ${a.busPredix(e,t)}_${a.nameFilter(e._PortName)}';
elems(${t+1}).SampleTime = -1;
elems(${t+1}).Complexity = 'real';
elems(${t+1}).SamplingMode = 'Sample based';
`)}
A429_Inputs = Simulink.Bus;
A429_Inputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
A429_Inputs.Description = sprintf('A429 Inputs');
if (exist('elems', 'var'))
 A429_Inputs.Elements = elems;
end
assignin('base', 'A429_Inputs', A429_Inputs)

`}const{eachData:He,nameFilter:M}=a;function pn(r){return`
#include "SimulationInputs_CG.h"

void SimulationInputs::ReceiveAndSetSimulinkA664Inputs(SimulationParticipant_Inputs*
aInputs)
{
  VIP_UInt64 lUInt64Value = 0;
  VIP_UInt32 lReturnedArrayLength = 0;
  
  ////////////////////////Iteration for each A664SubscribePort////////////////////////////////// 
  ${He(r,(e,t)=>`
  // 对该A429Word定义 freshness代码块
  aInputs->A664_Inputs.${M(e._PortName)}.${M(e._PortName)}_Freshness = false;
  if (m_A664Inputs->${M(e._PortName)}->receive() == VIP_Success)
  {
  aInputs->A664_Inputs.${M(e._PortName)}.${M(e._PortName)}_Freshness = true;

  ${He(e.children,(i,u)=>`
////////////////////////Iteration for each 664param/A429Word//////////////////////////////////
${He(i.children,(l,c)=>l._WordName?`
//case1 对于429word 
// 若该A429Word包含"SDI"属性,则添加getSDI部分代码.
${l._SDI?`
aInputs->A664_Inputs.${M(e._PortName)}.${M(i._DataSetName)}.${M(l._WordName)}.SDI =
m_A664Inputs->${M(e._PortName)}->${M(i._DataSetName)}->${M(l._WordName)}->getSDI();
`:""}
${l._SSM?`
//若该A429Word包含"DefaultSSM"属性,则添加getSSM部分代码
aInputs->A664_Inputs.${M(e._PortName)}.${M(i._DataSetName)}.${M(l._WordName)}.SSM =
m_A664Inputs->${M(e._PortName)}->${M(i._DataSetName)}->${M(l._WordName)}->getSSM();
`:""}

${He(l.children,_=>_._DataFormatType==="Enumeration"?`
//对DataFormatType==Enumeration使用如下代码块取值
aInputs->A664_Inputs.${M(e._PortName)}.${M(i._DataSetName)}.${M(l._WordName)}.${M(_._ParamName)} =
static_cast<e${a664Predix(e,t,u)}W${c}_${M(_._ParamName)}>(m_A664Inputs->${M(e._PortName)}->${M(i._DataSetName)}-
>${M(_._WordName)}->${M(_._ParamName)}->getValueID());
`:`
//对普通DataFormatType 使用如下代码块取值
aInputs->A664_Inputs.${M(e._PortName)}.${M(i._DataSetName)}.${M(l._WordName)}.${M(_._ParamName)} =
m_A664Inputs->${M(e._PortName)}->${M(i._DataSetName)}->${M(l._WordName)}->${M(_._ParamName)}->getValue();
`)}
`:l._DataFormatType==="Enumeration"?`
//对DataFormatType==Enumeration使用如下代码块取值
aInputs->A664_Inputs.${M(e._PortName)}.${M(i._DataSetName)}.${M(l._ParamName)} =
static_cast<e${a664Predix(e,t,u)}_${M(l._ParamName)}>(m_A664Inputs->${M(e._PortName)}->${M(i._DataSetName)}->${M(l._ParamName)}->getValueID());
`:`
//对普通DataFormatType 使用如下代码块取值
aInputs->A664_Inputs.${M(e._PortName)}.${M(i._DataSetName)}.${M(l._ParamName)} =
m_A664Inputs->${M(e._PortName)}->${M(i._DataSetName)}->${M(l._ParamName)}->getValue();
`)}
/////////////////////////end of Iteration 664param/A429Word////////////////////////////
aInputs->A664_Inputs.${M(e._PortName)}.${M(i._DataSetName)}.FSF = (VIP_UInt32) m_A664Inputs->
${M(e._PortName)}->${M(i._DataSetName)}->getFS();
`)}
  }
  ////////////////////////Iteration for dataset //////////////////////////////////
  /////////////////////////end of Iteration dataset////////////////////////////
`)}
/////////////////////////end of Iteration A664SubscribePort/////////////////////////////////////
}
`}const{eachData:je,nameFilter:G}=a;function _n(r){return`
#include "SimulationOutputs_CG.h"

void SimulationOutputs::SendA664OutputsFromSimulink(SimulationParticipant_Outputs*
  aOutputs)
  {
   VIP_UInt64 lUInt64Value = 0;
  ////////////////////////Iteration for each publishPort//////////////////////////////////
  ${je(r,(e,t)=>`
  ////////////////////////Iteration for each dataset //////////////////////////////////
  ${je(e.children,(i,u)=>`
  ////////////////////////Iteration for each 664param/word //////////////////////////////////
  ${je(i.children,l=>l._WordName?`
${l._SDI?`
m_A664Outputs-> ${G(e._PortName)}->${G(i._DataSetName)}->${G(l._WordName)}->setSDI((VIP_UInt32)aOutputs->A664_Outputs.${G(e._PortName)}.${G(i._DataSetName)}.${G(l._WordName)}.SDI);
`:""}
${l._SSM?`s
m_A664Outputs->${G(e._PortName)}->${G(l._WordName)}->setSSM((VIP_UInt32)aOutputs->A664_Outputs.${G(e._PortName)}.${G(i._DataSetName)}.${G(l._WordName)}.SSM);
`:""}
////////////////////////Iteration for each param//////////////////////////////////
${je(l.children,c=>c._DataFormatType==="Enumeration"?`m_A664Outputs->${G(e._PortName)}->${G(i._DataSetName)}->${G(l._WordName)}->${G(c._ParamName)}->setValueID((VIP_Int32)aOutputs->A664_Outputs.${G(e._PortName)}.${G(i._DataSetName)}.${G(l._WordName)}.${G(c._ParamName)});
`:`m_A664Outputs->${G(e._PortName)}->${G(i._DataSetName)}->${G(l._WordName)}->${G(c._ParamName)}->setValue(aOutputs->A664_Outputs.${G(e._PortName)}.${G(i._DataSetName)}.${G(l._WordName)}.${G(c._ParamName)});
`)}
/////////////////////////end of Iteration param/////////////////////////////////////////
`:l._DataFormatType==="Enumeration"?`
m_A664Outputs->${G(e._PortName)}->${G(i._DataSetName)}->${G(l._ParamName)}->setValueID((VIP_Int32)aOutputs->A664_Outputs.${G(e._PortName)}.${G(i._DataSetName)}.${G(l._ParamName)});
`:`
m_A664Outputs->${G(e._PortName)}->${G(i._DataSetName)}->${G(l._ParamName)}->setValue(aOutputs->A664_Outputs.${G(e._PortName)}.${G(i._DataSetName)}.${G(l._ParamName)});
`)}
  m_A664Outputs->${G(e._PortName)}->${G(i._DataSetName)}->setFS((VIP_UInt32)aOutputs->A664_Outputs.${G(e._PortName)}.${G(i._DataSetName)}.FSF);
`)}
`)}
   m_A664Outputs->send();
  }
`}const{eachData:pe,nameFilter:w,dftMapOfM:pt,a664Predix:q}=a;function dn(r){return`
///////////////////Iteration for each A664SubscribePort///////////////////////////////////////////
${pe(r,(e,t)=>`
  ///////////////////Iteration for each dataset///////////////////////////////////
  ${pe(e.children,(i,u)=>`
  //////////////////Iteration for each A429word///////////////////////////////////
  ${pe(i.children,(l,c)=>{if(!l._WordName)return;const _=l._SDI?2:1;return`clear elems
////////////////////4.1 SDI template/////////////////////////
${l._SDI?`elems(1) = Simulink.BusElement;
elems(1).Name = 'SDI';
elems(1).Dimensions = 1;
elems(1).DimensionsMode = 'Fixed';
elems(1).DataType = 'int8';
elems(1).SampleTime = -1;
elems(1).Complexity = 'real';
elems(1).SamplingMode = 'Sample based';
`:""}
//////////////////para template////////////////////////
///////////////////Iteration for each para in word////////////////
${pe(l.children,(d,N)=>`
elems(${N+_}) = Simulink.BusElement;
elems(${N+_}).Name = '${w(d._ParamName)}';
elems(${N+_}).Dimensions = ${d._DataFormatType==="Opaque"?d._SizeInBits:1};
elems(${N+_}).DimensionsMode = 'Fixed';
elems(${N+_}).DataType = '${pt({},d,c)}';
elems(${N+_}).SampleTime = -1;
elems(${N+_}).Complexity = 'real';
elems(${N+_}).SamplingMode = 'Sample based';
`)}
///////////////////End of Iteration///////////////////////////
////////////////////////////4.3 SSM template ////////////////////////////////////////////
elems(${(l.children||[]).length+_}).Name = 'SSM';
elems(${(l.children||[]).length+_}).Dimensions = 1;
elems(${(l.children||[]).length+_}).DimensionsMode = 'Fixed';
elems(${(l.children||[]).length+_}).DataType = 'int8';
elems(${(l.children||[]).length+_}).SampleTime = -1;
elems(${(l.children||[]).length+_}).Complexity = 'real';
elems(${(l.children||[]).length+_}).SamplingMode = 'Sample based';
//////////////////////////////////////////////////////////////////////
${q(e,t,u)}W${c}_${w(l._WordName)} = Simulink.Bus;
${q(e,t,u)}W${c}_${w(l._WordName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${q(e,t,u)}W${c}_${w(l._WordName)}.Description = sprintf('A429 Word');
if (exist('elems', 'var'))
  ${q(e,t,u)}W${c}_${w(l._WordName)}.Elements = elems;
end
assignin('base', '${q(e,t,u)}W${c}_${w(l._WordName)}', ${q(e,t,u)}W${c}_${w(l._WordName)})
`})}
  ///////////////////End of Iteration（word）//////////////////////////////////////////////////////////////
`)}
  ///////////////////End of Iteration（dataset）//////////////////////////////////////////////////////////////
`)}
///////////////////End of Iteration(port)/////////////////////////////////////////////////////////////



///////////////////Iteration for each A664SubscribePort///////////////////////////////////////////
${pe(r,(e,t)=>`
 ///////////////////Iteration for each dataset///////////////////////////////////
 ${pe(e.children,(i,u)=>`
clear elems
///////////////////Iteration for each 664param or 429word (index++)///////////////////////////////////
${pe(i.children,(l,c)=>l._ParamName?`
//case1 : 664param
elems(${c+1}) = Simulink.BusElement;
elems(${c+1}).Name = '${w(l._ParamName)}';
elems(${c+1}).Dimensions = ${l._DataFormatType==="Opaque"?l._SizeInBits:1};
elems(${c+1}).DimensionsMode = 'Fixed';
elems(${c+1}).DataType = '${l._DataFormatType==="Enumeration"?`Enum:e${q(e,t,u)}_${w(l._ParamName)} `:`${pt({},l,c)}`}';
elems(${c+1}).SampleTime = -1;
elems(${c+1}).Complexity = 'real';
elems(${c+1}).SamplingMode = 'Sample based';  
`:l._WordName?`
///////////////////////////Word bus element template/////////////////////////////////////
//case2 429word
elems(${c+1}) = Simulink.BusElement;
elems(${c+1}).Name = '${w(l._WordName)}';
elems(${c+1}).Dimensions = 1;
elems(${c+1}).DimensionsMode = 'Fixed';
elems(${c+1}).DataType = 'Bus: ${q(e,t,u)}W${c}_${w(l._WordName)}';
elems(${c+1}).SampleTime = -1;
elems(${c+1}).Complexity = 'real';
elems(${c+1}).SamplingMode = 'Sample based';
`:"")}
///////////////////End of Iteration（word）//////////////////////////////////////////////////////////////
elems(${(i.children||[]).length+1}) = Simulink.BusElement;
elems(${(i.children||[]).length+1}).Name = 'FSF';
elems(${(i.children||[]).length+1}).Dimensions = 1;
elems(${(i.children||[]).length+1}).DimensionsMode = 'Fixed';
elems(${(i.children||[]).length+1}).DataType = 'uint32';
elems(${(i.children||[]).length+1}).SampleTime = -1;
elems(${(i.children||[]).length+1}).Complexity = 'real';
elems(${(i.children||[]).length+1}).SamplingMode = 'Sample based';
${q(e,t,u)}_${w(i._DataSetName)} = Simulink.Bus; 
${q(e,t,u)}_${w(i._DataSetName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${q(e,t,u)}_${w(i._DataSetName)}.Description = sprintf('A664 Data Set');
if (exist('elems', 'var'))
 ${q(e,t,u)}_${w(i._DataSetName)}.Elements = elems;
end
assignin('base', '${q(e,t,u)}_${w(i._DataSetName)}',${q(e,t,u)}_${w(i._DataSetName)})
`)}
 ///////////////////end of Iteration dataset///////////////////////////////////
`)}
///////////////////End of Iteration(port)///////////////////////////////////////////////////

///////////////// Create A664 Message and add DataSets/A429 Blocks as elements
///////////////////Iteration for each A664SubscribePort///////////////////////////////////////////
${pe(r,(e,t)=>`
clear elems
 ///////////////////Iteration for each dataset///////////////////////////////////////////
 ${pe(e.children,(i,u)=>`
elems(${u+1}) = Simulink.BusElement;
elems(${u+1}).Name = '${w(i._DataSetName)}';
elems(${u+1}).Dimensions = 1;
elems(${u+1}).DimensionsMode = 'Fixed';
elems(${u+1}).DataType = 'Bus: ${q(e,t,u)}_${w(i._DataSetName)}';
elems(${u+1}).SampleTime = -1;
elems(${u+1}).Complexity = 'real';
elems(${u+1}).SamplingMode = 'Sample based';
`)}
///////////////////End of Iteration（dataset）//////////////////////////////////////////////////////////////
elems(${(e.children||[]).length+1}) = Simulink.BusElement;
elems(${(e.children||[]).length+1}).Name = '${w(e._PortName)}_Freshness';
elems(${(e.children||[]).length+1}).Dimensions = 1;
elems(${(e.children||[]).length+1}).DimensionsMode = 'Fixed';
elems(${(e.children||[]).length+1}).DataType = 'boolean';
elems(${(e.children||[]).length+1}).SampleTime = -1;
elems(${(e.children||[]).length+1}).Complexity = 'real';
elems(${(e.children||[]).length+1}).SamplingMode = 'Sample based';
${q(e,t)}_${w(e._PortName)} = Simulink.Bus; //PortNamer如过长，可统一按固定长度截断
${q(e,t)}_${w(e._PortName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${q(e,t)}_${w(e._PortName)}.Description = sprintf('A664 Port');
if (exist('elems', 'var'))
 ${q(e,t)}_${w(e._PortName)}.Elements = elems;
end
assignin('base', '${q(e,t)}_${w(e._PortName)}', ${q(e,t)}_${w(e._PortName)})
`)}
///////////////////End of Iteration(port)/////////////////////////////////////////////////////////////

clear elems
///////////////////////port element template/////////////////////////////////
//////////////////Iteration for each A429SubscribePort//////////////////////////////////////////////////////////////
${pe(r,(e,t)=>`
elems(${t+1}) = Simulink.BusElement;
elems(${t+1}).Name = '${w(e._PortName)}';
elems(${t+1}).Dimensions = 1;
elems(${t+1}).DimensionsMode = 'Fixed';
elems(${t+1}).DataType = 'Bus: ${q(e,t)}_${w(e._PortName)}';
elems(${t+1}).SampleTime = -1;
elems(${t+1}).Complexity = 'real';
elems(${t+1}).SamplingMode = 'Sample based';
`)}
///////////////////End of Iteration//////////////////////////////////////////////////////////////
A664_Inputs = Simulink.Bus;
A664_Inputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
A664_Inputs.Description = sprintf('A664 Inputs');
if (exist('elems', 'var'))
 A664_Inputs.Elements = elems;
end
assignin('base', 'A664_Inputs', A664_Inputs)
`}const{eachData:_e,nameFilter:K,dftMapOfM:_t,a664Predix:X}=a;function $n(r){return`
///////////////////Iteration for each A664PublishPort///////////////////////////////////////////
${_e(r,(e,t)=>`
  ///////////////////Iteration for each dataset///////////////////////////////////
  ${_e(e.children,(i,u)=>`
  //////////////////Iteration for each A429word///////////////////////////////////
  ${_e(i.children,(l,c)=>{if(!l._WordName)return;const _=l._SDI?2:1;return`clear elems
////////////////////4.1 SDI template/////////////////////////
${l._SDI?`elems(1) = Simulink.BusElement;
elems(1).Name = 'SDI';
elems(1).Dimensions = 1;
elems(1).DimensionsMode = 'Fixed';
elems(1).DataType = 'int8';
elems(1).SampleTime = -1;
elems(1).Complexity = 'real';
elems(1).SamplingMode = 'Sample based';
`:""}
//////////////////para template////////////////////////
///////////////////Iteration for each para in word////////////////
${_e(l.children,(d,N)=>`
elems(${N+_}) = Simulink.BusElement;
elems(${N+_}).Name = '${K(d._ParamName)}';
elems(${N+_}).Dimensions = ${d._DataFormatType==="Opaque"?d._SizeInBits:1};
elems(${N+_}).DimensionsMode = 'Fixed';
elems(${N+_}).DataType = '${_t({},d,c)}';
elems(${N+_}).SampleTime = -1;
elems(${N+_}).Complexity = 'real';
elems(${N+_}).SamplingMode = 'Sample based';
`)}
///////////////////End of Iteration///////////////////////////
////////////////////////////4.3 SSM template ////////////////////////////////////////////
elems(${(l.children||[]).length+_}).Name = 'SSM';
elems(${(l.children||[]).length+_}).Dimensions = 1;
elems(${(l.children||[]).length+_}).DimensionsMode = 'Fixed';
elems(${(l.children||[]).length+_}).DataType = 'int8';
elems(${(l.children||[]).length+_}).SampleTime = -1;
elems(${(l.children||[]).length+_}).Complexity = 'real';
elems(${(l.children||[]).length+_}).SamplingMode = 'Sample based';
//////////////////////////////////////////////////////////////////////
${X(e,t,u)}W${c}_${K(l._WordName)} = Simulink.Bus;
${X(e,t,u)}W${c}_${K(l._WordName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${X(e,t,u)}W${c}_${K(l._WordName)}.Description = sprintf('A429 Word');
if (exist('elems', 'var'))
  ${X(e,t,u)}W${c}_${K(l._WordName)}.Elements = elems;
end
assignin('base', '${X(e,t,u)}W${c}_${K(l._WordName)}', ${X(e,t,u)}W${c}_${K(l._WordName)})
`})}
  ///////////////////End of Iteration（word）//////////////////////////////////////////////////////////////
`)}
  ///////////////////End of Iteration（dataset）//////////////////////////////////////////////////////////////
`)}
///////////////////End of Iteration(port)////////////////////////////////////////////////////////////

///////////////////Iteration for each A664PublishPort///////////////////////////////////////////
${_e(r,(e,t)=>`
 ///////////////////Iteration for each dataset///////////////////////////////////
 ${_e(e.children,(i,u)=>`
clear elems
///////////////////Iteration for each 664param or 429word (index++)///////////////////////////////////
${_e(i.children,(l,c)=>l._ParamName?`
//case1 : 664param
elems(${c+1}) = Simulink.BusElement;
elems(${c+1}).Name = '${K(l._ParamName)}';
elems(${c+1}).Dimensions = ${l._DataFormatType==="Opaque"?l._SizeInBits:1};
elems(${c+1}).DimensionsMode = 'Fixed';
elems(${c+1}).DataType = '${l._DataFormatType==="Enumeration"?`Enum:e${X(e,t,u)}_${K(l._ParamName)} `:`${_t({},l,c)}`}';
elems(${c+1}).SampleTime = -1;
elems(${c+1}).Complexity = 'real';
elems(${c+1}).SamplingMode = 'Sample based';  
`:l._WordName?`
///////////////////////////Word bus element template/////////////////////////////////////
//case2 429word
elems(${c+1}) = Simulink.BusElement;
elems(${c+1}).Name = '${K(l._WordName)}';
elems(${c+1}).Dimensions = 1;
elems(${c+1}).DimensionsMode = 'Fixed';
elems(${c+1}).DataType = 'Bus: ${X(e,t,u)}W${c}_${K(l._WordName)}';
elems(${c+1}).SampleTime = -1;
elems(${c+1}).Complexity = 'real';
elems(${c+1}).SamplingMode = 'Sample based';
`:"")}
///////////////////End of Iteration（word）//////////////////////////////////////////////////////////////
elems(${(i.children||[]).length+1}) = Simulink.BusElement;
elems(${(i.children||[]).length+1}).Name = 'FSF';
elems(${(i.children||[]).length+1}).Dimensions = 1;
elems(${(i.children||[]).length+1}).DimensionsMode = 'Fixed';
elems(${(i.children||[]).length+1}).DataType = 'uint32';
elems(${(i.children||[]).length+1}).SampleTime = -1;
elems(${(i.children||[]).length+1}).Complexity = 'real';
elems(${(i.children||[]).length+1}).SamplingMode = 'Sample based';
${X(e,t,u)}_${K(i._DataSetName)} = Simulink.Bus; 
${X(e,t,u)}_${K(i._DataSetName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${X(e,t,u)}_${K(i._DataSetName)}.Description = sprintf('A664 Data Set');
if (exist('elems', 'var'))
 ${X(e,t,u)}_${K(i._DataSetName)}.Elements = elems;
end
assignin('base', '${X(e,t,u)}_${K(i._DataSetName)}',${X(e,t,u)}_${K(i._DataSetName)})
`)}
 ///////////////////end of Iteration dataset///////////////////////////////////
`)}
///////////////////End of Iteration(port)/////////////////////////////////////////////////////////////

///////////////// Create A664 Message and add DataSets/A429 Blocks as elements
///////////////////Iteration for each A664PublishPort///////////////////////////////////////////
${_e(r,(e,t)=>`
clear elems
///////////////////Iteration for each dataset///////////////////////////////////////////
${_e(e.children,(i,u)=>`
elems(${u+1}) = Simulink.BusElement;
elems(${u+1}).Name = '${K(i._DataSetName)}';
elems(${u+1}).Dimensions = 1;
elems(${u+1}).DimensionsMode = 'Fixed';
elems(${u+1}).DataType = 'Bus: ${X(e,t,u)}_${K(i._DataSetName)}';
elems(${u+1}).SampleTime = -1;
elems(${u+1}).Complexity = 'real';
elems(${u+1}).SamplingMode = 'Sample based';
`)}
///////////////////End of Iteration（dataset）//////////////////////////////////////////////////////////////
${X(e,t)}_${K(e._PortName)} = Simulink.Bus; //PortNamer如过长，可统一按固定长度截断
${X(e,t)}_${K(e._PortName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${X(e,t)}_${K(e._PortName)}.Description = sprintf('A664 Port');
if (exist('elems', 'var'))
${X(e,t)}_${K(e._PortName)}.Elements = elems;
end
assignin('base', '${X(e,t)}_${K(e._PortName)}', ${X(e,t)}_${K(e._PortName)})
`)}
///////////////////End ofIteration(port)/////////////////////////////////////////////////////////

clear elems
///////////////////////port element template/////////////////////////////////
//////////////////Iteration for each A429SubscribePort//////////////////////////////////////////////////////////////
${_e(r,(e,t)=>`
elems(${t+1}) = Simulink.BusElement;
elems(${t+1}).Name = '${K(e._PortName)}';
elems(${t+1}).Dimensions = 1;
elems(${t+1}).DimensionsMode = 'Fixed';
elems(${t+1}).DataType = 'Bus: ${X(e,t)}_${K(e._PortName)}';
elems(${t+1}).SampleTime = -1;
elems(${t+1}).Complexity = 'real';
elems(${t+1}).SamplingMode = 'Sample based';
`)}
///////////////////End of Iteration//////////////////////////////////////////////////////////////
A664_Outputs = Simulink.Bus;
A664_Outputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
A664_Outputs.Description = sprintf('A664 Outputs');
if (exist('elems', 'var'))
 A664_Outputs.Elements = elems;
end
assignin('base', 'A664_Outputs', A664_Outputs)
`}const{eachData:dt,nameFilter:se}=a;function fn(r){return`#include "SimulationInputs_CG.h"
  void SimulationInputs::ReceiveAndSetSimulinkNPDInputs(SimulationParticipant_Inputs*
    aInputs)
    {
     VIP_UInt32 lReturnedArrayLength = 0;
     VIP_UInt64 lUInt64Value = 0;
     VIP_Result lResult = VIP_Success;
     unsigned int lLength = 65535;
    ${dt(r,e=>`
    aInputs->NPD_Inputs.${se(e._PortName)}.${se(e._PortName)}_Freshness = false;
     if (m_NPDInputs->${se(e._PortName)}->receive() == VIP_Success)
     {
     // Set Simulink Freshness Flag to true
     aInputs->NPD_Inputs.${se(e._PortName)}.${se(e._PortName)}_Freshness = true;
    ${dt(e.children,t=>{const i=t._DataFormatType||"";return i.includes("Array")||i==="String"?`m_NPDInputs->${se(e._PortName)}->${se(t._ParamName)}->getArray( ${t._ArrayLength},
          aInputs->NPD_Inputs.${se(e._PortName)}.${se(t._ParamName)},
         &lReturnedArrayLength);
`:`aInputs->NPD_Inputs.${se(e._PortName)}.${se(t._ParamName)} = m_NPDInputs->${se(e._PortName)}->${se(t._ParamName)}->getValue();
`})}
}

`)}
    }
`}const{eachData:$t,nameFilter:ue}=a;function hn(r){return`#include "SimulationOutputs_CG.h"
void SimulationOutputs::SendNPDOutputsFromSimulink(SimulationParticipant_Outputs* aOutputs)
{
  VIP_UInt64 lUInt64Value = 0;
  VIP_UInt64 lUInt64ArrayValue = 0;
${$t(r,e=>`
    ${$t(e.children,t=>{const i=t._DataFormatType||"";return i==="Enumeration"?`
        m_NPDOutputs->${ue(e._PortName)}->${ue(t._ParamName)}->setValueID((VIP_Int32)aOutputs->NPD_Outputs.${ue(e._PortName)}.${ue(t._ParamName)});`:i.includes("Array")||i==="String"?`
        m_NPDOutputs->${ue(e._PortName)}->${ue(t._ParamName)}->setArray(aOutputs->NPD_Outputs.${ue(e._PortName)}.${ue(t._ParamName)},${t._ArrayLength});
`:`
m_NPDOutputs->${ue(e._PortName)}->${ue(t._ParamName)}->setValue(aOutputs->NPD_Outputs.${ue(e._PortName)}.${ue(t._ParamName)});`})}
`)}
  // Send the Outputs
  m_NPDOutputs->send();
}
`}const{eachData:qe,nameFilter:fe,dftMapOfM:Pn,npdPredix:ye}=a;function Sn(r){return`
///////////////////Iteration for UserProtocol PubishPort////////////////
${qe(r,(e,t)=>`
clear elems;
  ///////////////////Iteration for param Index++ ////////////////注: Index从1开始 依次递增
  ${qe(e.children,(i,u)=>{const l=i._DataFormatType||"",c=`
  elems(${u+1}) = Simulink.BusElement;
  elems(${u+1}).Name = '${fe(i._ParamName)}';
  `;let _="";return l==="UInt64Array"||l==="Int64Array"?_=`${c}elems(${u+1}).Dimensions =[${i._ArrayLength||512} 2];//若无arrayLength 默认为512
`:l.includes("Array")||l==="String"?_=`${c}elems(${u+1}).Dimensions =${i._ArrayLength||512};
`:_=`${c}elems(${u+1}).Dimensions = 1;
 `,`
    ${_}
elems(${u+1}).DimensionsMode = 'Fixed';
elems(${u+1}).DataType = '${Pn(e,i,t,"NPD")}';
elems(${u+1}).SampleTime = -1;
elems(${u+1}).Complexity = 'real';
elems(${u+1}).SamplingMode = 'Sample based';
`})}
///////////////////End Iteration for param////////////////
${ye(e,t)}_${fe(e._PortName)} = Simulink.Bus;
${ye(e,t)}_${fe(e._PortName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${ye(e,t)}_${fe(e._PortName)}.Description = sprintf('NPD Message');
if (exist('elems', 'var'))
  ${ye(e,t)}_${fe(e._PortName)}.Elements = elems;
end
assignin('base', '${ye(e,t)}_${fe(e._PortName)}', ${ye(e,t)}_${fe(e._PortName)})
`)}
///////////////////End of Iteration UserProtocolpublishPort///////////////


clear elems;
///////////////////Iteration foruserprotocolPublishPort////////////////
${qe(r,(e,t)=>`
elems(${t+1}) = Simulink.BusElement;
elems(${t+1}).Name = '${fe(e._PortName)}';
elems(${t+1}).Dimensions = 1;
elems(${t+1}).DimensionsMode = 'Fixed';
elems(${t+1}).DataType = 'Bus: ${ye(e,t)}_${fe(e._PortName)}';
elems(${t+1}).SampleTime = -1;
elems(${t+1}).Complexity = 'real';
elems(${t+1}).SamplingMode = 'Sample based';
`)}
//////////////////End of Iteration ///////////////
NPD_Outputs = Simulink.Bus;
NPD_Outputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
NPD_Outputs.Description = sprintf('NPD Outputs');
if (exist('elems', 'var'))
 NPD_Outputs.Elements = elems;
end
assignin('base', 'NPD_Outputs',NPD_Outputs)

  `}const{eachData:Xe,nameFilter:de,dftMapOfM:In,npdPredix:Ae}=a;function Nn(r){return`
//////////////////Iteration for UserProtocolSubscribePort////////////////
${Xe(r,(e,t)=>`
clear elems;
  ///////////////////Iteration for param Index++ ////////////////注: Index从1开始 依次递增
  ${Xe(e.children,(i,u)=>{const l=i._DataFormatType||"",c=`
    elems(${u+1}) = Simulink.BusElement;
    elems(${u+1}).Name = '${de(i._ParamName)}';
    `;let _="";return l==="UInt64Array"||l==="Int64Array"?_=`${c}elems(${u+1}).Dimensions =[${i._ArrayLength||512} 2];//若无arrayLength 默认为512
`:l.includes("Array")||l==="String"?_=`${c}elems(${u+1}).Dimensions =${i._ArrayLength||512};
`:_=`${c}elems(${u+1}).Dimensions = 1;
 `,`
      ${_}
elems(${u+1}).DimensionsMode = 'Fixed';
elems(${u+1}).DataType = '${In(e,i,t,"NPD")}';
elems(${u+1}).SampleTime = -1;
elems(${u+1}).Complexity = 'real';
elems(${u+1}).SamplingMode = 'Sample based';
`})}
///////////////////End Iteration for param////////////////
elems(${(e.children||[]).length+1}) = Simulink.BusElement;
elems(${(e.children||[]).length+1}).Name = '${de(e._PortName)}_Freshness';
elems(${(e.children||[]).length+1}).Dimensions = 1;
elems(${(e.children||[]).length+1}).DimensionsMode = 'Fixed';
elems(${(e.children||[]).length+1}).DataType = 'boolean';
elems(${(e.children||[]).length+1}).SampleTime = -1;
elems(${(e.children||[]).length+1}).Complexity = 'real';
elems(${(e.children||[]).length+1}).SamplingMode = 'Sample based';
${Ae(e,t)}_${de(e._PortName)} = Simulink.Bus;
${Ae(e,t)}_${de(e._PortName)}.HeaderFile = 'SimulinkParticipantIO_CG.h';
${Ae(e,t)}_${de(e._PortName)}.Description = sprintf('NPD Message');
if (exist('elems', 'var'))
  ${Ae(e,t)}_${de(e._PortName)}.Elements = elems;
end
assignin('base', '${Ae(e,t)}_${de(e._PortName)}', ${Ae(e,t)}_${de(e._PortName)})
`)}
///////////////////End of Iteration UserProtocolSubscribePort//////////////



clear elems;
///////////////////Iteration for UserProtocolSubscribePort////////////////
${Xe(r,(e,t)=>`
elems(${t+1}) = Simulink.BusElement;
elems(${t+1}).Name = '${de(e._PortName)}';
elems(${t+1}).Dimensions = 1;
elems(${t+1}).DimensionsMode = 'Fixed';
elems(${t+1}).DataType = 'Bus: ${Ae(e,t)}_${de(e._PortName)}';
elems(${t+1}).SampleTime = -1;
elems(${t+1}).Complexity = 'real';
elems(${t+1}).SamplingMode = 'Sample based';
`)}
///////////////////End of Iteration ////////////////
NPD_Inputs= Simulink.Bus;
NPD_Inputs.HeaderFile = 'SimulinkParticipantIO_CG.h';
NPD_Inputs.Description = sprintf('NPD Inputs');
if (exist('elems', 'var'))
 NPD_Inputs.Elements = elems;
end
assignin('base', 'NPD_Inputs',NPD_Inputs)

  `}function At(r){let e="",t=!1;for(let i=0;i<r.length;i++)r.slice(i,i+2)==="/*"&&!t?(t=!0,i++):r.slice(i,i+2)==="*/"&&t?(t=!1,i++):r.slice(i,i+2)==="//"?i=r.indexOf(`
`,i)-1:t||(e+=r[i]);return e}function gn(r){const e=At(r);let t=0,i="";const u=["if","else","for","while","do","switch","case"],l=e.split(`
`);for(let c=0;c<l.length;c++){const _=l[c].trim();_!==""&&(_.slice(0,2)==="}"&&t>0&&t--,u.includes(_.split(" ")[0])?(i+="  ".repeat(t)+_+`
`,t++):i+="  ".repeat(t)+_+`
`)}return i}function Dn(r){let t=At(r).split(/\r?\n/),i="";for(let u=0;u<t.length;u++){let l=t[u].trim();l.length>0&&(l.startsWith("%")?i+=l+`
`:l.startsWith("function")||l.startsWith("if")||l.startsWith("while")||l.startsWith("for")?i+=`
`+l+`
`:i+=l+`
`)}return i}async function Fn(r,e){const t=await r.createWritable();await t.write(e),await t.close()}function Cn(r,e,t){if(r.key==="-1")return;const i=new Ye,u=i.file;i.__proto__.file=function(l,c,_){if(typeof c=="string"){const d=l.includes(".cpp")||l.includes(".h"),N=l.includes(".m");return u.call(this,l,d?gn(c):N?Dn(c):c,_)}return u.call(this,...arguments)},i.loadAsync(t).then(()=>{const{files:l}=i;Object.keys(l).forEach(c=>{c.includes("simlinkFixFiles")&&(l[c.replace("simlinkFixFiles/","")]=l[c],Reflect.deleteProperty(l,c))}),i.loadAsync(e).then(()=>{const{AnalogPublishPort:c,AnalogSubscribePort:_,DiscretePublishPort:d,A429PublishPort:N,A429SubscribePort:F,DiscreteSubscribePort:g,NonProtocolPublishPort:n,NonProtocolSubscribePort:o,sub_Protocals:s,pub_Protocals:m,totalPubAndSub:p,A664SubscribePort:$,A664PublishPort:f}=Xt(r);console.log(s,m);const I=i.folder("SimulinkSimulationShell");if(p.includes("A429")){const P=Zt([...F,...N]),A=Qt([...F,...N]);if(I.file("A429WordData_CG.h",P),I.file("A429WordData_CG.cpp",A),F.length){const h=Ga(F);I.file("SimulationInputs_A429ToSimulink_CG.cpp",h);const D=Yt(F),O=ea(F);I.file("A429Inputs_CG.h",D),I.file("A429Inputs_CG.cpp",O);const y=cn(F);i.file("A429InputBusObjects_CG.m",y)}if(N.length){const h=wa(N);I.file("SimulationOutputs_SimulinkToA429_CG.cpp",h);const D=ta(N),O=aa(N);I.file("A429Outputs_CG.h",D),I.file("A429Outputs_CG.cpp",O);const y=sn(N);i.file("A429OutputBusObjects_CG.m",y)}}if(p.includes("Discrete")){if(g.length>0){const P=Wa(g);I.file("SimulationInputs_DiscreteToSimulink_CG.cpp",P);const A=an(g);i.file("DiscreteInputBusObjects_CG.m",A);const h=na(g),D=ia(g);I.file("DiscreteInputs_CG.h",h),I.file("DiscreteInputs_CG.cpp",D)}if(d.length){const P=ja(d);I.file("SimulationOutputs_SimulinkToDiscrete_CG.cpp",P);const A=tn(d);i.file("DiscreteOutputBusObjects_CG.m",A);const h=la(d),D=ra(d);I.file("DiscreteOutputs_CG.h",h),I.file("DiscreteOutputs_CG.cpp",D)}}if(p.includes("Analog")){if(_.length>0){const P=Ra(_);I.file("SimulationInputs_AnalogToSimulink_CG.cpp",P);const A=ln(_);i.file("AnalogInputBusObjects_CG.m",A);const h=sa(_),D=oa(_);I.file("AnalogInputs_CG.h",h),I.file("AnalogInputs_CG.cpp",D)}if(c.length){const P=za(c);I.file("SimulationOutputs_SimulinkToAnalog_CG.cpp",P);const A=nn(c);i.file("AnalogOutputBusObjects_CG.m",A);const h=ua(c),D=ma(c);I.file("AnalogOutputs_CG.h",h),I.file("AnalogOutputs_CG.cpp",D)}}if(p.includes("A664")){if($.length>0){const P=pn($);I.file("SimulationInputs_A664ToSimulink_CG.cpp",P);const A=dn($);i.file("A664InputBusObjects_CG.m",A);const h=ca($),D=pa($);I.file("A664Inputs_CG.h",h),I.file("A664Inputs_CG.cpp",D)}if(f.length){const P=_n(f);I.file("SimulationOutputs_SimulinkToA664_CG.cpp",P);const A=$n(f);i.file("A664OutputBusObjects_CG.m",A);const h=_a(f),D=da(f);I.file("A664Outputs_CG.h",h),I.file("A664Outputs_CG.cpp",D)}}if(p.includes("NPD")){if(console.log(n,o),n.length){const P=hn(n);I.file("SimulationOutputs_SimulinkToNPD_CG.cpp",P);const A=Sn(n);i.file("NPDOutputBusObjects_CG.m",A);const h=$a(n),D=fa(n);I.file("NPDOutputs_CG.h",h),I.file("NPDOutputs_CG.cpp",D)}if(o.length){const P=fn(o);I.file("SimulationInputs_NPDToSimulink_CG.cpp",P);const A=Nn(o);i.file("NPDInputBusObjects_CG.m",A);const h=ha(o),D=Pa(o);I.file("NPDInputs_CG.h",h),I.file("NPDInputs_CG.cpp",D)}}const E=Ka(s);I.file("SimulationInputs_CG.h",E);const V=xa(s);I.file("SimulationInputs_CG.cpp",V);const z=un(m);I.file("SimulationOutputs_CG.cpp",z);const R=on(m);I.file("SimulationOutputs_CG.h",R);const B=Ba(N,F,g,d,c,_,f,$,n,o,s,m);I.file("SimulinkParticipantIO_CG.h",B);const $e=Ja(s,m);I.file("SimulinkParticipantFunctions_CG.h",$e);const oe=qa(s,m,r);I.file("SimulinkParticipantFunctions_CG.cpp",oe);const ke=Xa(s,m,r,p,[...N,...F]);i.file("MakeModelReference.m",ke);const be=Za(s,m);i.file("SimulationParticipantIOSetup.m",be),b(N,(P,A)=>{b(P.children,(h,D)=>{b(h.children,O=>{if(O._DataFormatType==="Enumeration"){const y=a.wordPredix(P,A,D);i.file(`e${y}_${a.nameFilter(O._ParamName)}.m`,lt(y,O))}})})}),b(F,(P,A)=>{b(P.children,(h,D)=>{b(h.children,O=>{if(O._DataFormatType==="Enumeration"){const y=a.wordPredix(P,A,D);i.file(`e${y}_${a.nameFilter(O._ParamName)}.m`,lt(y,O))}})})});function k(P,A,h,D,O){if(D._DataFormatType==="Enumeration"){const y=a.a664Predix(P,A,h),T=Ya(y,D,O);i.file(`e${y}${O===void 0?"":`W${O}`}_${a.nameFilter(D._ParamName)}.m`,T)}}b($,(P,A)=>{b(P.children,(h,D)=>{b(h.children,(O,y)=>{O._ParamName?k(P,A,D,O):O._WordName&&b(O.children,T=>k(P,A,D,T,y))})})}),b(f,(P,A)=>{b(P.children,(h,D)=>{b(h.children,O=>{O._ParamName?k(P,A,D,O):O._WordName&&b(O.children,y=>k(P,A,D,y))})})}),b(n,(P,A)=>{b(P.children,h=>{if(h._DataFormatType==="Enumeration"){const D=a.npdPredix(P,A);i.file(`e${D}_${a.nameFilter(h._ParamName)}.m`,st(D,h))}})}),b(o,(P,A)=>{b(P.children,h=>{if(h._DataFormatType==="Enumeration"){const D=a.npdPredix(P,A);i.file(`e${D}_${a.nameFilter(h._ParamName)}.m`,st(D,h))}})}),i.generateAsync({type:"blob"}).then(P=>{const A=window.showSaveFilePicker,h=`Simulink_${r._SimulationName}_Simshell.zip`;A?A({suggestedName:h,types:[{accept:{"application/zip":[".zip"]}}]}).then(D=>{Fn(D,P)}):Ft.saveAs(P,h)})})})}const yn=[{key:"-1",_SimulationName:"模型"}],An={type:{required:!0,message:"请填写导出接口类型"},rate:{required:!0,message:"请填写模型运行周期"}},On=[{label:"C++ 接口",value:1},{label:"SimuLink 接口",value:2}];function ft(r){return Na.get(a.getAssetsFile(r))}function kn(){const{appContext:r}=he(),{$modal:e}=r.config.globalProperties,t=j({type:1,rate:"50"}),i=j(yn),u=j(null);let l=[];const c=()=>{var F;(F=u.value)==null||F.validate(g=>{g||ft("common/SimInterface.zip").then(n=>{t.value.type===1?l.forEach(o=>Sa(o,n,t.value)):ft("common/simlinkFixFiles.zip").then(o=>{l.forEach(s=>Cn(s,n,o))})})})},_=(F,{checkedNodes:g})=>{l=g};function d(F){const g=[];return F==null||F.forEach(n=>{if(n.level===3){const o=d(n.children).map(s=>Object.assign({},s,n.data,{tagName:n.tagName}));g.push(...o)}else g.push(Object.assign({children:d(n.children),key:a.randomString(),tagName:n.tagName},n.data))}),g}return{open:()=>{var n;const F=le.value.find(o=>o.key===2),g=[];(n=F.children)==null||n.forEach(o=>{var s;(s=o.children)==null||s.forEach(m=>{Array.prototype.push.call(g,Object.assign({isLeaf:!0,key:a.randomString(),children:d(m.children)},m.data))})}),i.value[0].c=g,e.open({title:"导出模型接口",width:600,okText:"确认",cancelText:"取消",titleAlign:"start",draggable:!0,content:()=>{const o={suffix:()=>S("span",null,[ae("毫秒")])};return S(ge,null,[S(v("a-form"),{ref:u,"auto-label-width":!0,rules:An,model:t.value},{default:()=>[S(v("a-form-item"),{label:"导出接口类型",field:"type"},{default:()=>[S(v("a-select"),{modelValue:t.value.type,"onUpdate:modelValue":s=>t.value.type=s,options:On,placeholder:"导出接口类型"},null)]}),S(v("a-form-item"),{label:"模型运行周期",field:"rate"},{default:()=>[S(v("a-input"),{modelValue:t.value.rate,"onUpdate:modelValue":s=>t.value.rate=s,placeholder:"模型运行周期"},o)]})]}),S(v("a-tree"),{"block-line":!0,data:i.value,"default-expanded-keys":["-1"],checkable:!0,fieldNames:{title:"_SimulationName",children:"c"},virtualListProps:{height:"50vh"},onCheck:_},null)])},onBeforeOk(){return c(),!1},onClose:()=>{l=[],t.value={type:1,rate:"50"}}})}}}const vn=["_成员名称ParticipantName","_信号名Message","_收发Direction","_系统System","_协议Protocol","_设备Device","_CardNo","_ChannelNo"],Tn=(r,e=[],t)=>{const i=[],u=[],l=[];return e==null||e.forEach(c=>{var g,n,o,s,m,p,$;const _=t("A825",c._信号名Message);if(!_)return console.error("未找到该消息: ",c._信号名Message);let d="";(g=Object.keys(c))==null||g.forEach(f=>{vn.includes(f)||(d+=`${f.slice(1)}=${c[f]};`)});const N={MessageName:c._信号名Message,TransceiverID:`CardNo=${c._CardNo||""};ChannelNo=${c._ChannelNo||""};IdentifierHEX=${((n=_.data)==null?void 0:n._IdentifierHEX)||""};IdentifierSize=${((o=_.data)==null?void 0:o._IdentifierSize)||""};${d}`};((s=c._收发Direction)==null?void 0:s.toLocaleUpperCase())==="PUBLISH"?i.push(N):u.push(N);let F=l.find(f=>f.CardNo===c._CardNo);F||(F={CardNo:c._CardNo||"",Channels:[]},l.push(F)),F.Channels.push({ChannelNo:c._ChannelNo||"",BitRate:((m=_.data)==null?void 0:m._BitRate)||"",IdentifierSize:(p=_.data)==null?void 0:p._IdentifierSize,IdentifierFilter:(($=_.data)==null?void 0:$._IdentifierHEX)||"",AccMask:0,AccCode:0})}),JSON.stringify({Name:r._DeviceName||"",Description:r._Description||"",PartNumber:r._Partnumber||"",Version:r._Version||"",Type:"A825",ApplicationPlugin:"",ApplicationMessage:{TxMessage:i,RxMessage:u},MessageParser:"",MessageParserMappingConfig:{},Transceiver:r._Transceiver||"",TransceiverConfig:l},null,2)},Mn=["_成员名称ParticipantName","_信号名Word","_收发Direction","_系统System","_协议Protocol","_设备Device","_CardNo","_ChannelNo"],Vn=(r,e=[],t)=>{const i=[],u=[],l=[];return e==null||e.forEach(c=>{var g,n,o,s,m,p,$,f,I;const _=t("A429",c._信号名Word);if(!_)return console.error("未找到该消息: ",c._信号名Word);let d="";(g=Object.keys(c))==null||g.forEach(E=>{Mn.includes(E)||(d+=`${E.slice(1)}=${c[E]};`)});const N={MessageName:c._信号名Word,TransceiverID:`CardNo=${c._CardNo||""};ChannelNo=${c._ChannelNo||""};Label=${((n=_.data)==null?void 0:n._Label)||""};SDI=${((o=_.data)==null?void 0:o._SDI)||""};${d}`};((s=c._收发Direction)==null?void 0:s.toLocaleUpperCase())==="PUBLISH"?i.push(N):u.push(N);let F=l.find(E=>E.CardNo===c._CardNo);F||(F={CardNo:c._CardNo||"",Channels:[],Messages:[]},l.push(F)),F.Channels.push({ChannelNo:c._ChannelNo||"",Direction:c._收发Direction||"",BitRate:((m=_.data)==null?void 0:m._BitRate)||""}),F.Messages.push({ChannelNo:c._ChannelNo||"",Direction:c._收发Direction||"",Label:((p=_.data)==null?void 0:p._Label)||"",SDI:(($=_.data)==null?void 0:$._SDI)||"",TransmissionType:((f=_.data)==null?void 0:f._TransmissionType)||"",TransmissionPeriod:((I=_.data)==null?void 0:I._TransmissionPeriod)||""})}),JSON.stringify({Name:r._DeviceName||"",Description:r._Description||"",PartNumber:r._Partnumber||"",Version:r._Version||"",Type:"A429",ApplicationPlugin:"",ApplicationMessage:{TxMessage:i,RxMessage:u},MessageParser:"",MessageParserMappingConfig:{},Transceiver:r._Transceiver||"",TransceiverConfig:l},null,2)},En=["_成员名称ParticipantName","_信号名Message","_收发Direction","_系统System","_协议Protocol","_设备Device","_CardNo","_ChannelNo","_Mode","_Freq","_Factor"],Bn=(r,e=[],t)=>{const i=[],u=[],l=[];return e==null||e.forEach(c=>{var g,n;if(!t("Analog",c._信号名Message))return console.error("未找到该消息: ",c._信号名Message);let d="";(g=Object.keys(c))==null||g.forEach(o=>{En.includes(o)||(d+=`${o.slice(1)}=${c[o]};`)});const N={MessageName:c._信号名Message,TransceiverID:`CardNo=${c._CardNo||""};ChannelNo=${c._ChannelNo||""};Mode=${c._Mode||""};${d}`};((n=c._收发Direction)==null?void 0:n.toLocaleUpperCase())==="PUBLISH"?i.push(N):u.push(N);let F=l.find(o=>o.CardNo===c._CardNo);F||(F={CardNo:c._CardNo||"",Channels:[]},l.push(F)),F.Channels.push({ChannelNo:c._ChannelNo||"",Freq:c._Freq||"",Factor:c._Factor||""})}),JSON.stringify({Name:r._DeviceName||"",Description:r._Description||"",PartNumber:r._Partnumber||"",Version:r._Version||"",Type:"Analog",ApplicationPlugin:"",ApplicationMessage:{TxMessage:i,RxMessage:u},MessageParser:"",MessageParserMappingConfig:{},Transceiver:r._Transceiver||"",TransceiverConfig:l},null,2)},Gn=["_成员名称ParticipantName","_信号名Message","_收发Direction","_系统System","_协议Protocol","_设备Device","_CardNo","_ChannelNo","_Bus","_Slot"],bn=(r,e=[],t)=>{const i=[],u=[],l=[];return e==null||e.forEach(c=>{var F,g;if(!t("Discrete",c._信号名Message))return console.error("未找到该消息: ",c._信号名Message);let d="";(F=Object.keys(c))==null||F.forEach(n=>{Gn.includes(n)||(d+=`${n.slice(1)}=${c[n]};`)});const N={MessageName:c._信号名Message,TransceiverID:`ChannelNo=${c._ChannelNo||""};Bus=${c._Bus||""};Slot=${c._Slot||""};${d}`};((g=c._收发Direction)==null?void 0:g.toLocaleUpperCase())==="PUBLISH"?i.push(N):u.push(N),l.push({Bus:c._Bus||"",Slot:c._Slot||""})}),JSON.stringify({Name:r._DeviceName||"",Description:r._Description||"",PartNumber:r._Partnumber||"",Version:r._Version||"",Type:"Discrete",ApplicationPlugin:"",ApplicationMessage:{TxMessage:i,RxMessage:u},MessageParser:"",MessageParserMappingConfig:{},Transceiver:r._Transceiver||"",TransceiverConfig:l},null,2)},Wn=(r,e=[],t,i)=>{const u=[],l=[],c=[],_=[];return e==null||e.forEach(d=>{var g;if(!i("Serial",d._信号名Message))return console.error("未找到该消息: ",d._信号名Message);const F={MessageName:d._信号名Message,TransceiverID:"Com1"};((g=d._收发Direction)==null?void 0:g.toLocaleUpperCase())==="PUBLISH"?u.push(F):l.push(F),c.push({PortNo:d._PortNo||"",BaudRate:d._BaudRate||"",Parity:d._Parity||"",DataBits:d._DataBits||"",StopsBits:d._StopsBits||""})}),t==null||t.forEach(d=>{_.push({MessageName:d._信号名||"",VIPMessageType:d._信号类型||"",UserMessageType:d._用户信号名||""})}),JSON.stringify({Name:r._DeviceName||"",Description:r._Description||"",PartNumber:r._Partnumber||"",Version:r._Version||"",Type:"Serial",ApplicationPlugin:"",ApplicationMessage:{TxMessage:u,RxMessage:l},MessageParser:r._MessageParser||"",MessageParserMappingConfig:_,Transceiver:r._Transceiver||"",TransceiverConfig:c},null,2)},ht="info",Pt="mapping",St="msgParseMapping",It=[{title:"信号名",dataIndex:"_信号名",align:"center"},{title:"信号类型",dataIndex:"_信号类型",align:"center"},{title:"用户信号名",dataIndex:"_用户信号名",align:"center"}];function Ln(r){let e=null,t="",i="",u="";const l=j([]);function c(s=[]){if(t="",(s==null?void 0:s.length)<2)return We.error("数据格式错误");t=s==null?void 0:s.splice(0,2)[0],s.forEach(([m,p])=>{m&&(r.value.data[`_${m}`]=p||"")})}function _(s=[]){var $;if(i="",(s==null?void 0:s.length)<2)return We.error("数据格式错误");const m=s==null?void 0:s.splice(0,2);i=m[0];const p=($=m[1])==null?void 0:$.map(f=>({title:f,dataIndex:`_${f}`}));l.value=p,r.value.data.TransceiverConfig=s.map(f=>{const I={};return f==null||f.forEach((E,V)=>{I[p[V].dataIndex]=E}),I})}function d(s=[]){if((s==null?void 0:s.length)<2)return We.error("数据格式错误");u=s.splice(0,2)[0],r.value.data.MessageParserMappingConfig=s.map(m=>{const p={};return m==null||m.forEach(($,f)=>{p[It[f].dataIndex]=$}),p})}function N(){a.getFiles(s=>{if(!(s!=null&&s.length))return;const m=s[0],p=new FileReader;p.readAsArrayBuffer(m),p.onload=$=>{e=Da($.target.result,{type:"array"}),r.value.data={_GUID:a.randomString()},c(Ve.sheet_to_json(e.Sheets[ht],{header:1})),_(Ve.sheet_to_json(e.Sheets[Pt],{header:1})),d(Ve.sheet_to_json(e.Sheets[St],{header:1}))}},".xlsx")}function F(s){if(!e)return{};const m=e.Sheets[s];if(!m)return{};const p={};return Object.keys(m).forEach($=>{$.includes("!")&&(p[$]=m[$])}),p}function g(){var V,z;const s=r.value.data;if(!((V=s==null?void 0:s.TransceiverConfig)!=null&&V.length))return We.error("请先导入文件");const m=[];Object.keys(s).forEach(R=>{const B=s[R];typeof B=="object"||B===void 0||R==="_GUID"||m.push([R.slice(1),B])});const p=[["属性","值"]];t&&p.unshift(t);let $=[];(z=s==null?void 0:s.TransceiverConfig)!=null&&z[0]?$=[Object.keys(s.TransceiverConfig[0]).map(R=>R.slice(1))]:$=[["成员名称ParticipantName","信号名Word","收发Direction","系统System","协议Protocol","设备Device"]],i&&$.unshift(i);const f=[["信号名","信号类型","用户信号名"]];u&&f.unshift(u);const I={[ht]:p.concat(m),[Pt]:$.concat((s.TransceiverConfig||[]).map(R=>Object.values(R))),[St]:f.concat((s.MessageParserMappingConfig||[]).map(R=>Object.values(R)))},E=Ve.book_new();Object.keys(I).forEach(R=>{const B=Ve.aoa_to_sheet(I[R]);Object.assign(B,F(R)),Ve.book_append_sheet(E,B,R)}),ga(E,`VIP-${s._DeviceName}-config-${Date.now()}.xlsx`)}function n(){var f,I;if(!((I=(f=r.value.data)==null?void 0:f.TransceiverConfig)!=null&&I.length))return We.error("TransceiverConfig 为空");const m=r.value.data.TransceiverConfig[0]._协议Protocol,p=r.value.data;let $="";switch(m){case"A825":$=Tn(p,r.value.data.TransceiverConfig||[],o);break;case"A429":$=Vn(p,r.value.data.TransceiverConfig||[],o);break;case"Analog":$=Bn(p,r.value.data.TransceiverConfig||[],o);break;case"Discrete":$=bn(p,r.value.data.TransceiverConfig||[],o);break;case"Serial":$=Wn(p,r.value.data.TransceiverConfig||[],r.value.data.MessageParserMappingConfig||[],o);break}a.downloadBlob(`VIP-${r.value.label}-config-${Date.now()}.json`,new Blob([$],{type:"application/json"}))}function o(s,m){var $,f,I,E,V,z;const p=(($=le.value.find(R=>R.key===3))==null?void 0:$.children)||[];if(s==="A825"){const R=((f=p.find(B=>B.key===7))==null?void 0:f.children)||[];for(const B of R){const $e=B.children||[];for(const oe of $e)if(oe.data._MsgName===m)return oe}}else if(s==="A429"){const R=((I=p.find(B=>B.key===5))==null?void 0:I.children)||[];for(const B of R){const $e=B.children||[];for(const oe of $e)if(oe.data._WordName===m)return oe}}else{if(s==="Analog")return(((E=p.find(B=>B.key===4))==null?void 0:E.children)||[]).find(B=>B.data._ParamName===m);if(s==="Discrete")return(((V=p.find(B=>B.key===9))==null?void 0:V.children)||[]).find(B=>B.data._ParamName===m);if(s==="Serial")return(((z=p.find(B=>B.key===12))==null?void 0:z.children)||[]).find(B=>B.data._MessageName===m)}}return{configColumns:It,transceiverColumns:l,importExcel:N,exportExcel:g,exportJson:n}}const Rn={__name:"validate",setup(r,{expose:e}){const t=ze(()=>we(()=>import("./attrForm-BEHJBVlG.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),{appContext:i}=he(),{$modal:u}=i.config.globalProperties,l=j(!1),c=Vt([]),_=j(!1),d=j(0);function N(s,m,p){const $=m.data;if(s.vIf&&!s.vIf($))return{errMsg:"",color:"white"};const f=$[`_${s.label}`];if(s.required&&!f)return{errMsg:`${s.title||s.label} 必须填写`,color:"white"};const I={errMsg:"",color:"white"};return s.validator?s.validator($,{...m,parent:p})(null,f,(E,V)=>{I.color=V||(E?"red":"green"),E&&(I.errMsg=E.message)}):I.color=f?"green":"white",I}function F(s,m){s?Array.isArray(s)||(s=le.value):s=[],s.forEach(p=>{var $;if(["SimulationAllocation","SoftwareApplication","UtilityAllocation"].includes(p.tagName)||($=p.children)!=null&&$.length&&F(p.children,p),typeof p.key!="number"){const f=De(p.tagName),I=[];f.tableProps.forEach(E=>{const V=N(E,p,m);V.errMsg&&(d.value++,I.push({...V,...E}))}),I.length&&c.push({node:p,errDatas:I})}})}function g(){return c.length=0,d.value=0,_.value=!0,setTimeout(()=>{F(le.value),_.value=!1},100),l.value=!0,!1}function n(s,m){var f;s.preventDefault(),s.stopPropagation();const p=De((f=m.node)==null?void 0:f.tagName),$=(p==null?void 0:p.tableProps)||[];u.open({title:"修改ICD配置",width:650,titleAlign:"start",modalClass:"config-valida-modal","hide-cancel":!0,content:()=>S(t,{crtNode:m.node,formItems:$,inlineMsg:!0},null)})}const o=()=>S("div",{class:"content"},[ae(" "),c.map(s=>S(v("a-collapse"),{"expand-icon-position":"right",bordered:!1},{default:()=>[S(v("a-collapse-item"),null,{default:()=>[s.errDatas.map(m=>S("div",{class:"err-content"},[S(Et,{class:"warning"},null),S("span",{class:"err-text"},[m.title,ae("："),m.errMsg])]))],header:()=>{var m;return S("div",{class:"label"},[S("span",{class:"title",onClick:p=>n(p,s)},[s.node.label]),S("span",{class:"err-count"},[((m=s.errDatas)==null?void 0:m.length)||0]),S(v("a-tag"),{color:"#fff",size:"small",style:"backgroundColor:red",bordered:!0},{default:()=>[s.node.tagName]})])}})]}))]);return e({validate:g}),(s,m)=>{const p=v("a-empty"),$=v("NSpin"),f=v("a-button"),I=v("a-badge"),E=v("a-modal");return Q(),ce(E,{visible:l.value,"onUpdate:visible":m[1]||(m[1]=V=>l.value=V),title:"文件校验结果",width:650,modalClass:"config-valida-modal","mask-closable":!1},{footer:W(()=>[S(f,{style:{"margin-right":"15px"},onClick:m[0]||(m[0]=V=>l.value=!1)},{default:W(()=>m[5]||(m[5]=[ae("返回")])),_:1}),S(I,{count:d.value},{default:W(()=>[S(f,{type:"primary",onClick:g},{default:W(()=>m[6]||(m[6]=[ae("重新校验")])),_:1})]),_:1},8,["count"])]),default:W(()=>[c.length?Ge("",!0):(Q(),ce($,{key:0,show:_.value},{description:W(()=>m[3]||(m[3]=[ae(" 正在校验配置文件 ")])),default:W(()=>[m[4]||(m[4]=Y("h3",{style:{"text-align":"center",color:"#67C23A"}},"已全部校验合格",-1)),S(p,null,{image:W(()=>m[2]||(m[2]=[Y("img",{src:Qe},null,-1)])),_:1})]),_:1},8,["show"])),S(o)]),_:1},8,["visible"])}}},Ue=window.showOpenFilePicker;let Ke={};const Nt=".project,.icdconfig,.simulation,.system,.resource",Hn=/.+\./;function jn(r){if(console.log(!!Ue,"showOpenFilePicker"),Ue){const e=[];Ke={},Ue({multiple:!0,accept:Nt}).then(async t=>{for(const i of t){const u=await i.getFile();e.push(u);const l=i.name.replace(Hn,"");Ke[l]=i}r==null||r(e)}).catch(t=>{})}else a.getFiles(e=>r==null?void 0:r(e),Nt,!0)}function Un(r={}){const e=`VIP_${Date.now()}`,t=new Ye;t.file(`${e}.icdconfig`,r.icdconfig||""),t.file(`${e}.simulation`,r.simulation||""),t.file(`${e}.project`,r.project||""),t.file(`${e}.resource`,r.resource||""),t.file(`${e}.system`,r.system||""),t.generateAsync({type:"blob"}).then(i=>Ft.saveAs(i,`${e}.zip`))}async function zn(r,e){const t=await r.createWritable();await t.write(e),t.close()}function wn(r={}){return new Promise((e,t)=>{const i=Object.keys(Ke);i!=null&&i.length?(i.forEach(u=>zn(Ke[u],r[u]||"")),e()):t(new Error("还未导入文件"))})}async function Kn(r){const e={};for(const{file:t}of r){const i=t.name.split(".")[1];e[i]=await t.text()}return e}function gt(){const r=[];return le.value.forEach(e=>{var t;e.key===2&&((t=e.children)==null||t.forEach(i=>{var u;(u=i.children)==null||u.forEach(l=>{r.push(l)})}))}),r}const xn={"-3":"下载失败","-2":"编译失败","-1":"代码生成失败",0:"初始化",1:"代码开始生成",2:"代码生成完成",3:"开始编译",4:"编译完成",5:"开始下载",6:"下载完成",7:"执行结束"},Jn=[{title:"ID",dataIndex:"RTTaskID",align:"center"},{title:"模型名称",dataIndex:"simulationName",align:"center"},{title:"下位机",dataIndex:"targetName",align:"center"},{title:"下位机IP",dataIndex:"targetIP",align:"center"},{title:"状态",dataIndex:"status",align:"center"},{title:"操作",dataIndex:"operate",align:"center"}];function qn(){const{appContext:r}=he(),{$modal:e,$message:t}=r.config.globalProperties,i=Gt();let u=null;function l(d){var p,$;u==null||u.close();const N=((p=le.value.find(f=>f.key===15))==null?void 0:p.children)||[],F=gt(),n=((($=le.value.find(f=>f.key===16))==null?void 0:$.children)||[]).find(f=>f.data._ComputingResourceName===d.targetName),o=F.find(f=>f.data._SimulationName===d.simulationName);let s=null;if(N==null||N.forEach(f=>{var E,V;if(((E=f.data)==null?void 0:E._SystemName)!==d.targetName)return;const I=(V=f==null?void 0:f.children)==null?void 0:V.find(z=>z.data._SimulationName===d.simulationName);I&&(s=I)}),!n||!o||!s)return t.error("ICD导入不正确");const m=Object.assign({...s,children:_(o.children),targetIP:n.data._ComputerIPAdd,targetName:n.data._ComputingResourceName,taskInfo:{RTTaskID:d.RTTaskID}},n.data,s.data);Reflect.deleteProperty(m,"data"),window.setDBItem("simdata",[m]),i.push({name:"compile"})}const c=()=>{var n;const d=j([]),N=j([]),F=((n=le.value.find(o=>o.key===15))==null?void 0:n.children)||[],g=[];Ia().then(o=>{o.code===200&&(d.value=o.data||[])}),F.forEach(o=>{var s;g.push({key:o.key,icon:()=>Bt(Fa),title:o.label,children:((s=o.children)==null?void 0:s.map(m=>({key:m.key,title:m.label})))||[]})}),u=e.open({title:"请选择要编译的模型",width:750,okText:"确认",cancelText:"取消",titleAlign:"start",draggable:!0,content:()=>S(ge,null,[S(v("a-form"),{"auto-label-width":!0},{default:()=>[S(v("a-form-item"),{label:"请选择模型",field:"rate"},{default:()=>[S(v("a-tree-select"),{modelValue:N.value,"onUpdate:modelValue":o=>N.value=o,data:g,placeholder:"请选择模型",multiple:!0,"allow-clear":!0,"tree-check-strictly":!0,"tree-checked-strategy":"child","allow-search":!0},null)]})]}),S(v("a-divider"),null,null),S("b",null,[ae("历史记录")]),S(v("STable"),{columns:Jn,pagination:!1,"data-source":d.value,bordered:!0,deepWatchDataSource:!0,rowKey:"RTTaskID",height:"50vh",style:"margin-top: 20px"},{bodyCell({column:o,record:s}){return o.dataIndex==="status"?xn[s.status]:o.dataIndex==="operate"?S(v("a-button"),{type:"text",onClick:()=>l(s)},{default:()=>[ae(" 详情 ")]}):s[o.dataIndex]}})]),onOk(){var $,f;const o=[],s=(($=le.value.find(I=>I.key===15))==null?void 0:$.children)||[],m=((f=le.value.find(I=>I.key===16))==null?void 0:f.children)||[];console.log(s,m);const p=gt();if(s.forEach(I=>{var V;const E=m.find(z=>z.data._ComputingResourceName===I.data._SystemName);E&&((V=I.children)==null||V.forEach(z=>{const R=p.find(B=>B.data._SimulationName===z.data._SimulationName);if(R&&N.value.includes(z.key)){const B=Object.assign({...z,children:_(R.children),targetIP:E.data._ComputerIPAdd,targetName:E.data._ComputingResourceName,vipPath:E.data._VIP_Path},E.data,z.data);Reflect.deleteProperty(B,"data"),o.push(B)}}))}),!(o!=null&&o.length))return t.error("请选择模型");window.setDBItem("simdata",o),i.push({name:"compile"})}})};function _(d=[]){const N=[];return d==null||d.forEach(F=>{const g=Object.assign({},F,{children:_(F.children)},F.data);Reflect.deleteProperty(g,"data"),N.push(g)}),N}return{open:c}}const Xn={className:"custom-radio-card-title"},Zn={class:"form-item"},Qn={class:"file-icon"},Yn={class:"title"},ei={__name:"importFile",setup(r,{expose:e}){const{appContext:t}=he(),{$message:i}=t.config.globalProperties,u=j(!1),l=j({fileType:1,fileList:[]});function c(){l.value.fileList=[]}async function _(g,n,o=""){const s=await g.entries();for await(const[m,p]of s)if(p.kind==="directory")await _(p,n,`${o}${m}/`);else{const $=await p.getFile(),f=`${o}${$.name}`;n.file(f,$)}}const d=[{id:1,title:"XML",dec:"XML类型文件",selectFile(){jn(g=>{g==null||g.forEach(n=>{l.value.fileList.push({file:n,name:n.name,percent:0,status:"init",uid:`${Date.now()}`,url:void 0})})})}},{id:2,title:"TXT",dec:"TXT类型文件",accept:".txt"},{id:3,title:"EXCEL",dec:"EXCEL类型文件",accept:".xlsx"},{id:4,title:"XML(BP)",disabled:!window.showDirectoryPicker,selectFile(){var g;(g=window.showDirectoryPicker)==null||g.call(window).then(async n=>{const o=new Ye;await _(n,o);const s=await o.generateAsync({type:"blob"}),m=`${n.name}.zip`,p=new File([s],m);l.value.fileList.push({file:p,name:n.name,percent:0,status:"init",uid:`${Date.now()}`,url:void 0})}).catch(n=>console.error(String(n)))},dec:window.showDirectoryPicker?"BP文件":"请升级浏览器"}];function N(){var o;const g=l.value.fileType||1,n=d.find(s=>s.id===g);if(!n)return console.error("未找到对应的文件类型");(o=n.selectFile)==null||o.call(n)}function F(){return new Promise(async(g,n)=>{function o(m){i.error(String(m)),n(m)}if(!l.value.fileList.length&&!l.value.filePath)return o("请选择文件!");if(l.value.fileType===1)return at(await Kn(l.value.fileList)).then(g).catch(o);const s=new FormData;l.value.fileList.forEach(({file:m})=>s.append(m.name,m)),Ca(s).then(m=>at(m.data||{})).then(g).catch(o)})}return e({open(){l.value={fileType:1,fileList:[]},u.value=!0}}),(g,n)=>{const o=v("a-typography-text"),s=v("a-space"),m=v("a-radio"),p=v("a-radio-group"),$=v("a-form-item"),f=v("a-button"),I=v("a-form"),E=v("a-modal");return Q(),ce(E,{visible:u.value,"onUpdate:visible":n[1]||(n[1]=V=>u.value=V),title:"导入文件",width:700,titleAlign:"start",draggable:"","on-before-ok":F},{default:W(()=>[S(I,{model:l.value,"label-align":"left","auto-label-width":"",class:"data-form"},{default:W(()=>[S($,{field:"fileType",label:"文件类型",required:""},{default:W(()=>[S(p,{"model-value":l.value.fileType,"onUpdate:modelValue":n[0]||(n[0]=V=>l.value.fileType=V),"default-value":1,onChange:g.onchange},{default:W(()=>[(Q(),Ne(ge,null,Ze(d,(V,z)=>S(m,{key:z,value:V.id,disabled:V.disabled},{radio:W(({checked:R})=>[S(s,{align:"start",class:bt(["custom-radio-card",R?"custom-radio-card-checked":""])},{default:W(()=>[n[2]||(n[2]=Y("div",{className:"custom-radio-card-mask"},[Y("div",{className:"custom-radio-card-mask-dot"})],-1)),Y("div",null,[Y("div",Xn,Oe(V.title),1),S(o,{type:"secondary"},{default:W(()=>[ae(Oe(V.dec),1)]),_:2},1024)])]),_:2},1032,["class"])]),_:2},1032,["value","disabled"])),64))]),_:1},8,["model-value","onChange"])]),_:1}),S($,{field:"fileType",label:"选择文件",required:""},{default:W(()=>[Y("div",Zn,[S(s,null,{default:W(()=>[S(f,{type:"primary",onClick:N},{default:W(()=>[ae(" 添加文件"+Oe(l.value.fileType===4?"夹":""),1)]),_:1}),S(f,{onClick:c},{default:W(()=>n[3]||(n[3]=[ae(" 清空列表 ")])),_:1})]),_:1}),(Q(!0),Ne(ge,null,Ze(l.value.fileList||[],(V,z)=>{var R;return Q(),Ne("div",{key:z,class:"file-item"},[Y("div",Qn,[(R=V.name)!=null&&R.includes(".")?(Q(),ce(me(Wt),{key:0})):(Q(),ce(me(ya),{key:1}))]),Y("div",Yn,Oe(V.name),1),S(me(Lt),{class:"icon-delete",size:"16",onClick:B=>l.value.fileList.splice(z,1)},null,8,["onClick"])])}),128))])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}},ti=Ct(ei,[["__scopeId","data-v-69a520be"]]),ai={style:{height:"calc(100% - 45px)"}},ni={class:"main-content"},ii={key:1},li={key:0,style:{"margin-bottom":"10px"}},ri={__name:"index",setup(r){const e=ze(()=>we(()=>import("./attrForm-BEHJBVlG.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),t=ze(()=>we(()=>import("./projectCondig-B5ACxpnE.js"),__vite__mapDeps([7,8,1,2,3,4,5,9,10,11,12,13,14,15,16]))),i=j("");nt();function u(y){y.stopPropagation(),y.preventDefault()}const{appContext:l}=he(),{$message:c}=l.config.globalProperties,_=[{title:"属性名",dataIndex:"_TagName"},{title:"属性值",dataIndex:"_TagValue"},{title:"属性描述",dataIndex:"_Description"},{title:"操作",render({record:y,rowIndex:T}){return S(v("NSpace"),null,{default:()=>[S(v("NButton"),{text:!0,onClick:()=>s.value.data.Tag.splice(T,1)},{default:()=>[ae("删除")]}),S(v("NButton"),{text:!0,onclick:()=>P(y)},{default:()=>[ae("修改")]})]})}}],d=j(),{open:N}=kn(),{openCustomAttr:F}=yt(),{open:g}=qn(),n=[{clickHandle:be,imgSrc:"images/d-openFile.png",title:"导入配置文件"},{clickHandle:A,imgSrc:"images/i-export.png",title:"导出配置文件"},{clickHandle:k,imgSrc:"images/i-new.png",title:"新建配置文件"},{clickHandle:N,imgSrc:"images/d-saveFile.png",title:"生成模型文件"},{clickHandle:g,img2Src:"images/compile.png",bgColor:"#8CCD60",title:"实时编译"},...Ue?[{clickHandle:$e,img2Src:"images/save.png",bgColor:"#867FF5",title:"保存文件"}]:[],{clickHandle:()=>d.value.validate(),img2Src:"images/validate.png",bgColor:"#8CCD60",title:"文件校验"}],o=j("2"),s=j(null),m=Rt(()=>{var y;return((y=s.value)==null?void 0:y.tagName)==="Device"}),{configColumns:p,transceiverColumns:$,importExcel:f,exportExcel:I,exportJson:E}=Ln(s),V=j([]),z=j([]),R=j([]),B=j(null);function $e(){wn(it()).then(()=>c.success("保存成功")).catch(y=>c.error(String(y)))}const oe=j(!1),ke=j(null);function be(){var y;(y=ke.value)==null||y.open()}function k(){s.value=null,nt()}function P(y){var T,x;F((x=(T=s.value)==null?void 0:T.data)==null?void 0:x.Tag,y).then(U=>Object.assign(y,U))}function A(){Un(it())}function h(){var y,T;F((T=(y=s.value)==null?void 0:y.data)==null?void 0:T.Tag).then(x=>{var U;(U=s.value.data)!=null&&U.Tag||(s.value.data.Tag=[]),s.value.data.Tag.push(x)})}function D(y){var ee,J,ne,Fe,Pe;console.time("nodeClick"),o.value="2",z.value=y.children||[];const T=De(y.tagName);if(!T){s.value=null;return}R.value=T.tableProps||[];const x=typeof y.key=="number";if(oe.value=x?!1:T.hasCustom,x)B.value=T?{...T,tableTitle:y.tagName}:null;else{let Z=null;z.value.length&&(Z=(ee=z.value[0])==null?void 0:ee.tagName),B.value=Z?De(Z):null}(ne=(J=B.value)==null?void 0:J.tableProps)==null||ne.forEach(Z=>{Object.assign(Z,{align:"center",ellipsis:!0,resizable:!0,tooltip:{placement:"top",title:({record:te,column:Se})=>{var ve;return(ve=te==null?void 0:te.data)==null?void 0:ve[`_${Se.label}`]},allowEnter:!0},minWidth:Z.title?Z.title.length*15:void 0})}),s.value=y;const U=[];(Pe=(Fe=y.data)==null?void 0:Fe.TransceiverConfig)==null||Pe.forEach(Z=>{Object.keys(Z).forEach(te=>{U.some(Se=>Se.dataIndex===te)||U.push({title:te.slice(1),dataIndex:te})})}),$.value=U,V.value=O(le.value,y.key)||[],console.timeEnd("nodeClick")}function O(y,T,x=[]){for(const U of y){const ee=[...x];if(ee.push(U.label),U.key===T)return ee;if(U.children){const J=O(U.children,T,ee);if(J!==null)return J}}return null}return(y,T)=>{const x=v("a-input-search"),U=v("NSpin"),ee=v("BtnGroup"),J=v("a-tab-pane"),ne=v("a-empty"),Fe=v("a-breadcrumb-item"),Pe=v("a-breadcrumb"),Z=v("a-button"),te=v("a-collapse-item"),Se=v("icon"),ve=v("a-table"),Ot=v("STable"),kt=v("a-collapse"),vt=v("a-tabs"),Tt=v("a-split");return Q(),Ne(ge,null,[S(Tt,{class:"wh100","default-size":"300px",min:"200px",max:.8},{first:W(()=>[Y("div",{class:"tree-box",onContextmenu:u},[S(U,{show:me(qt),class:"h100"},{default:W(()=>[S(x,{modelValue:i.value,"onUpdate:modelValue":T[0]||(T[0]=Te=>i.value=Te),style:{"margin-bottom":"8px"},placeholder:"请输入查询关键字"},null,8,["modelValue"]),Y("div",ai,[S(Ea,{searchKey:i.value,onNodeClick:D},null,8,["searchKey"])])]),_:1},8,["show"])],32)]),second:W(()=>[Y("div",ni,[T[8]||(T[8]=Y("div",{class:"navHeader"},[Y("div",{class:"img-box"},[Y("img",{src:Aa})]),Y("span",null,"ICD 配置")],-1)),S(ee,{data:n}),S(vt,{"active-key":o.value,"onUpdate:activeKey":T[2]||(T[2]=Te=>o.value=Te),size:"large",justify:"",animation:"",type:"capsule"},{default:W(()=>[S(J,{key:"1",title:"项目信息"},{default:W(()=>[S(me(t))]),_:1}),S(J,{key:"2",class:"attr-pane h100",title:"属性参数",style:{overflow:"auto"}},{default:W(()=>{var Te;return[(Te=s.value)!=null&&Te.tagName?(Q(),Ne("div",ii,[Y("h5",null,Oe(V.value[0]==="协议"?V.value[1]:V.value[0]),1),S(Pe,{"max-count":4},{default:W(()=>[(Q(!0),Ne(ge,null,Ze(V.value,(Re,re)=>(Q(),ce(Fe,{key:re},{default:W(()=>[ae(Oe(Re),1)]),_:2},1024))),128))]),_:1}),m.value?(Q(),Ne("div",li,[S(Z,{type:"primary",onClick:me(f)},{default:W(()=>T[4]||(T[4]=[ae("导入Excel")])),_:1},8,["onClick"]),S(Z,{style:{"margin-left":"10px"},type:"outline",status:"success",onClick:me(I)},{default:W(()=>T[5]||(T[5]=[ae("导出Excel")])),_:1},8,["onClick"]),S(Z,{style:{"margin-left":"10px"},type:"primary",status:"success",onClick:me(E)},{default:W(()=>T[6]||(T[6]=[ae("导出Json")])),_:1},8,["onClick"])])):Ge("",!0),S(kt,{class:"attr-collapse","default-active-key":["1","2","3","4","5"]},{default:W(()=>{var Re;return[Ht(S(te,{key:"1",header:"属性"},{default:W(()=>[S(me(e),{crtNode:s.value,formItems:R.value},null,8,["crtNode","formItems"])]),_:1},512),[[jt,s.value&&typeof s.value.key!="number"]]),oe.value?(Q(),ce(te,{key:"2",header:"自定义属性"},{extra:W(()=>[S(Z,{type:"primary",size:"small",shape:"circle",onClick:T[1]||(T[1]=Ut(re=>h(),["stop"]))},{default:W(()=>[S(Se,{name:"icon-xinzeng",size:"15",color:"#fff",style:{"margin-top":"3px"}})]),_:1})]),default:W(()=>{var re,Me;return[S(ve,{data:((Me=(re=s.value)==null?void 0:re.data)==null?void 0:Me.Tag)||[],columns:_,pagination:!1,"virtual-list-props":{height:"100%",buffer:60,fixedSize:!0}},null,8,["data"])]}),_:1})):Ge("",!0),m.value?(Q(),ce(te,{key:"4",header:"板卡配置"},{default:W(()=>{var re;return[S(ve,{data:((re=s.value)==null?void 0:re.data.TransceiverConfig)||[],columns:me($),pagination:!1,"virtual-list-props":{height:"100%",buffer:60,fixedSize:!0}},null,8,["data","columns"])]}),_:1})):Ge("",!0),m.value?(Q(),ce(te,{key:"5",header:"MessageParserMappingConfig"},{default:W(()=>{var re;return[S(ve,{data:((re=s.value)==null?void 0:re.data.MessageParserMappingConfig)||[],columns:me(p),pagination:!1,"virtual-list-props":{height:"100%",buffer:60,fixedSize:!0}},null,8,["data","columns"])]}),_:1})):Ge("",!0),B.value?(Q(),ce(te,{key:"3",header:(Re=B.value)==null?void 0:Re.tableTitle},{default:W(()=>[S(Ot,{class:"map-table",deepWatchDataSource:"",bordered:"",pagination:!1,"data-source":z.value,columns:(B.value.tableProps||[]).filter(re=>!re.vIf),rowKey:"key",childrenColumnName:"C",scroll:{x:600,y:400},size:"middle"},{bodyCell:W(({column:re,record:Me})=>{var et;return[ae(Oe((et=Me==null?void 0:Me.data)==null?void 0:et[`_${re.label}`]),1)]}),_:1},8,["data-source","columns"])]),_:1},8,["header"])):Ge("",!0)]}),_:1})])):(Q(),ce(ne,{key:0},{image:W(()=>T[3]||(T[3]=[Y("img",{src:Qe},null,-1)])),_:1}))]}),_:1}),S(J,{key:"3",title:"其他"},{default:W(()=>[S(ne,null,{image:W(()=>T[7]||(T[7]=[Y("img",{src:Qe},null,-1)])),_:1})]),_:1})]),_:1},8,["active-key"])])]),_:1}),S(ti,{ref_key:"importFileRef",ref:ke},null,512),S(Rn,{ref_key:"validateRef",ref:d},null,512)],64)}}},si=Ct(ri,[["__scopeId","data-v-1c5f8734"]]),Si=Object.freeze(Object.defineProperty({__proto__:null,default:si},Symbol.toStringTag,{value:"Module"}));export{Si as i,yt as u};
