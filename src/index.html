<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cmocka: cmocka</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script src="striped_bg.js"></script>
<link href="that_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cmocka
   &#160;<span id="projectnumber">1.1.5</span>
   </div>
   <div id="projectbrief">Unit testing library with mock support</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">cmocka </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the online reference for developing with the cmocka library. It documents the cmocka C API.</p>
<p>cmocka is an elegant unit testing framework for C with support for mock objects. It only requires the standard C library, works on a lot of platforms (including embedded) and with different compilers.</p>
<p><a href="http://cmocka.org/">http://cmocka.org/</a></p>
<h1><a class="anchor" id="main-features"></a>
Features</h1>
<p>Tests written with cmocka are compiled into stand-alone executables and linked with the CMock library, the standard C library and module being tested. Any symbols external to the module being tested should be mocked - replaced with functions that return values determined by the test - within the test application. Even though significant differences may exist between the target execution environment of a code module and the environment used to test the code the unit testing is still valid since its goal is to test the logic of a code modules at a functional level and not necessarily all of its interactions with the target execution environment.</p>
<p>The CMocka library provides:</p>
<ul>
<li>Support for mock objects.</li>
<li>Test fixtures.</li>
<li>Only requires a C library</li>
<li>Exception handling for signals (SIGSEGV, SIGILL, ...)</li>
<li>No use of fork()</li>
<li>Very well tested</li>
<li>Testing of memory leaks, buffer overflows and underflows.</li>
<li>A set of assert macros.</li>
<li>Several supported output formats (stdout, TAP, JUnit XML, Subunit)</li>
<li>License: Apache License 2.0</li>
</ul>
<h1><a class="anchor" id="main-test"></a>
A cmocka test</h1>
<p>Test cases are functions with the signature void function(void **state). Test applications initialize a table with test case function pointers using <a class="el" href="group__cmocka__exec.html#gaf79fe61343efe7cdeb5bbb12a5577cb3">unit_test()</a> macros. This table is then passed to the run_tests() macro to execute the tests. run_tests() sets up the appropriate exception / signal handlers and other data structures prior to running each test function. When a unit test is complete run_tests() performs various checks to determine whether the test succeeded.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdarg.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stddef.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;setjmp.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmocka.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* A test case that does nothing and succeeds. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> null_test_success(<span class="keywordtype">void</span> **state) {</div>
<div class="line">    (void) state; <span class="comment">/* unused */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="struct_c_m_unit_test.html">CMUnitTest</a> tests[] = {</div>
<div class="line">        <a class="code hl_define" href="group__cmocka__exec.html#ga562719c550b5ce277aab6b0371f7f34f">cmocka_unit_test</a>(null_test_success),</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_function" href="group__cmocka__exec.html#ga7c62fd0acf2235ce98268c28ee262a57">cmocka_run_group_tests</a>(tests, NULL, NULL);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__cmocka__exec_html_ga562719c550b5ce277aab6b0371f7f34f"><div class="ttname"><a href="group__cmocka__exec.html#ga562719c550b5ce277aab6b0371f7f34f">cmocka_unit_test</a></div><div class="ttdeci">#define cmocka_unit_test(f)</div><div class="ttdef"><b>Definition</b> cmocka.h:1837</div></div>
<div class="ttc" id="agroup__cmocka__exec_html_ga7c62fd0acf2235ce98268c28ee262a57"><div class="ttname"><a href="group__cmocka__exec.html#ga7c62fd0acf2235ce98268c28ee262a57">cmocka_run_group_tests</a></div><div class="ttdeci">int cmocka_run_group_tests(const struct CMUnitTest group_tests[], CMFixtureFunction group_setup, CMFixtureFunction group_teardown)</div><div class="ttdoc">Run tests specified by an array of CMUnitTest structures.</div></div>
<div class="ttc" id="astruct_c_m_unit_test_html"><div class="ttname"><a href="struct_c_m_unit_test.html">CMUnitTest</a></div><div class="ttdef"><b>Definition</b> cmocka.h:2260</div></div>
</div><!-- fragment --><h1><a class="anchor" id="main-mock"></a>
Mock objects</h1>
<p>You may already have heard the term "Mock Object". It describes a special case of an object that mimics a real instance of an interface in order to provide enough of that interface for testing. While there are several unit testing frameworks that already provide some easy to use interface for creating different kinds of "fake" objects for testing, there may be some confusion in terms of how these test objects are programmed and what the behavioral differences are between them.</p>
<p>Mock objects include some logic and the test driver is able to modify the behaviour and state. The object can call some functions or act on different input (abort a test if it is wrong). The test driver injects what it expects the mock object to return. CMocka provides an API to easily mock code.</p>
<p><a href="https://lwn.net/Articles/558106/">Learn more ...</a></p>
<h1><a class="anchor" id="main-embedded"></a>
Embedded platforms</h1>
<p>It is possible that some embedded platforms do not provide definitions for required types or that the guards to protect them are not defined. To address this issue you can create a header file name 'cmocka_platform.h' with the required types and definitions. After that point cmake to the include directory using:</p>
<pre>
    cmake -DCMOCKA_PLATFORM_INCLUDE=/home/compiler/my/include_directory ..
</pre><h1><a class="anchor" id="main-threads"></a>
Threading</h1>
<p>cmocka is not fully thread safe and it is not the goal of it to be it. We have several global variables to track test states. They are marked as thread local but it is possible that you still run into issues. However if you use cmocka for writing tests in an application which uses threads, you can set the following envionment variable:</p>
<pre>
    CMOCKA_TEST_ABORT='1' ./my_threading_test
</pre><p>With this environment variable set to '1', cmocka will call <code>abort()</code> if a test fails.</p>
<h1><a class="anchor" id="main-output"></a>
Output formats</h1>
<p>By default, cmocka prints human-readable test output to stderr. It is possible to configure several other output formats. The configuration is done using the <code>CMOCKA_MESSAGE_OUTPUT</code> environment variable. The supported values are:</p><ul>
<li><code>STDOUT</code> for the default standard output printer</li>
<li><code>SUBUNIT</code> for subunit output</li>
<li><code>TAP</code> for Test Anything Protocol (TAP) output</li>
<li><code>XML</code> for JUnit XML format The case doesn't matter.</li>
</ul>
<p>The XML output goes to stderr by default. If the environment variable <code>CMOCKA_XML_FILE</code> exists and the file specified by this variable doesn't exist yet, then cmocka will put the output to this file. Note that if you are have several groups you should set <code>CMOCKA_XML_FILE</code> to <code>CMOCKA_XML_FILE=cm_%g.xml</code>. In this g will be replaced by the group_name of the test and a file will be created for each group, othwerwise all groups will be printed into the same file. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
